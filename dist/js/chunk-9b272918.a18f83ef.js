(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-9b272918"],{"05c0":function(e,t,a){"use strict";a("7f7f"),a("20d6"),a("ac6a");var r=a("cebc"),i=a("3f4e"),n=a("2f62"),s={name:"CvPublictreeContent",components:{CvContent:i.a},props:{model:String,vehicleMonitor:Function,loading:Boolean,noresize:{default:!1,type:Boolean}},data:function(){return{entryList:[],condition:""}},computed:Object(r.a)({},Object(n.c)(["onlineList","isAttention","socketEnterprise","socketVehicle","vehicle_data","vehicleCondition"]),{isCheck:function(){switch(this.model){case"multi":return!0;case"single":default:return!1}},_treeMethods:function(){return this.$refs.tabs},_contentMethods:function(){return this.$refs.content}}),beforeDestroy:function(){var e=this._treeMethods.getAllNodes;this.setStoreVehicleSearchCondition(this.condition),this.setStoreVehicleData(e())},mounted:function(){var e=this._treeMethods.$refs.tree.reference().ztreeApi;e()&&e().checkAllNodes(!1)},methods:Object(r.a)({},Object(n.b)(["setStoreVehicleData","setStoreVehicleSearchCondition"]),{handlerVehicleSearch:function(e){this.condition=e},vehicle_Monitor:function(e){var t=e.data;if(e.name,"function"==typeof this.vehicleMonitor)switch(this.model){case"multi":return this.vehicle_Monitor_multi(e);case"single":return this.vehicleMonitor(t[0])}},vehicle_Monitor_multi:function(e){var t=this,a=e.data;switch(e.name){case"check":this.entryList=this.entryList.concat(a);break;case"cancel":a.forEach(function(e){var a=t.entryList.findIndex(function(t){return t.id==e.id});0<=a&&t.entryList.splice(a,1)})}this.vehicleMonitor(this.entryList)}})},l=(a("45d7"),a("2877")),o=Object(l.a)(s,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("cv-content",{ref:"content",attrs:{loading:e.loading,noresize:e.noresize}},[e.model?a("cv-tabs-tree",{ref:"tabs",staticClass:"vehiclemaster-tree",attrs:{slot:"aside","vehicle-search":e.vehicleCondition,"is-checked":e.isCheck,"tree-data":e.vehicle_data,"online-monitor":e.onlineList,"vehicle-monitor":e.socketVehicle,"attention-monitor":e.isAttention,"enterprise-fleet-monitor":e.socketEnterprise,"node-monitor":e.vehicle_Monitor},on:{"vehicle-choose-search":e.handlerVehicleSearch},slot:"aside"}):e._e(),e._t("default")],2)},[],!1,null,"2dfdf41b",null).exports;o.install=function(e){e.component(o.name,o)},t.a=o},"45d7":function(e,t,a){"use strict";var r=a("6e18");a.n(r).a},4703:function(e,t,a){"use strict";var r=a("e554");a.n(r).a},"6e18":function(e,t,a){},a91e:function(e,t,a){"use strict";a("c5f6");var r={props:{type:{type:[String],default:"date"}},data:function(){return{datevalue:null,daterangevalue:null,quartervalue:null,format:"yyyy-MM-dd",pickerOption:{disabledDate:function(e){return e.getTime()>Date.now()-864e5}}}},methods:{transformQuarter:function(e,t){1<arguments.length&&void 0!==t||this.format;var a=this.$filter,r=a.format,i=a.dateWeekMonth,n=r(e,r);return n&&i(n,this.format).quarter.num},enterNull:function(){return this.$emit("input",null)},enterDatevalue:function(e,t){var a=this.$filter,r=a.format,i=a.dateWeekMonth,n=(a.timeStamp,r(e,this.format)),s=r(new Date,this.format),l=i(n,this.format),o=l.week,c=l.month;switch(t){case"date":return this.$emit("input",{searchTime:n,startTime:r(e,"yyyy-MM-dd start"),endTime:r(e,"yyyy-MM-dd end")});case"week":return this.$emit("input",{searchTime:n,startTime:o.WeekStart,endTime:this.notBeyondCurrenttime(o.WeekEnd,s)});case"month":case"year":return this.$emit("input",{searchTime:n,startTime:c.MonthStart,endTime:this.notBeyondCurrenttime(c.MonthEnd,s)})}},enterQuartervalue:function(e,t){switch(Number(e)){case 1:return this.$emit("input",{searchTime:1});case 2:return this.$emit("input",{searchTime:4});case 3:return this.$emit("input",{searchTime:7});case 7:return this.$emit("input",{searchTime:10})}},enterDaterange:function(e,t){var a=this,r=this.$filter.format;if(this.$service.isArray(e)){var i=e.map(function(e){return r(e,a.format)});this.$emit("input",{startTime:i[0],endTime:i[1]})}},notBeyondCurrenttime:function(e,t){var a=this.$filter.timeStamp;return 0<=a(e)-a(t)?t:e}},computed:{_quarterLists:function(){var e=this.transformQuarter(new Date);return["01季度","02季度","03季度","04季度"].map(function(t,a){return{label:"".concat((new Date).getFullYear(),"(").concat(t,")"),value:a+1,disabled:e<a+1}})}},watch:{datevalue:function(e){if(!e)return this.enterNull();this.enterDatevalue(e,this.type)},quartervalue:function(e){if(!e)return this.enterNull();this.enterQuartervalue(e,this.type)},daterangevalue:function(e){if(!e)return this.enterNull();this.enterDaterange(e,this.type)},type:function(e){this.datevalue=null,this.daterangevalue=null,this.quartervalue=null}}},i=a("2877"),n=Object(i.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form-item",{attrs:{label:""}},["date"==e.type||"week"==e.type||"month"==e.type||"year"==e.type?a("el-date-picker",{attrs:{format:"week"==e.type?"yyyy第WW周":"",type:e.type,clearable:!1,"picker-options":e.pickerOption},model:{value:e.datevalue,callback:function(t){e.datevalue=t},expression:"datevalue"}}):"quarter"==e.type?a("el-select",{model:{value:e.quartervalue,callback:function(t){e.quartervalue=t},expression:"quartervalue"}},e._l(e._quarterLists,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})}),1):e._e(),a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:"daterange"==e.type,expression:"type=='daterange'"}],attrs:{type:"daterange","picker-options":e.pickerOption,clearable:!1},model:{value:e.daterangevalue,callback:function(t){e.daterangevalue=t},expression:"daterangevalue"}})],1)},[],!1,null,null,null);t.a=n.exports},c408:function(e,t,a){"use strict";a.r(t),a("ac6a"),a("386d");var r=a("a91e"),i=a("05c0"),n={components:{dangeractionSwitchdate:r.a,CvPublictreeContent:i.a},data:function(){return{treeLoading:!1,newval:null,alertType:"1",alarmArray:[],search:{dateType:"date",searchtime:null,alarmTypeIds:[],alarmTime:[this.$filter.timeStamp(this.$filter.format(new Date(new Date-6048e5),"yyyy-MM-dd start")),this.$filter.timeStamp(this.$filter.format(new Date,"yyyy-MM-dd HH:mm:ss"))],type:"FTA"},grid:{searchTime:"",dateType:"",alarmTypeIds:[],vehicleId:"",type:""},dialog:{title:"报警详情",flag:!1,vehicleId:"",name:"updata",size:"dialog-full",id:"",enterpriseId:""},num:1}},computed:{_table:function(){return this.$refs.travelstatistics},_searchRangerLists:function(){return[{key:"date",name:"日"},{key:"month",name:"月"},{key:"quarter",name:"季"},{key:"year",name:"年"}]}},mounted:function(){var e=this;this.$store.dispatch("getTypeG",{type:133}).then(function(t){e.alarmArray=t.data}),this.$route.query.params&&this.sendSearch()},methods:{handlerVehicleMonitor:function(e){this.grid.vehicleId=e.id},indexMethod:function(e){return++e},alarmCount:function(e){return 0<e.alarmCount?e.alarmCount:"--"},sendSearch:function(){var e=this;if(this.$route.query.params)this.treeLoading=!0,this.grid.vehicleId=this.$route.query.params.vehicleId,this.grid.searchTime=this.$route.query.params.searchTime,this.grid.dateType=this.$route.query.params.dateType,this.search.dateType=this.$route.query.params.dateType,this.grid.alarmTypeIds=this.$route.query.params.alarmType,this.search.alarmTypeIds=this.$route.query.params.alarmType,this.grid.type=this.$route.query.params.type,this._table.tableInitial(),this.$store.dispatch("SearchListG",this.grid).then(function(){e.treeLoading=!1});else{if(null==this.search.searchtime)return void this.$message.warning("请选择时间");if(""==this.alertType)return void this.$message.warning("请选择报警方式");if(""==this.grid.vehicleId)return void this.$message.warning("请选择车辆");this.grid.searchTime=this.search.searchtime?this.search.searchtime.searchTime:"",this.grid.dateType=this.search.dateType,this.grid.alarmTypeIds=(0==this.search.alarmTypeIds.length?[]:this.search.alarmTypeIds).join(","),this.grid.type=this.search.type,this._table.tableInitial()}},popover:function(e){var t=this;0!=e.alarmCount&&this.$service.isArray(e.alarmMap)&&(this.dialog.flag=!0,e.alarmMap.forEach(function(e){t.dialog.data.push("".concat(e.alarmName," : ").concat(e.alarmCount,"次"))}))},timer:function(e){var t=this.$filter.format(e.startTime,"yyyy-MM-dd HH:mm:ss"),a=this.$filter.format(e.endTime,"yyyy-MM-dd HH:mm:ss");return"".concat(t," 至 ").concat(a," ")},down:function(){var e=this;if(!this.grid.searchTime||!this.alertType||!this.grid.vehicleId)return this.$message.warning("请先搜索"),!1;this.$store.dispatch("downG",this.grid).then(function(t){t.flag?e.$message.warning("离线下载成功"):e.$message.error(e.$t("error."+t.errorCode))})}},watch:{"dialog.flag":function(e){e||(this.dialog.data=[])},alertType:function(e){var t=this,a=133;this.search.alarmTypeIds=[],this.search.type="1"==e?(a=133,"FTA"):(a=134,"ADS");var r={type:a};this.$store.dispatch("getTypeG",r).then(function(e){t.alarmArray=e.data})},"search.dateType":function(){this.$route.query.params=null},"search.searchtime":function(){this.$route.query.params=null},"search.type":function(){this.$route.query.params=null},"search.alarmTypeIds":function(){this.$route.query.params=null}}},s=(a("4703"),a("2877")),l=Object(s.a)(n,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"travelstatistics"},[a("cv-operation",{attrs:{position:"left"}},[a("el-form-item",{attrs:{label:"查询区间:"}},[a("el-select",{model:{value:e.search.dateType,callback:function(t){e.$set(e.search,"dateType",t)},expression:"search.dateType"}},e._l(e._searchRangerLists,function(e){return a("el-option",{key:e.key,attrs:{value:e.key,label:e.name}})}),1)],1),a("dangeractionSwitchdate",{attrs:{type:e.search.dateType},model:{value:e.search.searchtime,callback:function(t){e.$set(e.search,"searchtime",t)},expression:"search.searchtime"}}),a("el-form-item",{attrs:{label:"报警方式:"}},[a("el-select",{model:{value:e.alertType,callback:function(t){e.alertType=t},expression:"alertType"}},[a("el-option",{attrs:{value:"1",label:"疲劳报警"}}),a("el-option",{attrs:{value:"2",label:"ADAS报警"}})],1)],1),a("el-form-item",{attrs:{label:"报警类型:"}},[a("el-select",{staticStyle:{width:"245px"},attrs:{size:"small",multiple:"","collapse-tags":""},model:{value:e.search.alarmTypeIds,callback:function(t){e.$set(e.search,"alarmTypeIds",t)},expression:"search.alarmTypeIds"}},e._l(e.alarmArray,function(e){return a("el-option",{key:e.code,attrs:{value:e.code,label:e.codeText}})}),1)],1),a("el-form-item",[a("cv-tool",{staticStyle:{margin:"0px"},attrs:{name:e.$route.name,data:e.$store.getters.monitorMenu,"is-add":!1,"is-modify":!1,"is-remove":!1},on:{export:e.down,search:e.sendSearch}})],1)],1),a("cv-publictree-content",{attrs:{model:"single","vehicle-monitor":e.handlerVehicleMonitor,loading:e.treeLoading}},[a("cv-grid",{ref:"travelstatistics",attrs:{isInitial:!1,params:e.grid,url:"/vtrack/findVehicleTravelAlarm"}},[a("el-table-column",{attrs:{label:"行程","header-align":"center",type:"index",index:e.indexMethod,align:"center"}}),a("el-table-column",{attrs:{label:"车牌号","header-align":"center",align:"center",prop:"plateCode"}}),a("el-table-column",{attrs:{label:"时间段","header-align":"center",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                              "+e._s(e.timer(t.row))+"\n                          ")]}}])}),a("el-table-column",{attrs:{label:"开始地址","header-align":"center",prop:"startLocDesc",align:"center"}}),a("el-table-column",{attrs:{label:"结束地址","header-align":"center",prop:"endLocDesc",align:"center"}}),a("el-table-column",{attrs:{label:"报警数","header-align":"center",prop:"alarmCount",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("cv-span",{attrs:{type:"danger"},nativeOn:{click:function(a){return e.popover(t.row)}}},[e._v("\n                                      "+e._s(e.alarmCount(t.row))+"\n                                ")])]}}])})],1)],1),a("el-dialog",{attrs:{title:e.dialog.title,visible:e.dialog.flag},on:{"update:visible":function(t){return e.$set(e.dialog,"flag",t)}}},[e._l(e.dialog.data,function(t){return a("el-button",{key:t,staticStyle:{display:"inline-block",margin:"5px"},attrs:{type:"danger"}},[e._v(e._s(t))])}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialog.flag=!1}}},[e._v("确 定")])],1)],2)],1)},[],!1,null,null,null).exports;t.default=l},e554:function(e,t,a){}}]);