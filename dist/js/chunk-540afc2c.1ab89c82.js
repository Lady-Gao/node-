(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-540afc2c"],{"05c0":function(e,t,n){"use strict";n("7f7f"),n("20d6"),n("ac6a");var i=n("cebc"),o=n("3f4e"),c=n("2f62"),a={name:"CvPublictreeContent",components:{CvContent:o.a},props:{model:String,vehicleMonitor:Function,loading:Boolean,noresize:{default:!1,type:Boolean}},data:function(){return{entryList:[],condition:""}},computed:Object(i.a)({},Object(c.c)(["onlineList","isAttention","socketEnterprise","socketVehicle","vehicle_data","vehicleCondition"]),{isCheck:function(){switch(this.model){case"multi":return!0;case"single":default:return!1}},_treeMethods:function(){return this.$refs.tabs},_contentMethods:function(){return this.$refs.content}}),beforeDestroy:function(){var e=this._treeMethods.getAllNodes;this.setStoreVehicleSearchCondition(this.condition),this.setStoreVehicleData(e())},mounted:function(){var e=this._treeMethods.$refs.tree.reference().ztreeApi;e()&&e().checkAllNodes(!1)},methods:Object(i.a)({},Object(c.b)(["setStoreVehicleData","setStoreVehicleSearchCondition"]),{handlerVehicleSearch:function(e){this.condition=e},vehicle_Monitor:function(e){var t=e.data;if(e.name,"function"==typeof this.vehicleMonitor)switch(this.model){case"multi":return this.vehicle_Monitor_multi(e);case"single":return this.vehicleMonitor(t[0])}},vehicle_Monitor_multi:function(e){var t=this,n=e.data;switch(e.name){case"check":this.entryList=this.entryList.concat(n);break;case"cancel":n.forEach(function(e){var n=t.entryList.findIndex(function(t){return t.id==e.id});0<=n&&t.entryList.splice(n,1)})}this.vehicleMonitor(this.entryList)}})},l=(n("45d7"),n("2877")),s=Object(l.a)(a,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("cv-content",{ref:"content",attrs:{loading:e.loading,noresize:e.noresize}},[e.model?n("cv-tabs-tree",{ref:"tabs",staticClass:"vehiclemaster-tree",attrs:{slot:"aside","vehicle-search":e.vehicleCondition,"is-checked":e.isCheck,"tree-data":e.vehicle_data,"online-monitor":e.onlineList,"vehicle-monitor":e.socketVehicle,"attention-monitor":e.isAttention,"enterprise-fleet-monitor":e.socketEnterprise,"node-monitor":e.vehicle_Monitor},on:{"vehicle-choose-search":e.handlerVehicleSearch},slot:"aside"}):e._e(),e._t("default")],2)},[],!1,null,"2dfdf41b",null).exports;s.install=function(e){e.component(s.name,s)},t.a=s},"1bd0":function(e,t,n){"use strict";var i=n("8d7d");n.n(i).a},"20dd":function(e,t,n){},"45d7":function(e,t,n){"use strict";var i=n("6e18");n.n(i).a},"6e18":function(e,t,n){},"729d":function(e,t,n){"use strict";var i=n("d801");n.n(i).a},"8a8b":function(e,t,n){"use strict";n.r(t),n("ac6a");var i={mixins:[],props:{options:{}},computed:{_table11:function(){return this.$refs.tablegrid}},data:function(){return{power:[],grid:{},multipleSelection:[],fence:{fenceName:"",fenceType:""},fenceType:[{value:null,label:this.$t("action.all")},{value:"1",label:this.$t("common.fence.circle")},{value:"2",label:this.$t("common.fence.rectangle")},{value:"3",label:this.$t("common.fence.polygon")},{value:"4",label:this.$t("common.fence.line")}]}},methods:{searchfences:function(){this.searchClickLoadGrid()},searchClickLoadGrid:function(){var e=this;this.grid={current:this._table11.current,size:this._table11.size,ruleName:this.fence.fenceName,ruleType:this.fence.fenceType,vehicleId:this.options.vid,typeName:this.options.sType},setTimeout(function(){e._table11.tableInitial()},200)},handleSelectionChange:function(e){this.options.multipleSelection=e},filterFenceType:function(e){switch(e.ruleType){case 1:return this.$t("common.fence.circle");case 2:return this.$t("common.fence.rectangle");case 3:return this.$t("common.fence.polygon");case 4:return this.$t("common.fence.line")}},filterType:function(e){switch(e.type){case 103:return"渣土";case 101:return"部标"}},save:function(e){for(var t="",n=0;n<this.options.multipleSelection.length;n++)t+=this.options.multipleSelection[n].id,n!=this.options.multipleSelection.length-1&&(t+=",");if(t){var i={fenceIds:t,vehicleId:this.options.vid,deliveryType:e};"更新围栏"==this.options.title?this.updataFence(i):"选择围栏"==this.options.title&&this.editFence(i)}else this.$message.error({message:"请选择围栏"})},editFence:function(e){var t=this;this.$store.dispatch("sendrulebyvehicleid",e).then(function(e){e.flag&&(t.$emit("confirm"),t.$message.success(t.$t("action.addSuccess"))),!e.flag&&e.errorCode&&t.$message.error({message:t.$t("error."+e.errorCode)}),t.options.flag=!1})},updataFence:function(e){var t=this;this.$store.dispatch("renewRuleByVehicleId",e).then(function(e){e.flag&&(t.$emit("confirm"),t.$message.success("更新指令已下发，等待设备响应")),!e.flag&&e.errorCode&&t.$message.error(t.$t("error."+e.errorCode)),t.options.flag=!1})}},watch:{"options.flag":function(e){e||(this.options.name="",this.options.multipleSelection.length=0)}}},o=(n("1bd0"),n("2877")),c=Object(o.a)(i,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fenceSend"},[n("el-row",[n("el-form",{staticStyle:{float:"right","margin-top":"9px"},attrs:{inline:!0}},[n("el-form-item",{attrs:{label:e.$t("fenceManage.ruleName"),prop:"fenceName"}},[n("el-input",{attrs:{size:"small",placeholder:e.$t("placeholder.inputValue")},model:{value:e.fence.fenceName,callback:function(t){e.$set(e.fence,"fenceName",t)},expression:"fence.fenceName"}})],1),n("el-form-item",{attrs:{label:e.$t("fenceManage.ruleType"),prop:"fenceType"}},[n("el-select",{staticStyle:{width:"120px"},attrs:{size:"small",placeholder:e.$t("placeholder.selectValue")},model:{value:e.fence.fenceType,callback:function(t){e.$set(e.fence,"fenceType",t)},expression:"fence.fenceType"}},e._l(e.fenceType,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),n("el-button",{staticStyle:{float:"right"},on:{click:e.searchfences}},[e._v("搜索")])],1)],1),n("cv-grid",{ref:"tablegrid",attrs:{params:e.grid,url:"/fenece/queryfencerulepage"},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"47"}}),n("el-table-column",{attrs:{label:e.$t("fenceManage.ruleName"),prop:"ruleName"}}),n("el-table-column",{attrs:{label:e.$t("fenceManage.ruleType"),formatter:e.filterFenceType,prop:"ruleType"}}),n("el-table-column",{attrs:{label:e.$t("fenceSend.classification"),formatter:e.filterType,prop:"type"}}),n("el-table-column",{attrs:{label:e.$t("fenceManage.remark"),prop:"remarksss"}})],1),n("el-row",{staticClass:"dialog-footer"},[2==e.options.sType?n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save(1)}}},[e._v("平台下发")]):e._e(),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save(2)}}},[e._v("终端下发")]),n("el-button",{on:{click:function(t){e.options.flag=!1}}},[e._v(e._s(e.$t("action.cancel")))])],1)],1)},[],!1,null,null,null).exports,a={mixins:[],props:{options:{}},data:function(){return{radio2:"",loading:!1,polyType:"",radio:""}},methods:{save:function(){var e=this,t={vehicleId:this.options.vid,polygonType:this.polyType};t.type=this.radio,this.loading=!0,this.$store.dispatch("delAllFenceByType",t).then(function(t){e.loading=!1,t.flag?(e.$message.success(e.$t("action.removeSuccess")),e.$emit("confirm"),e.options.flag=!1):e.$message.error({message:e.$t("error."+t.errorCode)})}).catch(function(){e.loading=!1})}},watch:{"options.flag":function(e){e||(this.options.name="")},radio2:function(e){3==e?(this.radio=e,this.polyType="101"):5==e?(this.radio=3,this.polyType="103"):(this.radio=e,this.polyType="")}}},l=(n("cae8"),{components:{fenceAction:c,remove:Object(o.a)(a,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fence-remove"},[n("p",{staticStyle:{"margin-bottom":"20px"}},[e._v("请选择你要批量删除的围栏类型")]),n("el-radio-group",{staticStyle:{"margin-bottom":"20px"},model:{value:e.radio2,callback:function(t){e.radio2=t},expression:"radio2"}},[n("el-radio",{attrs:{label:"1"}},[e._v(e._s("圆形围栏"))]),n("el-radio",{attrs:{label:"2"}},[e._v(e._s("矩形围栏"))]),n("el-radio",{attrs:{label:"3"}},[e._v(e._s("多边形围栏"))]),n("el-radio",{attrs:{label:"4"}},[e._v(e._s("线形围栏"))]),n("el-radio",{attrs:{label:"5"}},[e._v(e._s("渣土区域围栏"))])],1),n("div",{staticClass:"dialog-footer"},[n("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("action.confirm")))]),n("el-button",{on:{click:function(t){e.options.flag=!1}}},[e._v(e._s(e.$t("action.cancel")))])],1)],1)},[],!1,null,"06e4dd10",null).exports,CvPublictreeContent:n("05c0").a},data:function(){return{content:{contentLoading:!1,data:[],selectItem:{}},mixins:[],dialog:{name:"fenceAction",flag:!1,title:this.$t("fenceSend.checkFence"),size:"dialog-large",multipleSelection:[],vid:0},vehicleIds:[],grid:{vehicleId:""},multipleSelection:[]}},computed:{_table:function(){return this.$refs.fenceSend}},methods:{handlerVehicleMonitor:function(e){this.grid.vehicleId!=e.id&&(this.grid.vehicleId=e.id,this.dialog.vid=e.id,this._table.tableInitial())},confirm:function(){this._table.tableInitial()},nodeClick:function(e){this.dialog.vid=e.id,this._table.tableInitial()},addFenceSend:function(){""!=this.dialog.vid?(this.dialog.flag=!0,this.dialog.title=this.$t("fenceSend.checkFence"),this.dialog.sType=2,this.dialog.multipleSelection=[],this.dialog.name="fenceAction"):this.$message.warning({message:this.$t("fenceSend.choseVehicle")})},remove:function(){""!=this.dialog.vid?(this.dialog.flag=!0,this.dialog.title="删除",this.dialog.size="dialog-small",this.dialog.name="remove"):this.$message.warning({message:this.$t("fenceSend.choseVehicle")})},updateFence:function(e){var t=this,n={fenceId:e.row.id,vehicleId:this.dialog.vid};this.$store.dispatch("updaterulebyvehicleid",n).then(function(e){e.flag&&(t._table.tableInitial(),t.$message.success(t.$t("action.orderSuccess"))),!e.flag&&e.errorCode&&t.$message.error({message:t.$t("error."+e.errorCode)})})},edit:function(){""!=this.dialog.vid?(this.dialog.flag=!0,this.dialog.name="fenceAction",this.dialog.sType=1,this.dialog.title="更新围栏"):this.$message.warning({message:this.$t("fenceSend.choseVehicle")})},removeFence:function(e){var t=this;this.$confirm(this.$t("action.confirmIsRemove"),this.$t("action.tip"),{confirmButtonText:this.$t("action.confirm"),cancelButtonText:this.$t("action.cancel"),type:"warning"}).then(function(){var n=e.row,i={fenceId:n.id,vehicleId:t.dialog.vid,type:n.type,deliveryType:n.deliveryType};t.$store.dispatch("deleteFenceRuleByOrder",i).then(function(e){e.flag&&(t._table.tableInitial(),t.$message.success(t.$t("action.orderSuccess"))),!e.flag&&e.errorCode&&t.$message.error({message:t.$t("error."+e.errorCode)})})}).catch(function(){t.$message.info({message:t.$t("action.cancelRemove")})})},handleSelectionChange:function(e){var t=this;this.multipleSelection=e,this.vehicleIds=[],this.multipleSelection.forEach(function(e){t.vehicleIds.push(e.id)})},filterFenceType:function(e){switch(e.ruleType){case 1:return this.$t("common.fence.circle");case 2:return this.$t("common.fence.rectangle");case 3:return this.$t("common.fence.polygon");case 4:return this.$t("common.fence.line")}},sendTypeRule:function(e){return 1==e.deliveryType?"平台下发":"终端下发"}}}),s=(n("729d"),Object(o.a)(l,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main"},[n("cv-operation",[n("el-form-item",{staticStyle:{float:"right"}},[n("el-button",{on:{click:e.addFenceSend}},[e._v("新增围栏")]),n("el-button",{on:{click:e.remove}},[e._v("删除围栏")]),n("el-button",{on:{click:e.edit}},[e._v("更新围栏到设备")])],1)],1),n("cv-content",{staticStyle:{top:"50px"}},[n("cv-publictree-content",{ref:"table",attrs:{model:"single","vehicle-monitor":e.handlerVehicleMonitor,loading:e.content.contentLoading}},[n("cv-grid",{ref:"fenceSend",attrs:{params:e.grid,url:"/fencesend/queryrulebyvehicleid"}},[n("el-table-column",{attrs:{label:e.$t("fenceManage.ruleName"),prop:"ruleName"}}),n("el-table-column",{attrs:{label:e.$t("fenceManage.ruleType"),prop:"ruleType",formatter:e.filterFenceType}}),n("el-table-column",{attrs:{label:e.$t("fenceManage.remark"),prop:"remark"}}),n("el-table-column",{attrs:{label:e.$t("fenceManage.ruleSendType"),prop:"deliveryType",formatter:e.sendTypeRule}}),n("el-table-column",{attrs:{label:e.$t("fenceManage.options")},scopedSlots:e._u([{key:"default",fn:function(t){return[n("cv-table-tool",{attrs:{name:e.$route.name,data:e.$store.getters.monitorMenu,"is-modify":1!=t.row.deliveryType,"is-senddown":!1},on:{modify:function(n){return e.updateFence(t)},remove:function(n){return e.removeFence(t)}}})]}}])})],1)],1)],1),n("el-dialog",{attrs:{"close-on-click-modal":!1,visible:e.dialog.flag,title:e.dialog.title,"custom-class":e.dialog.size},on:{"update:visible":function(t){return e.$set(e.dialog,"flag",t)}}},[n(e.dialog.name,{tag:"component",attrs:{options:e.dialog},on:{confirm:e.confirm}})],1)],1)},[],!1,null,null,null).exports);t.default=s},"8d7d":function(e,t,n){},cae8:function(e,t,n){"use strict";var i=n("20dd");n.n(i).a},d801:function(e,t,n){}}]);