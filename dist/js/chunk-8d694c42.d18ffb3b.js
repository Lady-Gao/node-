(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-8d694c42"],{"05c0":function(t,e,i){"use strict";i("7f7f"),i("20d6"),i("ac6a");var n=i("cebc"),r=i("3f4e"),s=i("2f62"),a={name:"CvPublictreeContent",components:{CvContent:r.a},props:{model:String,vehicleMonitor:Function,loading:Boolean,noresize:{default:!1,type:Boolean}},data:function(){return{entryList:[],condition:""}},computed:Object(n.a)({},Object(s.c)(["onlineList","isAttention","socketEnterprise","socketVehicle","vehicle_data","vehicleCondition"]),{isCheck:function(){switch(this.model){case"multi":return!0;case"single":default:return!1}},_treeMethods:function(){return this.$refs.tabs},_contentMethods:function(){return this.$refs.content}}),beforeDestroy:function(){var t=this._treeMethods.getAllNodes;this.setStoreVehicleSearchCondition(this.condition),this.setStoreVehicleData(t())},mounted:function(){var t=this._treeMethods.$refs.tree.reference().ztreeApi;t()&&t().checkAllNodes(!1)},methods:Object(n.a)({},Object(s.b)(["setStoreVehicleData","setStoreVehicleSearchCondition"]),{handlerVehicleSearch:function(t){this.condition=t},vehicle_Monitor:function(t){var e=t.data;if(t.name,"function"==typeof this.vehicleMonitor)switch(this.model){case"multi":return this.vehicle_Monitor_multi(t);case"single":return this.vehicleMonitor(e[0])}},vehicle_Monitor_multi:function(t){var e=this,i=t.data;switch(t.name){case"check":this.entryList=this.entryList.concat(i);break;case"cancel":i.forEach(function(t){var i=e.entryList.findIndex(function(e){return e.id==t.id});0<=i&&e.entryList.splice(i,1)})}this.vehicleMonitor(this.entryList)}})},o=(i("45d7"),i("2877")),c=Object(o.a)(a,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("cv-content",{ref:"content",attrs:{loading:t.loading,noresize:t.noresize}},[t.model?i("cv-tabs-tree",{ref:"tabs",staticClass:"vehiclemaster-tree",attrs:{slot:"aside","vehicle-search":t.vehicleCondition,"is-checked":t.isCheck,"tree-data":t.vehicle_data,"online-monitor":t.onlineList,"vehicle-monitor":t.socketVehicle,"attention-monitor":t.isAttention,"enterprise-fleet-monitor":t.socketEnterprise,"node-monitor":t.vehicle_Monitor},on:{"vehicle-choose-search":t.handlerVehicleSearch},slot:"aside"}):t._e(),t._t("default")],2)},[],!1,null,"2dfdf41b",null).exports;c.install=function(t){t.component(c.name,c)},e.a=c},1708:function(t,e,i){"use strict";var n=i("19f0");i.n(n).a},"19f0":function(t,e,i){},"45d7":function(t,e,i){"use strict";var n=i("6e18");i.n(n).a},"6e18":function(t,e,i){},7353:function(t,e,i){"use strict";i.r(e),i("ac6a"),i("a481");var n={props:{data:{},carItem:{},options:{}},components:{},mixins:[i("b0ad").a],data:function(){return{carItems:[],runArray:[],tooltipContent:""}},watch:{data:function(t){this.runArray=[],this.splitTime(t)},carItem:function(t){var e=this,i=[];this.carItems=t,this.runArray&&(this.carItems.forEach(function(t){if(e.runArray[t.id]){var n=e.runArray[t.id];i[t.id]=n}}),this.runArray=i)}},methods:{splitTime:function(t){for(var e=this.carItems,i=this,n=0;n<e.length;n++){var r=e[n].id;t[r]&&t[r].forEach(function(t){var e=t.startTime;e=new Date(e);var n=new Date(Date.parse((i.options.startTime+" 00:00").replace(/-/g,"/"))),r=new Date(Date.parse((i.options.endTime+" 23:59").replace(/-/g,"/"))),s=(e.getTime()-n.getTime())/(r.getTime()-n.getTime())*100;s=s.toFixed(2),t.timeF=s,t.percent=100*t.percent+"%"})}this.runArray=t}}},r=(i("1708"),i("2877")),s={components:{vehicleRun:Object(r.a)(n,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"g-axis"},[t._m(0),i("table",{staticClass:"table table-bordered table-oper"},[t._m(1),i("tbody",{attrs:{id:"Timeline"}},t._l(t.carItems,function(e){return 0<t.carItem.length?i("tr",{key:e.id,staticClass:"state-tr"},[i("th",{attrs:{"data-carId":e.id}},[t._v(t._s(e.plateCode))]),i("td",[i("div",{staticClass:"state-list unstyled"},t._l(t.runArray[e.id],function(e){return i("i",{key:e.vehicleId,staticClass:"run",style:{width:e.percent,left:e.timeF+"%"},on:{mouseenter:function(i){t.tooltipContent=t.mouseenterShowTip(i,"runtimeTip",e)},mouseleave:function(e){return t.mouseoverHideTip("runtimeTip")}}})}),0)])]):t._e()}),0)]),i("el-tooltip",{ref:"runtimeTip",attrs:{content:t.tooltipContent,placement:"top",effect:"light"}})],1)},[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"g-hd"},[i("h3",{staticClass:"u-h3"},[t._v("车辆运行时间轴")]),i("div",{staticClass:"m-info"},[i("span",{staticClass:"block b2"}),t._v(" 正常 \n            "),i("span",{staticClass:"block b1"}),t._v(" 未运行\n        ")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",{staticClass:"disabled time-tr"},[e("th",{staticClass:"th-title"},[this._v("车牌号")]),e("td",[e("ul",{staticClass:"time-list unstyled clearfix",attrs:{id:"timeList"}},[this._v(" \n                    ")])])])])}],!1,null,null,null).exports,CvPublictreeContent:i("05c0").a},data:function(){return{time:[this.$filter.timeStamp(this.$filter.format(new Date(new Date-1728e5),"yyyy-MM-dd")),this.$filter.timeStamp(this.$filter.format(new Date(new Date-864e5),"yyyy-MM-dd"))],options:{startTime:"",endTime:""},loading:!1,vehicleArray:[],runItem:[],vehicleObj:[],pickerOption:{disabledDate:function(t){return t.getTime()>Date.now()-864e5}}}},methods:{handlerVehicleMonitor:function(t){var e=this;this.vehicleArray=[],(this.vehicleObj=t).forEach(function(t){e.vehicleArray.push(t.id)})},search:function(){var t=this,e=this.getData();e&&(this.loading=!0,this.$store.dispatch("findVehicleOperationListInfo",e).then(function(e){e.flag?t.runItem=e.data:t.$message.error(t.$t("error."+e.errorCode)),t.loading=!1}).catch(function(){t.$message.error("服务器报错"),t.loading=!1}))},getData:function(){var t=this.$filter.timeRange(this.$filter.format(this.time[0],"yyyy-MM-dd"),this.$filter.format(this.time[1],"yyyy-MM-dd"));if(0==this.vehicleArray.length)return this.$message.warning("请选择左侧车辆!"),!1;if(!this.time[0])return this.$message.warning("查询时间不能为空!"),!1;if(7<t)return this.$message.warning("查询时间不能超过7天!"),!1;var e={startTime:this.$filter.format(this.time[0],"yyyy-MM-dd start"),endTime:this.$filter.format(this.time[1],"yyyy-MM-dd end"),vehicleIds:this.vehicleArray.join(",")};return this.options.startTime=this.$filter.format(this.time[0],"yyyy-MM-dd"),this.options.endTime=this.$filter.format(this.time[1],"yyyy-MM-dd"),this.splitTimeShow(parseInt(t)+1,this.options.startTime,this.options.endTime),e},splitTimeShow:function(t,e,i){for(var n,r=120*t,s="",a=this.$filter.getDays(e,i),o=a[0],c=0,l=0;l<12;l++)1440*(c+1)<(n=r*l)&&(o=a[++c]),s=0!=l?11!=l?s+"<li><span>"+o+"<br>"+this.$filter.toHourMinute(n)+"</span></li>":s+'<li class="last"><span class="l1">'+o+"<br>"+this.$filter.toHourMinute(n)+'</span><span class="l2">'+o+"<br>23:59</span></li>":s+"<li><span>"+o+"<br>00:00</span></li>";$("#timeList").html(s);for(var h=0;h<a.length;h++)$(".time-list span").prepend()}}},a=(i("cf789"),Object(r.a)(s,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"vehicleDriveOperation"},[i("cv-operation",{attrs:{position:"left"}},[i("el-form-item",{attrs:{label:"起止时间"}},[i("el-date-picker",{staticStyle:{width:"260px"},attrs:{editable:!1,clearable:!1,size:"small",type:"daterange",placeholder:"选择时间范围","picker-options":t.pickerOption},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),i("el-form-item",{staticStyle:{float:"right"}},[i("cv-tool",{staticStyle:{margin:"0px"},attrs:{name:t.$route.name,data:t.$store.getters.monitorMenu,"is-modify":!1,"is-remove":!1,"is-add":!1,"is-export":!1},on:{search:t.search}})],1)],1),i("cv-publictree-content",{ref:"tabs",attrs:{model:"multi","vehicle-monitor":t.handlerVehicleMonitor,loading:!1}},[i("vehicleRun",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"el-tabs__content",staticStyle:{width:"100%"},attrs:{data:t.runItem,carItem:t.vehicleObj,options:t.options}})],1)],1)},[],!1,null,null,null).exports);e.default=a},b0ad:function(t,e,i){"use strict";(function(t){i("7f7f"),e.a={methods:{confirmPrompt:function(t,e){var i=this,n=t||this.$t("action.confirmIsRemove");return new Promise(function(t,r){i.$confirm(n,i.$t("action.tip"),{confirmButtonText:i.$t("action.confirm"),cancelButtonText:i.$t("action.cancel"),type:"warning"}).then(function(){t()}).catch(function(){"function"==typeof e&&e()})})},timeLimitFunc:function(t,e,i){if(t&&e)return((new Date(e)-new Date(t))/864e5).toFixed(1)<=i||this.$message.error({message:this.$t("请选择时间范围在"+i+"天内")});this.$message.error({message:this.$t("请选择时间范围")})},addRemoveUnique:function(t,e,i){var n=t.length,r=e.length;return r<n?{name:"add",data:this.$service.isUnique(t,e,i)}:n<r?{name:"remove",data:this.$service.isUnique(e,t,i)}:n==r?{name:"equal",data:this.$service.isUnique(t,e,i)}:void 0},showTooltip:function(t,e){var i=t.target,n=this.$refs[e];n.referenceElm=i,n.$refs.popper.style.display="none",n.doDestroy(),n.setExpectedState(!0),n.handleShowPopper()},mouseenterShowTip:function(t,e,i){var n=t.target;if(n.scrollWidth>n.offsetWidth||i)return this.showTooltip(t,e),i?i.startTime+"~"+i.endTime:n.innerText},mouseenterShowToolTip:function(t,e,i){var n=t.target;return this.showTooltip(t,e),!i&&n.innerText},mouseoverHideTip:function(t){var e=this.$refs[t];e&&(e.setExpectedState(!1),e.handleClosePopper())},asyncDownloadScript:function(e,i){var n=this,r=0<arguments.length&&void 0!==e?e:"Baidu",s=1<arguments.length?i:void 0;return t[r]?t[r]._preloader?t[r]._preloader:Promise.resolve(t[r]):(t[r]={},t[r]._preloader=new Promise(function(e,i){var a=document.createElement("script");a.src=s,t.document.body.appendChild(a),n.$service.isIe()&&n.$service.IE_VERSION<11?a.onreadystatechange=function(){"loaded"!=a.readyState&&"complete"!=a.readyState||(e(t[r]),t[r]._preloader=null)}:a.onload=function(){e(t[r]),t[r]._preloader=null}}),t[r]._preloader)}}}}).call(this,i("c8ba"))},b37d:function(t,e,i){},cf789:function(t,e,i){"use strict";var n=i("b37d");i.n(n).a}}]);