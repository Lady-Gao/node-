(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-331619a5"],{"05c0":function(e,t,i){"use strict";i("7f7f"),i("20d6"),i("ac6a");var s=i("cebc"),n=i("3f4e"),o=i("2f62"),a={name:"CvPublictreeContent",components:{CvContent:n.a},props:{model:String,vehicleMonitor:Function,loading:Boolean,noresize:{default:!1,type:Boolean}},data:function(){return{entryList:[],condition:""}},computed:Object(s.a)({},Object(o.c)(["onlineList","isAttention","socketEnterprise","socketVehicle","vehicle_data","vehicleCondition"]),{isCheck:function(){switch(this.model){case"multi":return!0;case"single":default:return!1}},_treeMethods:function(){return this.$refs.tabs},_contentMethods:function(){return this.$refs.content}}),beforeDestroy:function(){var e=this._treeMethods.getAllNodes;this.setStoreVehicleSearchCondition(this.condition),this.setStoreVehicleData(e())},mounted:function(){var e=this._treeMethods.$refs.tree.reference().ztreeApi;e()&&e().checkAllNodes(!1)},methods:Object(s.a)({},Object(o.b)(["setStoreVehicleData","setStoreVehicleSearchCondition"]),{handlerVehicleSearch:function(e){this.condition=e},vehicle_Monitor:function(e){var t=e.data;if(e.name,"function"==typeof this.vehicleMonitor)switch(this.model){case"multi":return this.vehicle_Monitor_multi(e);case"single":return this.vehicleMonitor(t[0])}},vehicle_Monitor_multi:function(e){var t=this,i=e.data;switch(e.name){case"check":this.entryList=this.entryList.concat(i);break;case"cancel":i.forEach(function(e){var i=t.entryList.findIndex(function(t){return t.id==e.id});0<=i&&t.entryList.splice(i,1)})}this.vehicleMonitor(this.entryList)}})},c=(i("45d7"),i("2877")),r=Object(c.a)(a,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("cv-content",{ref:"content",attrs:{loading:e.loading,noresize:e.noresize}},[e.model?i("cv-tabs-tree",{ref:"tabs",staticClass:"vehiclemaster-tree",attrs:{slot:"aside","vehicle-search":e.vehicleCondition,"is-checked":e.isCheck,"tree-data":e.vehicle_data,"online-monitor":e.onlineList,"vehicle-monitor":e.socketVehicle,"attention-monitor":e.isAttention,"enterprise-fleet-monitor":e.socketEnterprise,"node-monitor":e.vehicle_Monitor},on:{"vehicle-choose-search":e.handlerVehicleSearch},slot:"aside"}):e._e(),e._t("default")],2)},[],!1,null,"2dfdf41b",null).exports;r.install=function(e){e.component(r.name,r)},t.a=r},1647:function(e,t,i){},"45d7":function(e,t,i){"use strict";var s=i("6e18");i.n(s).a},"496a":function(e,t,i){"use strict";var s=i("1647");i.n(s).a},"6e18":function(e,t,i){},a48e:function(e,t,i){"use strict";i.r(t),i("96cf");var s,n=i("3b8d"),o={components:{CvPublictreeContent:i("05c0").a},data:function(){return{searchOptions:{vehicleId:null,totalTimeSeconds:120,intervalSeconds:10},loading:!1,vehicleMess:{},timer:null,count:0,seconds:1e3,vehicleId:null}},computed:{_mapMethods:function(){return this.$refs.map.mapMethods}},methods:{handlerVehicleMonitor:function(e){this.vehicleMess={},this._mapMethods.clearOverlays(),this.vehicleId=e.id,this.clearTimerAndCount(),this.getMultiVehicleLastLocationList(e.id)},getMultiVehicleLastLocationList:(s=Object(n.a)(regeneratorRuntime.mark(function e(t){var i,s,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,this.$store.dispatch("getMultiVehicleLastLocationList",{vehicleIds:t,mapType:this.$store.getters.mapType});case 3:i=e.sent,s=i.data,n=i.flag,this.loading=!1,this.searchOptions.vehicleId=t,n&&!s.errorCode?(this.vehicleMess=s[0],this.showCarPosition(this.vehicleMess)):(this.$message.error("暂无数据!"),this.vehicleMess={});case 9:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)}),trackCallbackEvent:function(e){this.clearTimerAndCount(),e&&(this.count=Math.ceil(this.searchOptions.totalTimeSeconds/this.searchOptions.intervalSeconds),this.cyclicQueryLocation())},cyclicQueryLocation:function(){var e=this;if(this.count<=0)return this.clearTimerAndCount();this.timer=setTimeout(function(){e.$store.dispatch("getMultiVehicleLastLocationList",{vehicleIds:e.vehicleId,mapType:e.$store.getters.mapType}).then(function(t){var i=t.flag,s=t.data;i&&s&&(e.vehicleMess=s[0],e.count--,e.cyclicQueryLocation())})},this.searchOptions.intervalSeconds*this.seconds)},clearTimerAndCount:function(){this.count=0,clearTimeout(this.timer),this.timer=null},showCarPosition:function(e){this._mapMethods.clearOverlays(),this.addPoint=this._mapMethods.mapAddpoint({longitude:e.mapLongitude,latitude:e.mapLatitude},this.$filter.isOnline(e,!1,this.$store.getters.mapName),{width:36,height:36}),this._mapMethods.addOverlay(this.addPoint),this._mapMethods.moveToCenter(this.addPoint.point)}},beforeDestroy:function(){this.clearTimerAndCount()}},a=(i("496a"),i("2877")),c=Object(a.a)(o,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"cv-vehicle-track"},[i("cv-operation",{attrs:{position:"left"}},[i("el-form-item",{attrs:{label:"持续时间(单位:S)"}},[i("el-input-number",{attrs:{size:"small",min:5},model:{value:e.searchOptions.totalTimeSeconds,callback:function(t){e.$set(e.searchOptions,"totalTimeSeconds",t)},expression:"searchOptions.totalTimeSeconds"}})],1),i("el-form-item",{attrs:{label:"发送频率(单位:S)"}},[i("el-input-number",{attrs:{size:"small",min:5},model:{value:e.searchOptions.intervalSeconds,callback:function(t){e.$set(e.searchOptions,"intervalSeconds",t)},expression:"searchOptions.intervalSeconds"}})],1),i("el-form-item",[i("el-button",{directives:[{name:"instruction",rawName:"v-instruction",value:{direct:!0,url:"/sendOrder/queryVehicleTrailCmd",params:e.searchOptions,callback:e.trackCallbackEvent},expression:"{\n                direct: true,\n                url: '/sendOrder/queryVehicleTrailCmd',\n                params: searchOptions,\n                callback: trackCallbackEvent\n            }"}],attrs:{type:"success",size:"small"}},[e._v("跟踪下发"+e._s(0<e.count?e.count:""))])],1)],1),i("cv-publictree-content",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{noresize:!0,model:"single","vehicle-monitor":e.handlerVehicleMonitor}},[i("cv-scrollbar",{staticClass:"vehicle-track-mess"},[i("el-form",{attrs:{"show-message":!1,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"设备响应时间:"}},[e._v("\n                    "+e._s(e._f("isValue")(e._f("format")(e.vehicleMess.gpsTime,"yyyy-MM-dd HH:mm:ss")))+"\n                ")]),i("el-form-item",{attrs:{label:"位置描述:"}},[e._v("\n                    "+e._s(e._f("isValue")(e.vehicleMess.locationDesc))+"\n                ")]),i("el-form-item",{attrs:{label:"位置信息状态:"}},[e._v("\n                    "+e._s(e._f("isValue")(e._f("locationStatus")(e.vehicleMess.locateStatus,!0)))+"\n                ")]),i("el-form-item",{attrs:{label:"经度:"}},[e._v("\n                    "+e._s(e._f("isValue")(e._f("toFixed")(e.vehicleMess.mapLongitude,6)))+"\n                ")]),i("el-form-item",{attrs:{label:"纬度:"}},[e._v("\n                    "+e._s(e._f("isValue")(e._f("toFixed")(e.vehicleMess.mapLatitude,6)))+"\n                ")]),i("el-form-item",{attrs:{label:"海拔高度(M):"}},[e._v("\n                    "+e._s(e._f("isValue")(e.vehicleMess.height,"m"))+"\n                ")]),i("el-form-item",{attrs:{label:"速度(km/h):"}},[e._v("\n                    "+e._s(e._f("isValue")("0.0"==e.vehicleMess.dspeed?"0.0"==e.vehicleMess.gpsSpeed?"":e.vehicleMess.gpsSpeed:e.vehicleMess.dspeed,"km/h"))+"\n                ")]),i("el-form-item",{attrs:{label:"GPS时间:"}},[e._v("\n                    "+e._s(e._f("isValue")(e._f("format")(e.vehicleMess.gpsTime,"yyyy-MM-dd HH:mm:ss")))+"\n                ")]),i("el-form-item",{attrs:{label:"GPS状态标签:"}}),i("el-form-item",{attrs:{label:"报警数目:"}},[e._v("\n                    "+e._s(e._f("isValue")(e.vehicleMess.alarmCount))+"\n                ")])],1)],1),i(e.$store.getters.mapName,{ref:"map",tag:"component",staticClass:"vehicle-track-map",attrs:{point:e.vehicleMess}})],1)],1)},[],!1,null,null,null).exports;t.default=c}}]);