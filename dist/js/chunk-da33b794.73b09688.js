(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-da33b794"],{"05c0":function(e,t,a){"use strict";a("7f7f"),a("20d6"),a("ac6a");var r=a("cebc"),n=a("3f4e"),s=a("2f62"),i={name:"CvPublictreeContent",components:{CvContent:n.a},props:{model:String,vehicleMonitor:Function,loading:Boolean,noresize:{default:!1,type:Boolean}},data:function(){return{entryList:[],condition:""}},computed:Object(r.a)({},Object(s.c)(["onlineList","isAttention","socketEnterprise","socketVehicle","vehicle_data","vehicleCondition"]),{isCheck:function(){switch(this.model){case"multi":return!0;case"single":default:return!1}},_treeMethods:function(){return this.$refs.tabs},_contentMethods:function(){return this.$refs.content}}),beforeDestroy:function(){var e=this._treeMethods.getAllNodes;this.setStoreVehicleSearchCondition(this.condition),this.setStoreVehicleData(e())},mounted:function(){var e=this._treeMethods.$refs.tree.reference().ztreeApi;e()&&e().checkAllNodes(!1)},methods:Object(r.a)({},Object(s.b)(["setStoreVehicleData","setStoreVehicleSearchCondition"]),{handlerVehicleSearch:function(e){this.condition=e},vehicle_Monitor:function(e){var t=e.data;if(e.name,"function"==typeof this.vehicleMonitor)switch(this.model){case"multi":return this.vehicle_Monitor_multi(e);case"single":return this.vehicleMonitor(t[0])}},vehicle_Monitor_multi:function(e){var t=this,a=e.data;switch(e.name){case"check":this.entryList=this.entryList.concat(a);break;case"cancel":a.forEach(function(e){var a=t.entryList.findIndex(function(t){return t.id==e.id});0<=a&&t.entryList.splice(a,1)})}this.vehicleMonitor(this.entryList)}})},o=(a("45d7"),a("2877")),c=Object(o.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("cv-content",{ref:"content",attrs:{loading:e.loading,noresize:e.noresize}},[e.model?a("cv-tabs-tree",{ref:"tabs",staticClass:"vehiclemaster-tree",attrs:{slot:"aside","vehicle-search":e.vehicleCondition,"is-checked":e.isCheck,"tree-data":e.vehicle_data,"online-monitor":e.onlineList,"vehicle-monitor":e.socketVehicle,"attention-monitor":e.isAttention,"enterprise-fleet-monitor":e.socketEnterprise,"node-monitor":e.vehicle_Monitor},on:{"vehicle-choose-search":e.handlerVehicleSearch},slot:"aside"}):e._e(),e._t("default")],2)},[],!1,null,"2dfdf41b",null).exports;c.install=function(e){e.component(c.name,c)},t.a=c},"31d3":function(e,t,a){},"45d7":function(e,t,a){"use strict";var r=a("6e18");a.n(r).a},"593e":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_exports__.a={props:{data:{type:Array,default:function(){return[]}},options:{},alarmList:{},gridH:{}},data:function(){return{alarmIds:[],test:"",wrongArr:[],table:[]}},methods:{selectAll:function(e){0!=e.length&&(this.options["param"+e[0].category],this.options["param"+e[0].category]=e)},blur:function blur(s,i){var reg=eval(s.row.regex);reg.test(s.row.paramValue)?this.wrongArr.splice(this.wrongArr.indexOf(i),1):this.wrongArr.push(i)}},created:function(){this.table=this.data},mounted:function(){}}},"6e18":function(e,t,a){},"74a5":function(e,t,a){"use strict";var r=a("31d3");a.n(r).a},e8c8:function(e,t,a){"use strict";a.r(t),a("ac6a"),a("96cf");var r,n,s,i,o=a("3b8d"),c=a("593e").a,l=a("2877"),h={components:{terminalDetail:Object(l.a)(c,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"treminal-params-detail"},[a("cv-grid",{ref:"multipleTable",attrs:{data:e.table,defaultHeight:parseInt(e.gridH)},on:{"selection-change":e.selectAll}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),a("el-table-column",{attrs:{label:this.$t("terminalParamSet.paramName"),prop:"name"}}),a("el-table-column",{attrs:{label:this.$t("terminalParamSet.serviceParam"),prop:"paramValue",width:"305"},scopedSlots:e._u([{key:"default",fn:function(t){return["61954"==t.row.terminalParamId?a("el-select",{attrs:{multiple:"","collapse-tags":"",placeholder:"请选择"},model:{value:t.row.paramValue,callback:function(a){e.$set(t.row,"paramValue",a)},expression:"scope.row.paramValue"}},e._l(e.alarmList,function(e){return a("el-option",{key:e.value,attrs:{label:e.alarmName,value:e.num}})}),1):e._e(),"61954"!==t.row.terminalParamId?a("el-input",{staticStyle:{width:"200px"},attrs:{size:"small"},on:{blur:function(a){return e.blur(t,t.$index)}},model:{value:t.row.paramValue,callback:function(a){e.$set(t.row,"paramValue","string"==typeof a?a.trim():a)},expression:"scope.row.paramValue"}}):e._e(),-1!=e.wrongArr.indexOf(t.$index)?a("span",{ref:"span",staticStyle:{color:"red"}},[e._v(" 格式错误!")]):e._e()]}}])}),a("el-table-column",{attrs:{label:this.$t("terminalParamSet.terminalReal"),prop:"terminalParamValue"}}),a("el-table-column",{attrs:{label:this.$t("terminalParamSet.paramDesc"),prop:"desc"}})],1)],1)},[],!1,null,null,null).exports,CvPublictreeContent:a("05c0").a},data:function(){return{header:{searchFlag:!1,updateFlag:!1,setFlag:!1,upFlag:!0,disFlag:!0,disFlag1:!0},content:{contentLoading:!1,data:[],cvHeight:0,selectItem:{}},common:{vehicleId:"",trackId:"",timer:null,setTime:null,layout:!1}}},methods:{single:(i=Object(o.a)(regeneratorRuntime.mark(function e(t){var a,r,n,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.content.contentLoading=!0,e.prev=1,this.initData(t.id),e.next=5,this.$store.dispatch("terminalquery",t.id);case 5:a=e.sent,r=a.data,n=a.flag,s=a.errorCode,n?0==r.length?(this.$message.error({message:this.$t("error.208")}),this.content.data=r):(this.content.data=r,this.header.disFlag=!1,this.header.disFlag1=!1):(this.content.data=[],this.$message.error({message:this.$t("error."+s)})),this.content.contentLoading=!1,this.common.layout=!0,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),this.content.contentLoading=!1;case 17:case"end":return e.stop()}},e,this,[[1,14]])})),function(e){return i.apply(this,arguments)}),initData:function(e){this.content.data=[],this.header.searchFlag=!1,this.header.upFlag=!0,clearTimeout(this.commonsetTime),this.common.setTime=null,this.common.vehicleId=e,this.content.selectItem=[]},search:(s=Object(o.a)(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("terminalupload",this.common.vehicleId);case 2:if(t=e.sent,a=t.data,t.flag){e.next=8;break}return this.$message.error({message:this.$t("error.7004")}),e.abrupt("return");case 8:this.header.searchFlag=!0,this.header.disFlag1=!0,this.common.trackId=a.id,this.common.timer=(new Date).getTime(),1==a.status?this.loopTrack():0==a.status?(this.header.searchFlag=!1,this.header.disFlag1=!1,this.$message.error({message:this.$t("error.7004")})):(this.header.searchFlag=!1,this.header.disFlag1=!1,this.$message.error({message:this.$t("terminalParamSet.searchFalse")}));case 13:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)}),update:(n=Object(o.a)(regeneratorRuntime.mark(function e(){var t,a,r,n,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this.content.data.forEach(function(e){e.params.forEach(function(e){var a={};a.paramValue=e.terminalParamValue,a.terminalParamId=e.terminalParamId,t.push(a)})}),a={vehicleId:this.common.vehicleId,params:JSON.stringify(t)},e.next=5,this.$http({url:"/terminalParam/update",data:JSON.stringify(a)});case 5:r=e.sent,n=r.flag,s=r.errorCode,n?this.$message.success({message:this.$t("action.updateSuccess")}):this.$message.error({message:this.$t("error."+s)});case 9:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)}),set:(r=Object(o.a)(regeneratorRuntime.mark(function e(){var t,a,r,n,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in t=[],this.content.selectItem)this.content.selectItem[r].forEach(function(e){var a={};a.paramValue=e.paramValue,a.terminalParamId=e.terminalParamId,a.terminalParam={dataType:e.dataType},t.push(a)});if(0!=t.length){e.next=6;break}this.$message.error({message:this.$t("terminalParamSet.selectOne")}),e.next=13;break;case 6:return a={vehicleId:this.common.vehicleId,params:JSON.stringify(t)},e.next=9,this.$http({url:"/terminalParam/set",data:JSON.stringify(a)});case 9:n=e.sent,s=n.flag,i=n.errorCode,s?this.$message.success({message:this.$t("action.orderSuccess")}):this.$message.error({message:this.$t("error."+i)});case 13:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)}),loopTrack:function(){var e=this,t=(new Date).getTime()-this.common.timer<12e4;this.$store.dispatch("trackSendFlag",this.common.trackId).then(function(a){if(a.flag)if(1==a.data.sendFlag)clearTimeout(e.common.setTime),e.common.setTime=null,setTimeout(function(){e.$store.dispatch("queryTerminalParams",e.common.trackId).then(function(t){t.flag?(e.content.data.forEach(function(e){e.params.forEach(function(e){e.terminalParamValue=t.data["paramId"+e.terminalParamId]})}),e.$message.success({message:e.$t("terminalParamSet.searchSuccess")}),e.header.upFlag=!1,e.header.disFlag1=!1,e.header.searchFlag=!1,e.header.updateFlag=!1,e.header.setFlag=!1):e.$message.error({message:e.$t("error."+t.errorCode)})})},2e3);else if(0!=a.data.sendFlag&&5!=a.data.sendFlag||!t){switch(a.data.sendFlag){case 2:e.$message.error({message:e.$t("设备不在线")});break;case 3:e.$message.error({message:e.$t("失败")});break;case 4:e.$message.error({message:e.$t("等待回应超时")});break;case 6:e.$message.error({message:e.$t("作废")});break;default:e.$message.error({message:e.$t("设备无应答")})}e.header.searchFlag=!1}else e.common.setTime=setTimeout(function(){e.loopTrack()},1500)})},handlerVehicleMonitor:function(e){this.single(e)}},mounted:function(){var e=this;this.$route.query.id&&this.single({id:this.$route.query.id}),setTimeout(function(){e.content.cvHeight=document.querySelector(".cv-content").clientHeight+"px"},500)}},m=(a("74a5"),Object(l.a)(h,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"terminal-params-set"},[a("cv-operation",[a("el-form-item",[a("el-button",{attrs:{size:"small",loading:e.header.searchFlag,disabled:e.header.disFlag},on:{click:e.search}},[e._v(e._s(this.$t("terminalParamSet.search")))]),a("el-button",{attrs:{size:"small",loading:e.header.updateFlag,disabled:e.header.upFlag},on:{click:e.update}},[e._v(e._s(this.$t("terminalParamSet.update")))]),a("el-button",{attrs:{size:"small",loading:e.header.setFlag,disabled:e.header.disFlag1},on:{click:e.set}},[e._v(e._s(this.$t("terminalParamSet.set")))])],1)],1),a("cv-publictree-content",{attrs:{model:"single","vehicle-monitor":e.handlerVehicleMonitor,loading:e.content.contentLoading}},[a("div",{directives:[{name:"show",rawName:"v-show",value:0<e.content.data.length,expression:"content.data.length>0"}],staticClass:"terminal-noempty"},[a("el-tabs",{attrs:{"tab-position":"left"}},e._l(e.content.data,function(t){return a("el-tab-pane",{key:t.categoryCode,attrs:{label:t.categoryName,name:t.categoryCode}},[a("terminalDetail",{attrs:{data:t.params,options:e.content.selectItem,gridH:parseInt(e.content.cvHeight)-30}})],1)}),1)],1)])],1)},[],!1,null,null,null).exports);t.default=m}}]);