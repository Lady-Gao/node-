(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4fc29378"],{3798:function(e,t,r){},"6794a":function(e,t,r){"use strict";var a=r("3798");r.n(a).a},"6fa1":function(e,t,r){"use strict";r.r(t),r("7f7f"),r("ac6a"),r("96cf");var a,n=r("3b8d"),i=r("cebc"),o=r("8ebd"),s=r("2f62"),l={components:{CvAreadrawmap:o.a},data:function(){return{typeName:"",label:"",fId:"",form:{enterpriseId:"",fleetId:"",name:"",detetailsDusts:[],list:[]},rules:{enterpriseId:[{required:!0,message:"内容不能为空"}],fleetId:[{required:!0,message:"内容不能为空"}],name:[{required:!0,message:"内容不能为空"}]},visible:!0}},computed:Object(i.a)({},Object(s.c)(["user"])),mounted:function(){this.typeName="modify"==this.$route.query.type?"修改工作路线":"新增工作路线"},methods:Object(i.a)({},Object(s.b)(["insertWorkLine","queryEnginePoint","queryWorkLine","updateWorkLine"]),{returnPage:function(){this.$router.push("/monitor/routerManage")},saveRouter:(a=Object(n.a)(regeneratorRuntime.mark(function e(t){var r,a,o,s,l=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],this.form.detetailsDusts=[],t.list.forEach(function(e){l.form.detetailsDusts.push({latitude:1e6*e.mapLatitude,longitude:1e6*e.mapLongitude})}),e.next=5,this.queryEnginePoint({points:this.form.detetailsDusts,mapType:this.$store.getters.mapType+""});case 5:a=e.sent,o=a.flag,s=a.data,o&&s.forEach(function(e){r.push({latitude:e.latitude,longitude:e.longitude})}),Object(n.a)(regeneratorRuntime.mark(function e(){var t,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={name:l.form.name,enterpriseId:l.form.enterpriseId,fleetId:l.form.fleetId,points:JSON.stringify(r),mapType:l.$store.getters.mapType+""},"add"===l.$route.query.type)return e.next=4,l.insertWorkLine(t);e.next=9;break;case 4:a=e.sent,a.flag&&(l.$message.success({message:"新增成功"}),l.$router.push("/monitor/routerManage")),e.next=15;break;case 9:return t.points=JSON.stringify(r),e.next=12,l.updateWorkLine(Object(i.a)({},t,{id:l.$route.query.id}));case 12:n=e.sent,n.flag&&(l.$message.success({message:"修改成功"}),l.$router.push("/monitor/routerManage"));case 15:case"end":return e.stop()}},e)}))();case 9:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)}),companyTree:function(){var e=this;"modify"==this.$route.query.type&&Object(n.a)(regeneratorRuntime.mark(function t(){var r,a,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.queryWorkLine({id:e.$route.query.id,mapType:e.$store.getters.mapType+""});case 2:r=t.sent,a=r.flag,n=r.data,i=[],a&&n.pointList.forEach(function(e){i.push({latitude:e.latitude,longitude:e.longitude})}),e.form={name:n.name,enterpriseId:n.enterpriseId,detetailsDusts:i,list:i,fleetId:""},e.fId=n.fleetId;case 9:case"end":return t.stop()}},t)}))()},fleetTree:function(){"modify"==this.$route.query.type&&(this.form.fleetId=this.fId)}}),watch:{"form.fleetId":function(e){var t=this;e&&(this.form.plateList=[],this.$http({url:"/vehicle/queryVehicleByFleetId",params:{fleetIds:e}}).then(function(e){e.flag&&e.data&&e.data.forEach(function(e){t.form.plateList.push({label:e.plateCode,value:e.id})})}))}}},u=(r("6794a"),r("2877")),p=Object(u.a)(l,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("cv-areadrawmap",{staticClass:"ytRouterM",attrs:{title:e.typeName,visible:e.visible,rules:e.rules,"class-name":"inhertW","router-type":"line",type:this.$route.query.type,model:e.form},on:{"update:visible":function(t){e.visible=t},"update:model":function(t){e.form=t},"return-page":e.returnPage,save:e.saveRouter}},[r("el-form-item",{attrs:{label:"所属公司/机构",prop:"enterpriseId"}},[r("cv-dropdown-tree",{attrs:{placeholder:e.$t("common.enterprise.enterpriseName"),url:"/enterprise/findEnterpriseOrganizationTreeList",label:e.label,treeLoaded:e.companyTree},on:{"update:label":function(t){e.label=t}},model:{value:e.form.enterpriseId,callback:function(t){e.$set(e.form,"enterpriseId",t)},expression:"form.enterpriseId"}})],1),r("el-form-item",{attrs:{label:"车组选择",prop:"fleetId"}},[r("cv-dropdown-tree",{attrs:{url:"/enterprise/findFleetTreeList","auto-params":{enterpriseId:e.label.enterpriseId,pId:e.label.id,type:e.label.type},treeLoaded:e.fleetTree},model:{value:e.form.fleetId,callback:function(t){e.$set(e.form,"fleetId",t)},expression:"form.fleetId"}})],1),r("el-form-item",{attrs:{label:"线路名称",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)},[],!1,null,null,null).exports;t.default=p},"8ebd":function(e,t,r){"use strict";r("7f7f");var a=r("bd86"),n=(r("ac6a"),r("cebc")),i=r("2f62"),o={name:"CvAreaDrawmap",props:{title:{},model:{},rules:{},visible:{type:Boolean,default:!1},routerType:{type:String,default:"line"},type:{type:String,default:"add"},className:{type:String,default:"routermanage-dropdown-width"}},data:function(){return{isShow:!0,routerOptions:null,saveLoad:!1,dropFlag:!0}},computed:Object(n.a)({},Object(i.c)(["mapName"]),{_formMethods:function(){return this.$refs.form},_mapMethods:function(){return this.$refs.map.mapMethods}}),watch:{model:function(e){var t=this;if("add"!==this.type)var r=setTimeout(function(a){clearTimeout(r),r=null,t.detailLngLatPoints(e.list)},100)},type:function(e){"add"==e&&this._mapMethods.setCity("上海市")},visible:function(e){e&&(this.dropFlag=!0)}},methods:{returnPage:function(){this.resetRouter(),this.saveLoad=!1,this.$emit("update:model",{}),this.$emit("update:visible",!1),this.$emit("return-page"),this.dropFlag=!1},createRouter:function(){var e=this;this.dropFlag=!1,this.resetRouter(!1);var t=this.routerType.charAt(0).toUpperCase()+this.routerType.substring(1);this._mapMethods["onclick"+t](function(t){e.dropFlag=!0,e.routerOptions=t.overlay})},resetRouter:function(e){var t=!(0<arguments.length&&void 0!==e)||e;this._mapMethods.clearOverlays(),this.routerOptions=null,t&&this._formMethods.resetFields()},saveRouter:function(){var e=this,t=this;this._formMethods.validate(function(r){if(!e.routerOptions)return e.$message.error("您未在地图上创建区域！");r&&(e.saveLoad=!0,e.$emit("save",Object(n.a)({},e.model,{type:e.type,list:e.getPolygonOptions(e.routerOptions),successCallback:function(){t.saveLoad=!1,t.$emit("update:model",{}),t.resetRouter(),t.dropFlag=!1},errorCallback:function(){t.saveLoad=!1,t.dropFlag=!1}})))})},getPolygonOptions:function(e){switch(this.routerType){case"polygon":var t=this._mapMethods.getPolygonOptions(e).points;return this._getPolygonOptions(t);case"rectangle":var r=this._mapMethods.getPolygonOptions(e).points;return this._getRectangleOptions(r);case"line":var a=this._mapMethods.getLineOptions(e).points;return this._getLineOptions(a);case"circle":var n=this._mapMethods.getCircleOptions(e).points;return this._getCircleOptions(n)}},_getPolygonOptions:function(e,t,r){var n=1<arguments.length&&void 0!==t?t:["mapLongitude","mapLatitude"],i=2<arguments.length&&void 0!==r?r:["lng","lat"],o=[];return e.forEach(function(e){var t;o.push((t={},Object(a.a)(t,n[0],e[i[0]]),Object(a.a)(t,n[1],e[i[1]]),t))}),o},_getRectangleOptions:function(e,t,r){var a=1<arguments.length&&void 0!==t?t:["mapLongitude","mapLatitude"],n=2<arguments.length&&void 0!==r?r:["lng","lat"],i=[],o=[],s=[],l={},u={};return e.forEach(function(e){o.push(e[n[0]]),s.push(e[n[1]])}),l[a[0]]=Math.max.apply(Math,o),l[a[1]]=Math.max.apply(Math,s),u[a[0]]=Math.min.apply(Math,o),u[a[1]]=Math.min.apply(Math,s),i.push(l,u),i},_getLineOptions:function(e,t,r){var n=1<arguments.length&&void 0!==t?t:["mapLongitude","mapLatitude"],i=2<arguments.length&&void 0!==r?r:["lng","lat"],o=[];return e.forEach(function(e){var t;o.push((t={},Object(a.a)(t,n[0],e[i[0]]),Object(a.a)(t,n[1],e[i[1]]),t))}),o},_getCircleOptions:function(e,t,r){var n,i=1<arguments.length&&void 0!==t?t:["mapLongitude","mapLatitude"],o=2<arguments.length&&void 0!==r?r:["lng","lat"],s=[];return s.push((n={},Object(a.a)(n,i[0],e.center[o[0]]),Object(a.a)(n,i[1],e.center[o[1]]),n)),s},detailLngLatPoints:function(e){if(this.$service.isArray(e)&&0<e.length){var t=null;switch(this.routerType){case"polygon":t=this._getPolygonOptions(e,["lng","lat"],["mapLongitude","mapLatitude"]);break;case"rectangle":t=this._getRectangleOptions(e,["lng","lat"],["mapLongitude","mapLatitude"]);break;case"line":t=e}this.routerOptions=this._mapMethods["mapAdd"+this.routerType](t,{}),this._mapMethods.getBestView(this.routerOptions.points)}},mapReady:function(){"modify"==this.type&&this.detailLngLatPoints(this.model.list)}}},s=(r("eb84"),r("2877")),l=Object(s.a)(o,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"routermanage-map-operation"},[r(e.mapName,{ref:"map",tag:"component",staticClass:"routermanage-map",attrs:{mapLoaded:e.mapReady}}),r("cv-dropdown",{staticClass:"routermanage-operation",attrs:{"class-name":e.className,visible:e.dropFlag,placement:"top-end"}},[r("el-button",{attrs:{type:"success",icon:"el-icon-edit",circle:""},on:{click:function(t){e.dropFlag=!e.dropFlag}}}),r("div",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("h2",{staticClass:"cv-mapoperation-title"},[e._v("\n                "+e._s(e.title)+"\n                "),r("cv-icon",{staticStyle:{float:"right"},attrs:{name:"remove"},on:{click:e.returnPage}})],1),r("el-form",{ref:"form",staticClass:"cv-mapoperation-form",attrs:{"label-width":"120px",model:e.model,rules:e.rules}},[e._t("default"),r("div",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{type:"primary"},on:{click:e.createRouter}},[e._v("创建")]),r("el-button",{on:{click:e.resetRouter}},[e._v("重置")]),r("el-button",{attrs:{loading:e.saveLoad},on:{click:e.saveRouter}},[e._v("保存")])],1)],2)],1)],1)],1)},[],!1,null,null,null).exports;l.install=function(e){e.component(l.name,l)},t.a=l},eb84:function(e,t,r){"use strict";var a=r("efa7");r.n(a).a},efa7:function(e,t,r){}}]);