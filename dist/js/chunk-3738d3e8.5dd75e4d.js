(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3738d3e8"],{"312b":function(e,t,o){"use strict";var r=o("7b81");o.n(r).a},"7b81":function(e,t,o){},a6c5:function(e,t,o){"use strict";o("ac6a");var r={props:{data:{},allChecked:{},checkDisabled:!1,checkFlag:!1},data:function(){return{checked:[],checkAll:!1,isIndeterminate:!1}},methods:{handleCheckAll:function(e){var t=[];this.data.actions.forEach(function(e){t.push(e.id)}),this.checked=e?t:[],this.isIndeterminate=!1,this.$emit("checked",{id:this.data.menuId,checked:this.checked,moduleId:this.data.moduleId})},handleChecked:function(e){this.$emit("checked",{id:this.data.menuId,checked:this.checked,moduleId:this.data.moduleId});var t=e.length;this.checkAll=t===this.data.actions.length,this.isIndeterminate=0<t&&t<this.data.actions.length}},mounted:function(){this.checked=[];var e=this.data;e&&(""!=e.actionIds?(this.checked=this.$service.stringArr(e.actionIds),this.checked.length===e.actions.length?this.checkAll=!0:0==this.checked.length?this.checkAll=!1:this.isIndeterminate=!0,this.$emit("checked",{id:this.data.menuId,checked:this.checked,moduleId:this.data.moduleId})):(this.checked=[],this.checkAll=!1))},watch:{data:function(e){var t=e;t&&(""!=t.actionIds?(this.checked=this.$service.stringArr(t.actionIds),this.checked.length==e.actions.length&&(this.isIndeterminate=!1,this.checkAll=!0),this.checked.length!=e.actions.length&&(0==this.checked.length?(this.isIndeterminate=!1,this.checkAll=!1):(this.checkAll=!1,this.isIndeterminate=!0)),this.$emit("checked",{id:this.data.menuId,checked:this.checked,moduleId:this.data.moduleId})):(this.checked=[],this.isIndeterminate=!1,this.checkAll=!1))},checkFlag:function(e){e&&(this.checked=[],this.checkAll=!1)}}},a=(o("312b"),o("2877")),i=Object(a.a)(r,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"cv-allCheck"},[o("el-checkbox",{staticClass:"allCheck",attrs:{label:e.data.crumbs,name:e.data.crumbs,indeterminate:e.isIndeterminate,disabled:e.checkDisabled},on:{change:e.handleCheckAll},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v(e._s(e.data.crumbs))]),o("el-checkbox-group",{staticClass:"checkGroup",attrs:{disabled:e.checkDisabled},on:{change:e.handleChecked},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},e._l(e.data.actions,function(t){return o("el-checkbox",{key:t.id,attrs:{label:t.id,disabled:e.checkDisabled}},[e._v(e._s(t.name))])}),1)],1)},[],!1,null,null,null);t.a=i.exports},b0ad:function(e,t,o){"use strict";(function(e){o("7f7f"),t.a={methods:{confirmPrompt:function(e,t){var o=this,r=e||this.$t("action.confirmIsRemove");return new Promise(function(e,a){o.$confirm(r,o.$t("action.tip"),{confirmButtonText:o.$t("action.confirm"),cancelButtonText:o.$t("action.cancel"),type:"warning"}).then(function(){e()}).catch(function(){"function"==typeof t&&t()})})},timeLimitFunc:function(e,t,o){if(e&&t)return((new Date(t)-new Date(e))/864e5).toFixed(1)<=o||this.$message.error({message:this.$t("请选择时间范围在"+o+"天内")});this.$message.error({message:this.$t("请选择时间范围")})},addRemoveUnique:function(e,t,o){var r=e.length,a=t.length;return a<r?{name:"add",data:this.$service.isUnique(e,t,o)}:r<a?{name:"remove",data:this.$service.isUnique(t,e,o)}:r==a?{name:"equal",data:this.$service.isUnique(e,t,o)}:void 0},showTooltip:function(e,t){var o=e.target,r=this.$refs[t];r.referenceElm=o,r.$refs.popper.style.display="none",r.doDestroy(),r.setExpectedState(!0),r.handleShowPopper()},mouseenterShowTip:function(e,t,o){var r=e.target;if(r.scrollWidth>r.offsetWidth||o)return this.showTooltip(e,t),o?o.startTime+"~"+o.endTime:r.innerText},mouseenterShowToolTip:function(e,t,o){var r=e.target;return this.showTooltip(e,t),!o&&r.innerText},mouseoverHideTip:function(e){var t=this.$refs[e];t&&(t.setExpectedState(!1),t.handleClosePopper())},asyncDownloadScript:function(t,o){var r=this,a=0<arguments.length&&void 0!==t?t:"Baidu",i=1<arguments.length?o:void 0;return e[a]?e[a]._preloader?e[a]._preloader:Promise.resolve(e[a]):(e[a]={},e[a]._preloader=new Promise(function(t,o){var l=document.createElement("script");l.src=i,e.document.body.appendChild(l),r.$service.isIe()&&r.$service.IE_VERSION<11?l.onreadystatechange=function(){"loaded"!=l.readyState&&"complete"!=l.readyState||(t(e[a]),e[a]._preloader=null)}:l.onload=function(){t(e[a]),e[a]._preloader=null}}),e[a]._preloader)}}}}).call(this,o("c8ba"))},cd8f:function(e,t,o){"use strict";o.r(t),o("7f7f"),o("6b54"),o("ac6a");var r=o("a6c5"),a={components:{allCheck:r.a},props:{options:{}},inject:["store"],data:function(){return this.$createElement,{componentName:"",label:"",tabs:{activeName:"tabs0"},checkFlag:!1,originalActionsId:[],companysId:"",companysIds:"",styles:"display:none",allChecked:[],allModules:[],UserList:[],checkedUser:[],loading:!1,nothing:"",copyRoleJurisdiction:[],renderFunc:function(e,t){return e("span",[" ",t.name," "])},activeName:[],selectEnt:{},roleForm:{id:"",enterpriseName:"",enterpriseId:"",roleName:"",company:"",roleType:"",remark:""},rules:{roleName:[{required:!0,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{min:2,max:15,message:this.$filter.lanReplace(this.$t("filter.Length"),{min:2,max:15})}],roleType:[{required:!0,message:this.$t("filter.notEmpty"),trigger:"change"}],enterpriseId:[{required:!0,message:this.$t("filter.notEmpty"),trigger:"change"}]},treeData:[],roleTypeOptions:[{value:"0",label:this.$t("common.roleType.0"),disabled:!0},{value:"1",label:this.$t("common.roleType.1"),disabled:!0},{value:"2",label:this.$t("common.roleType.2"),disabled:!0},{value:"3",label:this.$t("common.roleType.3")}]}},methods:{collapseClick:function(){this.componentName||(this.componentName="allCheck")},checkedVal:function(e){var t=this;if(0<e.checked.length)if(0<this.allChecked.length){var o=this.findMenuID(e.id);o.flag?this.allChecked[o.index].actionIds=e.checked.join(","):this.allChecked.push({menuId:e.id,actionIds:e.checked.join(","),moduleId:e.moduleId})}else this.allChecked.push({menuId:e.id,actionIds:e.checked.join(","),moduleId:e.moduleId});0==e.checked.length&&this.allChecked.forEach(function(o,r){o.menuId!=e.id||t.allChecked.splice(r,1)})},findMenuID:function(e){for(var t=this.allChecked,o=!1,r=-1,a=0;a<t.length;a++)if(t[a].menuId==e){o=!0,r=a;break}return{flag:o,index:r}},clear:function(){this.allChecked=[]},copyRole:function(e){var t=this;this.allModules=[],this.$http({url:"/role/findAllRole",method:"get",params:{enterpriseId:e}}).then(function(e){t.copyRoleJurisdiction=[];for(var o=0;o<e.data.length;o++)t.copyRoleJurisdiction.push({id:e.data[o].id,roleName:e.data[o].roleName})})},getRoleJurisdiction:function(e){var t=this;""!=e&&this.$http({url:"/role/findRoleMenu",method:"post",params:{enterpriseId:this.companysId,roleId:e}}).then(function(e){t.allModules=e.data})},getRoleJurisdictionUpdata:function(e){var t=this;this.$http({url:"/role/findRoleMenu",method:"post",params:{enterpriseId:this.companysIds,roleId:e}}).then(function(e){t.allModules=e.data})},handleChange:function(e,t,o){},getUserByRoleID:function(e){var t=this,o=this.$loading({text:this.$t("role.type1"),target:document.querySelector(".el-dialog")});this.$http({url:"/userrole/findUserByRole",params:{roleId:e}}).then(function(e){o.close(),t.checkedUser=[],e.data&&e.data.forEach(function(e){t.checkedUser.push(e.id)})})},getMenuByIds:function(e,t){var o=this,r={enterpriseId:e,roleIds:t};this.$store.dispatch("getMenuByenterpriseIdAndroleIds",r).then(function(e){e.flag&&!e.errorCode&&(o.allModules=e.data)})},getMenuById:function(e,t){var o=this,r={enterpriseId:e,roleId:t};this.$store.dispatch("findRoleMenu",r).then(function(e){e.flag&&!e.errorCode&&(o.allModules=e.data)})},getUserByCompanyID:function(e){var t=this;this.$http({url:"/user/findUserList",method:"get",params:{enterpriseId:e}}).then(function(e){if(!e.flag&&e.errorCode)t.$message.error({message:t.$t("error."+e.errorCode)});else{var o=e.data;e.data&&o.forEach(function(e){t.UserList.push({id:e.id,name:e.account+"-"+e.username})})}})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!(t.tabs.activeName="tabs0");var o={id:t.roleForm.id,roleName:t.roleForm.roleName,roleType:t.roleForm.roleType,remark:t.roleForm.remark,enterpriseId:t.roleForm.enterpriseId,userIds:t.checkedUser.join(","),menuIds:t.allChecked};t.loading=!0,t.roleForm.id?t.ActionRole("/role/updateRoleById",o):t.ActionRole("/role/insertRole",o)})},ActionRole:function(e,t){var o=this;this.$http({url:e,data:JSON.stringify(t)}).then(function(e){!e.flag&&e.errorCode?o.$message.error({message:o.$t("error."+e.errorCode)}):(o.$emit("confirm",o.roleForm.enterpriseId),o.$message.success({message:o.$t("UserManage.actionSuccess")}),o.options.flag=!1),o.loading=!1}).catch(function(){o.loading=!1})},getRoleBaseByID:function(e){var t=this;return new Promise(function(o,r){t.$http({url:"/role/getRoleById",params:{id:e}}).then(function(e){t.companysIds=e.data.enterpriseId,t.copyRole(e.data.enterpriseId),t.roleForm=e.data,t.roleForm.roleType=e.data.roleType.toString(),o(e)})})},resetForm:function(e){this.options.flag=!1}},watch:{"options.flag":function(e){e||(this.options.name="",this.store.roleID="",this.store.companyID="")},"roleForm.enterpriseName":function(e,t){""==e&&(this.roleForm.enterpriseId=0)},"roleForm.enterpriseId":function(e,t){this.getUserByCompanyID(e),this.store.isModify||this.getMenuByIds(e,this.roleForm.id),this.companysId=e,this.nothing="",this.copyRoleJurisdiction=[],this.allModules=[],e&&(this.copyRole(e),this.checkedUser=[],this.allModules=[],this.UserList=[])},nothing:function(e,t){""!=e?(this.checkFlag=!1,this.store.isModify||this.getRoleJurisdiction(e),this.store.isModify&&this.getRoleJurisdictionUpdata(e)):this.checkFlag=!0}},mounted:function(){var e=this;if(this.roleForm.id=this.store.roleID,this.roleForm.id){this.componentName="allCheck";var t=this.roleForm.id;this.getRoleBaseByID(t).then(function(t){e.getUserByRoleID(e.roleForm.id),e.getMenuById(e.roleForm.enterpriseId,e.roleForm.id)})}}},i=(o("e4bc"),o("2877")),l=Object(i.a)(a,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-row",{staticClass:"role-addModify"},[o("el-col",{attrs:{span:24}},[o("cv-tabs",{attrs:{titles:[e.$t("role.message"),e.$t("role.rolePermission")],forceRender:!1},model:{value:e.tabs.activeName,callback:function(t){e.$set(e.tabs,"activeName",t)},expression:"tabs.activeName"}},[o("el-form",{ref:"roleForm",staticStyle:{width:"100%"},attrs:{model:e.roleForm,inline:!0,rules:e.rules,"label-width":"80px"}},[o("el-form-item",{attrs:{label:e.$t("common.enterprise.affiliated"),prop:"enterpriseId"}},[o("cv-dropdown-tree",{attrs:{disabled:e.store.isModify,label:e.label,data:e.store.company_tree},on:{"update:label":function(t){e.label=t}},model:{value:e.roleForm.enterpriseId,callback:function(t){e.$set(e.roleForm,"enterpriseId",t)},expression:"roleForm.enterpriseId"}})],1),o("el-form-item",{attrs:{label:e.$t("role.roleName"),prop:"roleName"}},[o("el-input",{staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:e.$t("placeholder.inputValue")},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName","string"==typeof t?t.trim():t)},expression:"roleForm.roleName"}})],1),o("el-form-item",{attrs:{label:e.$t("role.roleType"),prop:"roleType"}},[o("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:e.$t("placeholder.selectValue")},model:{value:e.roleForm.roleType,callback:function(t){e.$set(e.roleForm,"roleType",t)},expression:"roleForm.roleType"}},e._l(e.roleTypeOptions,function(e,t){return o("el-option",{key:t,attrs:{label:e.label,value:e.value,disabled:e.disabled}})}),1)],1),o("el-form-item",{attrs:{label:e.$t("role.roleRemark"),prop:"remark"}},[o("el-input",{attrs:{clearable:"",placeholder:e.$t("placeholder.inputValue"),maxlength:60},model:{value:e.roleForm.remark,callback:function(t){e.$set(e.roleForm,"remark","string"==typeof t?t.trim():t)},expression:"roleForm.remark"}})],1),o("el-form-item",{attrs:{label:e.$t("role.roleCheckedUser"),prop:"checkedUser"}},[o("div",{staticClass:"mypanel"},[o("el-transfer",{attrs:{filterable:"",props:{label:"name",key:"id"},"render-content":e.renderFunc,titles:[this.$t("role.noCheckedUser"),this.$t("role.yCheckedUser")],"footer-format":{noChecked:"${total}"+this.$t("role.xiang"),hasChecked:"${checked}/${total}"+this.$t("role.xiang")},data:e.UserList},on:{change:e.handleChange},model:{value:e.checkedUser,callback:function(t){e.checkedUser=t},expression:"checkedUser"}})],1)])],1),o("div",[o("el-select",{directives:[{name:"show",rawName:"v-show",value:0<e.allModules.length,expression:"allModules.length>0"}],staticStyle:{width:"300px","margin-bottom":"10px"},attrs:{clearable:"",placeholder:e.$t("placeholder.roleCopy")},on:{clear:e.clear},model:{value:e.nothing,callback:function(t){e.nothing=t},expression:"nothing"}},e._l(e.copyRoleJurisdiction,function(e){return o("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})}),1),o("el-collapse",{on:{change:e.collapseClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[e.allModules&&0==e.allModules.length?o("h2",{staticClass:"noMessage"},[e._v(e._s(e.$t("el.table.emptyText")))]):e._e(),e._l(e.allModules,function(t){return e.allModules&&0<e.allModules.length?o("el-collapse-item",{key:t.id,attrs:{title:t.name,name:t.id}},[o("cv-scrollbar",{staticStyle:{height:"230px"}},e._l(t.roleModules,function(t,r){return o(e.componentName,{key:r,tag:"component",attrs:{data:t,allChecked:e.allChecked,checkFlag:e.checkFlag},on:{checked:e.checkedVal}})}),1)],1):e._e()})],2)],1)],1)],1),o("el-col",{staticClass:"dialog-footer",staticStyle:{"padding-top":"20px"},attrs:{span:24}},[o("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:function(t){return e.submitForm("roleForm")}}},[e._v(e._s(e.$t("action.save")))]),o("el-button",{on:{click:function(t){return e.resetForm("roleForm")}}},[e._v(e._s(e.$t("action.cancel")))])],1)],1)},[],!1,null,null,null).exports,n=o("b0ad"),s=o("e4d3"),c={components:{add:l,allCheck:r.a},mixins:[n.a,s.a],computed:{_table:function(){return this.$refs.roleTable}},data:function(){return{grid:{enterpriseId:""},dialog:{flag:!1,title:"--",size:"dialog-small",name:"add"}}},methods:{searchClickLoadGrid:function(){this._table.tableInitial()},timeFormat:function(e){return this.$filter.format(e.createTime,"yyyy-MM-dd HH:mm:ss")},addRole:function(e){this.$service.mapParams(this.dialog,{size:"dialog-large",name:e.name,title:e.title,flag:!0}),this.store.isModify=!1},updateRole:function(e){this.$service.mapParams(this.dialog,{size:"dialog-large",name:"add",title:this.$t("role.modifyRole"),flag:!0}),this.store.isModify=!0,this.store.companyID=e.row.enterpriseId,this.store.roleID=e.row.id},removeRole:function(e){var t=this;this.confirmPrompt().then(function(){t.$http({url:"/role/deleteRoleById",params:{id:e.row.id}}).then(function(e){e.flag?(t._table.tableInitial(!0),t.$message.success({message:t.$t("role.actionSuccess")})):t.$message.error({message:t.$t("error."+e.errorCode)})})}).catch(function(){t.$message.info({message:t.$t("role.cancelRemove")})})}},mounted:function(){this.staticTreeOld()},watch:{"options.flag":function(e){e||(this.dialog.name="")}}},d=(o("f1bb"),Object(i.a)(c,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"roleManage"},[o("cv-operation",[o("el-form-item",[o("cv-dropdown-tree",{attrs:{url:"/enterprise/getEnterpriseTreeList",placeholder:"请选择公司搜索",label:e.label},on:{"update:label":function(t){e.label=t}},model:{value:e.grid.enterpriseId,callback:function(t){e.$set(e.grid,"enterpriseId",t)},expression:"grid.enterpriseId"}})],1),o("el-form-item",[o("cv-tool",{attrs:{name:e.$route.name,data:e.$store.getters.manageMenus,"is-modify":!1,"is-remove":!1,"is-export":!1},on:{add:e.addRole,search:e.searchClickLoadGrid}})],1)],1),o("cv-content",[o("cv-grid",{ref:"roleTable",attrs:{params:e.grid,url:"/role/findRolePage"}},[o("el-table-column",{attrs:{label:e.$t("role.roleName"),prop:"roleName"}}),o("el-table-column",{attrs:{label:e.$t("role.remark"),prop:"remark"}}),o("el-table-column",{attrs:{label:e.$t("UserManage.wellmadestarm"),prop:"enterpriseName"}}),o("el-table-column",{attrs:{label:e.$t("role.createTime"),prop:"createTime",formatter:e.timeFormat}}),o("el-table-column",{attrs:{label:e.$t("role.operation")},scopedSlots:e._u([{key:"default",fn:function(t){return[o("cv-table-tool",{directives:[{name:"show",rawName:"v-show",value:2==t.row.roleType||3==t.row.roleType,expression:"(scope.row.roleType == 2 || scope.row.roleType == 3)"}],attrs:{name:e.$route.name,data:e.$store.getters.manageMenus},on:{modify:function(o){return e.updateRole(t)},remove:function(o){return e.removeRole(t)}}})]}}])})],1)],1),o("el-dialog",{attrs:{"close-on-click-modal":!1,visible:e.dialog.flag,title:e.dialog.title,"custom-class":e.dialog.size},on:{"update:visible":function(t){return e.$set(e.dialog,"flag",t)}}},[o(e.dialog.name,{tag:"component",attrs:{options:e.dialog},on:{confirm:e.searchClickLoadGrid}})],1)],1)},[],!1,null,null,null).exports);d.install=function(e){e.component(d.name,d)},t.default=d},e4bc:function(e,t,o){"use strict";var r=o("ed7e");o.n(r).a},e4d3:function(e,t,o){"use strict";t.a={data:function(){return{store:{company_tree:[]}}},provide:function(){return{store:this.store}},methods:{staticTree:function(){var e=this;this.$http({url:"/enterprise/findEnterpriseOrganizationTreeList"}).then(function(t){var o=t.data,r=t.flag;e.store.company_tree=r?o:[]})},staticTreeOld:function(){var e=this;this.$http({url:"/enterprise/getEnterpriseTreeList"}).then(function(t){var o=t.data,r=t.flag;e.store.company_tree=r?o:[]})}}}},ed7e:function(e,t,o){},ef1a:function(e,t,o){},f1bb:function(e,t,o){"use strict";var r=o("ef1a");o.n(r).a}}]);