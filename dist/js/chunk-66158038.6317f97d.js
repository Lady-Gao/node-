(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-66158038"],{"622e":function(e,t,a){"use strict";a.r(t),a("96cf");var r=a("3b8d"),i=(a("28a5"),{props:{peopleList:{type:[Array]}},inject:["store"],data:function(){return{statuslist:[{label:"未发布",value:0},{label:"已发布",value:1}],confirmlist:[{label:"是",value:1},{label:"否",value:0}],rules:{title:[{required:!0,message:"请输入消息标题",trigger:"blur,change"}],type:[{required:!0,message:"请选择发布状态",trigger:"blur,change"}],content:[{required:!0,message:"请输入消息内容",trigger:"blur,change"}],isnotarize:[{required:!0,message:"请选择可阅人员",trigger:"blur,change"}],personArr:[{required:!0,message:"请选择是否需要确认",trigger:"blur,change"}]}}},methods:{cancelDialog:function(){this.$emit("update:visible",!1)},confirm:function(){var e=this;this.$refs.broadcast.validate(function(t){if(!t)return!1;var a={title:e.store.modifyData.title,content:e.store.modifyData.content,userIds:e.store.modifyData.pList.join(","),type:e.store.modifyData.type,isnotarize:e.store.modifyData.isnotarize,enterpriseId:e.$store.getters.user.enterpriseId};e.store.edit?(a.id=e.store.modifyData.id,e.$store.dispatch("updateMessageRadioInfo",a).then(function(t){t.flag?e.$message.success({message:"修改成功"}):e.$message.error({message:"修改失败"})})):e.$store.dispatch("insertMessageRadioInfo",a).then(function(t){t.flag?e.$message.success({message:"添加成功"}):e.$message.error({message:"添加失败"})})}),this.$emit("update:loadTable",!0),this.$emit("update:visible",!1)}}}),s=a("2877"),n=Object(s.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"broadcast",attrs:{model:e.store.modifyData,rules:e.rules}},[a("el-form-item",{attrs:{label:"消息标题",prop:"title"}},[a("el-input",{model:{value:e.store.modifyData.title,callback:function(t){e.$set(e.store.modifyData,"title",t)},expression:"store.modifyData.title"}})],1),a("el-form-item",{attrs:{label:"发布状态",prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.store.modifyData.type,callback:function(t){e.$set(e.store.modifyData,"type",t)},expression:"store.modifyData.type"}},e._l(e.statuslist,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-form-item",{attrs:{label:"消息内容",prop:"content"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.store.modifyData.content,callback:function(t){e.$set(e.store.modifyData,"content",t)},expression:"store.modifyData.content"}})],1),a("el-form-item",{attrs:{label:"指定可阅读人员",prop:""}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.store.modifyData.pList,callback:function(t){e.$set(e.store.modifyData,"pList",t)},expression:"store.modifyData.pList"}},e._l(e.peopleList,function(e){return a("el-option",{key:e.value,attrs:{enterpriseId:e.enterpriseId,label:e.userName,value:e.userId}})}),1)],1),a("el-form-item",{attrs:{label:"是否需要确认",prop:"isnotarize"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.store.modifyData.isnotarize,callback:function(t){e.$set(e.store.modifyData,"isnotarize",t)},expression:"store.modifyData.isnotarize"}},e._l(e.confirmlist,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-form-item",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确定")]),a("el-button",{on:{click:e.cancelDialog}},[e._v("取消")])],1)],1)},[],!1,null,null,null).exports,o={inject:["store"],data:function(){return{canRead:"",readed:""}},methods:{confirm:function(){this.$emit("update:visible",!1)}},mounted:function(){var e=this;Object(r.a)(regeneratorRuntime.mark(function t(){var a,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("findReadPersonsInfo",{id:e.store.peopleId});case 2:a=t.sent,r=a.data,a.flag&&(e.canRead=r.canRead,e.readed=r.readed);case 6:case"end":return t.stop()}},t)}))()}},l=Object(s.a)(o,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",[a("el-form-item",{attrs:{label:"可阅读人员:"}},[a("span",[e._v(e._s(e.canRead))])]),a("el-form-item",{attrs:{label:"已阅读人员:"}},[a("span",[e._v(e._s(e.readed))])]),a("el-form-item",{staticStyle:{"text-align":"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确定")])],1)],1)},[],!1,null,null,null).exports,c=a("b0ad"),d=a("e4d3"),u={name:"Broadcast",components:{broadcastAddmodify:n,broadcastCheck:l},mixins:[c.a,d.a],computed:{_table:function(){return this.$refs.broadcastT}},data:function(){return{store:{search:{title:"",type:""},modifyData:{id:"",title:"",type:0,content:"",pList:[],isnotarize:0},peopleId:""},dialog:{flag:!1,size:"dialog-tiny",title:"添加",name:"",personList:[]},tableFlag:!1,searchFlag:!1,lastLength:0,statuslist:[{label:"未发布",value:0},{label:"已发布",value:1}]}},created:function(){var e=this;this.$store.dispatch("findEntUserInfoList").then(function(t){t.flag&&(e.dialog.personList=t.data)})},methods:{add:function(){this.$service.mapParams(this.dialog,{name:"broadcastAddmodify",flag:!0,title:"添加"}),this.store.edit=!1,this.$service.mapParams(this.store.modifyData,{title:"",type:0,content:"",pList:[],isnotarize:0})},search:function(){this._table.tableInitial(),this.store.edit=!1},edit:function(e){this.$service.mapParams(this.dialog,{name:"broadcastAddmodify",flag:!0,title:"修改"}),this.$service.mapParams(this.store.modifyData,{id:e.id,title:e.title,type:e.type,content:e.content,pList:e.userIds?e.userIds.split(","):[],isnotarize:e.isnotarize}),this.store.edit=!0},del:function(e){var t=this;this.confirmPrompt().then(function(){Object(r.a)(regeneratorRuntime.mark(function a(){var r,i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$store.dispatch("deleteMessageRadioInfo",{id:e});case 2:r=a.sent,r.data,i=r.flag,r.errorCode,i?(t.$message.success({message:"删除成功"}),t._table.tableInitial()):t.$message.error({message:"删除失败"});case 7:case"end":return a.stop()}},a)}))()})},issue:function(e){var t=this;this.confirmPrompt("是否确认发布？").then(function(){Object(r.a)(regeneratorRuntime.mark(function a(){var r,i;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$store.dispatch("updatePublishMessageRadioInfo",{id:e});case 2:r=a.sent,r.data,i=r.flag,r.errorCode,i?(t.$message.success({message:"发布成功"}),t._table.tableInitial()):t.$message.error({message:"发布失败"});case 7:case"end":return a.stop()}},a)}))()})},checkPerson:function(e){this.dialog.flag=!0,this.dialog.title="可阅人员查看",this.dialog.name="broadcastCheck",this.store.peopleId=e}},watch:{tableFlag:function(e){var t=this;e&&setTimeout(function(e){t._table.tableInitial(),t.tableFlag=!1},1200)},searchFlag:function(e){e&&(this._table.tableInitial(),this.searchFlag=!1)},"dialog.flag":function(e){e||(this.dialog.name="")}}},p=Object(s.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("cv-operation",[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入消息标题搜索",clearable:""},model:{value:e.store.search.title,callback:function(t){e.$set(e.store.search,"title","string"==typeof t?t.trim():t)},expression:"store.search.title"}})],1),a("el-form-item",[a("el-select",{attrs:{placeholder:"请选择状态搜索",clearable:""},model:{value:e.store.search.type,callback:function(t){e.$set(e.store.search,"type",t)},expression:"store.search.type"}},e._l(e.statuslist,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-form-item",[a("cv-tool",{attrs:{name:e.$route.name,data:e.$store.getters.manageMenus,"is-export":!1,"is-remove":!1,"is-modify":!1},on:{search:e.search,add:e.add}})],1)],1),a("cv-content",[a("cv-grid",{ref:"broadcastT",attrs:{params:e.store.search,url:"/messageRadio/findMessageRadioPagerInfoList"}},[a("el-table-column",{attrs:{label:"消息标题",prop:"title"}}),a("el-table-column",{attrs:{label:"消息内容",prop:"content"}}),a("el-table-column",{attrs:{label:"录入人员",prop:"creatUsername"}}),a("el-table-column",{attrs:{label:"录入时间",prop:"creatTime"}}),a("el-table-column",{attrs:{label:"最后修改人员",prop:"endUsername"}}),a("el-table-column",{attrs:{label:"最后修改时间",prop:"endTime"}}),a("el-table-column",{attrs:{label:"状态",prop:"typeName"}}),a("el-table-column",{attrs:{label:"操作",prop:"type",width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.type?a("cv-span",{attrs:{type:"success"},nativeOn:{click:function(a){return e.edit(t.row)}}},[e._v("修改")]):e._e(),a("cv-span",{attrs:{type:"danger"},nativeOn:{click:function(a){return e.del(t.row.id)}}},[e._v("删除")]),0==t.row.type?a("cv-span",{attrs:{type:"warning"},nativeOn:{click:function(a){return e.issue(t.row.id)}}},[e._v("发布")]):e._e(),1==t.row.type?a("cv-span",{attrs:{type:"success"}},[e._v("已发布")]):e._e(),a("cv-span",{attrs:{type:"primary"},nativeOn:{click:function(a){return e.checkPerson(t.row.id)}}},[e._v("可阅人员查询")])]}}])})],1)],1),a("el-dialog",{attrs:{visible:e.dialog.flag,title:e.dialog.title,"custom-class":e.dialog.size},on:{"update:visible":function(t){return e.$set(e.dialog,"flag",t)}}},[a(e.dialog.name,{tag:"component",attrs:{peopleList:e.dialog.personList,visible:e.dialog.flag,loadTable:e.tableFlag,searchTable:e.searchFlag},on:{"update:visible":function(t){return e.$set(e.dialog,"flag",t)},"update:loadTable":function(t){e.tableFlag=t},"update:load-table":function(t){e.tableFlag=t},"update:searchTable":function(t){e.searchFlag=t},"update:search-table":function(t){e.searchFlag=t}}})],1)],1)},[],!1,null,null,null).exports;t.default=p},b0ad:function(e,t,a){"use strict";(function(e){a("7f7f"),t.a={methods:{confirmPrompt:function(e,t){var a=this,r=e||this.$t("action.confirmIsRemove");return new Promise(function(e,i){a.$confirm(r,a.$t("action.tip"),{confirmButtonText:a.$t("action.confirm"),cancelButtonText:a.$t("action.cancel"),type:"warning"}).then(function(){e()}).catch(function(){"function"==typeof t&&t()})})},timeLimitFunc:function(e,t,a){if(e&&t)return((new Date(t)-new Date(e))/864e5).toFixed(1)<=a||this.$message.error({message:this.$t("请选择时间范围在"+a+"天内")});this.$message.error({message:this.$t("请选择时间范围")})},addRemoveUnique:function(e,t,a){var r=e.length,i=t.length;return i<r?{name:"add",data:this.$service.isUnique(e,t,a)}:r<i?{name:"remove",data:this.$service.isUnique(t,e,a)}:r==i?{name:"equal",data:this.$service.isUnique(e,t,a)}:void 0},showTooltip:function(e,t){var a=e.target,r=this.$refs[t];r.referenceElm=a,r.$refs.popper.style.display="none",r.doDestroy(),r.setExpectedState(!0),r.handleShowPopper()},mouseenterShowTip:function(e,t,a){var r=e.target;if(r.scrollWidth>r.offsetWidth||a)return this.showTooltip(e,t),a?a.startTime+"~"+a.endTime:r.innerText},mouseenterShowToolTip:function(e,t,a){var r=e.target;return this.showTooltip(e,t),!a&&r.innerText},mouseoverHideTip:function(e){var t=this.$refs[e];t&&(t.setExpectedState(!1),t.handleClosePopper())},asyncDownloadScript:function(t,a){var r=this,i=0<arguments.length&&void 0!==t?t:"Baidu",s=1<arguments.length?a:void 0;return e[i]?e[i]._preloader?e[i]._preloader:Promise.resolve(e[i]):(e[i]={},e[i]._preloader=new Promise(function(t,a){var n=document.createElement("script");n.src=s,e.document.body.appendChild(n),r.$service.isIe()&&r.$service.IE_VERSION<11?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(t(e[i]),e[i]._preloader=null)}:n.onload=function(){t(e[i]),e[i]._preloader=null}}),e[i]._preloader)}}}}).call(this,a("c8ba"))},e4d3:function(e,t,a){"use strict";t.a={data:function(){return{store:{company_tree:[]}}},provide:function(){return{store:this.store}},methods:{staticTree:function(){var e=this;this.$http({url:"/enterprise/findEnterpriseOrganizationTreeList"}).then(function(t){var a=t.data,r=t.flag;e.store.company_tree=r?a:[]})},staticTreeOld:function(){var e=this;this.$http({url:"/enterprise/getEnterpriseTreeList"}).then(function(t){var a=t.data,r=t.flag;e.store.company_tree=r?a:[]})}}}}}]);