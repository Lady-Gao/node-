(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-360d5054"],{"4e02":function(e,t,i){"use strict";i.r(t),i("7f7f"),i("a481"),i("ac6a"),i("386d");var a=i("cebc"),n=i("b0ad"),o=i("2f62"),r={props:{options:{}},mixins:[],data:function(){return{addloadFlag:!1,removeloadFlag:!1,gridL:{name:"",enterpriseId:this.options.companyId,id:this.options.lineId},multipleSelection1:[],multipleSelection2:[],gridR:{name:"",enterpriseId:this.options.companyId,id:this.options.lineId}}},computed:{_tableL:function(){return this.$refs.leftTable},_tableR:function(){return this.$refs.rightTable}},methods:Object(a.a)({},Object(o.b)(["addBind","deleteUnBindByUserIdAndLineId"]),{listL:function(){this._tableL.tableInitial()},listR:function(){this._tableR.tableInitial()},handlerChange:function(e){var t=this;this.multipleSelection1=[],e.forEach(function(e){t.multipleSelection1.push(e.id)})},handlerChange2:function(e){var t=this;this.multipleSelection2=[],e.forEach(function(e){t.multipleSelection2.push(e.id)})},addClick:function(){var e=this;if(0!==this.multipleSelection1.length){var t={lineId:this.options.lineId,userIds:this.multipleSelection1.join(",")};this.addloadFlag=!0,this.addBind(t).then(function(t){t.flag?(e.$message.success(e.$t("vgPower.bindSuccess")),e.gridL.name="",e.gridR.name="",e.listL(),e.listR(),e.loadFlag=!1):e.$message.error(e.$t("vgPower.bindError")),e.addloadFlag=!1}).catch(function(t){e.addloadFlag=!1})}else this.$message.warning(this.$t("vgPower.choseAccount"))},removeClick:function(){var e=this;if(0!==this.multipleSelection2.length){var t={lineId:this.options.lineId,userIds:this.multipleSelection2.join(",")};this.removeloadFlag=!0,this.deleteUnBindByUserIdAndLineId(t).then(function(t){t.flag?(e.$message.success("解绑成功"),e.listL(),e.listR()):e.$message.error("解绑失败"),e.removeloadFlag=!1}).catch(function(t){e.removeloadFlag=!1})}else this.$message.warning(this.$t("vgPower.choseAccount"))}}),watch:{"options.flag":function(e){e||(this.options.name="")}},mounted:function(){this.listL(),this.listR()}},s=i("2877"),l=Object(s.a)(r,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"up-add"},[i("el-row",[i("el-col",{staticStyle:{width:"44.66667%"},attrs:{span:10}},[i("el-form",[i("el-form-item",{attrs:{label:"所有工作人员"}},[i("el-input",{attrs:{placeholder:"请输入人员名称",maxlength:30},model:{value:e.gridL.name,callback:function(t){e.$set(e.gridL,"name","string"==typeof t?t.trim():t)},expression:"gridL.name"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.listL},slot:"append"})],1)],1)],1),i("cv-grid",{ref:"leftTable",attrs:{params:e.gridL,url:"/rules/line/queryNotDustManInfoList","default-height":400},on:{"selection-change":e.handlerChange}},[i("el-table-column",{attrs:{type:"selection",width:"50"}}),i("el-table-column",{attrs:{label:"名称",prop:"name"}})],1)],1),i("el-col",{staticStyle:{"text-align":"center",margin:"200px 10px 0 10px"},attrs:{span:2}},[i("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{loading:e.addloadFlag},on:{click:e.addClick}},[e._v(e._s(e.$t("vgPower.add")))]),i("el-button",{staticStyle:{"margin-left":"0px"},attrs:{loading:e.removeloadFlag},on:{click:e.removeClick}},[e._v(e._s(e.$t("vgPower.remove")))])],1),i("el-col",{staticStyle:{width:"44.66667%"},attrs:{span:10}},[i("el-form",[i("el-form-item",{attrs:{label:"当前绑定的人员"}},[i("el-input",{attrs:{placeholder:"请输入人员名称",maxlength:30},model:{value:e.gridR.name,callback:function(t){e.$set(e.gridR,"name","string"==typeof t?t.trim():t)},expression:"gridR.name"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.listR},slot:"append"})],1)],1)],1),i("cv-grid",{ref:"rightTable",attrs:{params:e.gridR,url:"/rules/line/queryAlreadyDustManInfoList","default-height":400},on:{"selection-change":e.handlerChange2}},[i("el-table-column",{attrs:{type:"selection",width:"50"}}),i("el-table-column",{attrs:{label:"名称",prop:"name"}})],1)],1)],1)],1)},[],!1,null,null,null).exports,d={name:"routerManageMain",mixins:[n.a],components:{routerManageAddUser:l},props:{lineFlag:{type:Boolean,default:!1}},data:function(){return{searchPar:{name:""},lineIdArray:[],dialog:{flag:!1,title:"绑定人员",size:"dialog-large",name:"",lineId:"",companyId:""}}},computed:{_table:function(){return this.$refs.routerTable}},methods:Object(a.a)({},Object(o.b)(["deleteLine"]),{search:function(){this._table.tableInitial()},add:function(){this.$emit("createAndUp",{title:"新建路线"})},modify:function(e){this.$emit("createAndUp",{title:"修改路线",id:e.id})},remove:function(e){var t=this,i=e.row.id;this.confirmPrompt().then(function(){t.deleteLine({id:i}).then(function(e){e.flag?(t.search(),t.$message.success(t.$t("action.removeSuccess"))):t.$message.error(t.$t("action. removeFail"))})})},bindUser:function(e){this.dialog.name="routerManageAddUser",this.dialog.lineId=e.id,this.dialog.companyId=e.enterpriseId,this.dialog.flag=!0}}),watch:{lineFlag:function(e){e&&this.search()}},mounted:function(){this.search()}},c=Object(s.a)(d,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("cv-operation",[i("el-form-item",[i("el-input",{attrs:{placeholder:"请输入线路名称搜索",clearable:"",maxlength:30},model:{value:e.searchPar.name,callback:function(t){e.$set(e.searchPar,"name","string"==typeof t?t.trim():t)},expression:"searchPar.name"}})],1),i("el-form-item",[i("cv-tool",{attrs:{name:e.$route.name,data:e.$store.getters.manageMenus,"is-modify":!1,"is-remove":!1},on:{search:e.search,add:e.add}})],1)],1),i("cv-content",[i("cv-grid",{ref:"routerTable",attrs:{params:e.searchPar,url:"/rules/line/queryListLine"}},[i("el-table-column",{attrs:{label:"名称",prop:"name"}}),i("el-table-column",{attrs:{label:"所属公司",prop:"enterpriseName"}}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("cv-table-tool",{attrs:{name:e.$route.name,data:e.$store.getters.manageMenus},on:{modify:function(i){return e.modify(t.row)},remove:function(i){return e.remove(t)}}}),i("div",{staticClass:"cv-table-tool"},[i("cv-span",{attrs:{type:"success"},nativeOn:{click:function(i){return e.bindUser(t.row)}}},[e._v("绑定")])],1)]}}])})],1)],1),i("el-dialog",{attrs:{visible:e.dialog.flag,title:e.dialog.title,"custom-class":e.dialog.size},on:{"update:visible":function(t){return e.$set(e.dialog,"flag",t)}}},[i(e.dialog.name,{tag:"component",attrs:{options:e.dialog}})],1)],1)},[],!1,null,null,null).exports,u={name:"routerManageMapOperation",components:{CvAreadrawmap:i("8ebd").a},props:{visible:{default:!1},model:{},type:{type:String,default:"add"},title:{}},data:function(){var e=this;return{enterpriseId:"",show:!1,rules:{name:[{required:!0,message:"内容不能为空"}],width:[{required:!0,message:"宽度不能为空"}],starttime:[{required:!0,message:"开始时间不能为空"}],endtime:[{required:!0,validator:function(t,i,a){if(""!==i&&i){var n=i,o=e.model.starttime;if("string"==typeof n&&(n=new Date(n)),"string"==typeof o&&(o=new Date(o)),!o)return a();6048e5<n.getTime()-o.getTime()?a(new Error("时间间隔不能超过7天")):n.getTime()<o.getTime()?a(new Error("结束时间不能小于开始时间")):a()}else a(new Error("结束时间不能为空"))}}]}}},methods:{returnPage:function(){this.$emit("update:visible",!1),this.$emit("update:model",{})},saveRouter:function(e){var t=this,i={enterpriseId:this.model.enterpriseId||this.enterpriseId,name:e.name,width:parseInt(e.width),starttime:"string"==typeof e.starttime?e.starttime:this.$filter.format(e.starttime,"yyyy-MM-dd"),endtime:"string"==typeof e.endtime?e.endtime:this.$filter.format(e.endtime,"yyyy-MM-dd"),detetailsDusts:this.setMesList(e.list),id:this.model.id,type:4,mapType:parseInt(this.$store.getters.mapType)};this.$store.dispatch("add"==this.type?"addLine":"updateLine",i).then(function(i){i.flag?(t.returnPage(),e.successCallback(),t.$message.success("add"==t.type?"新增线路成功":"修改线路成功")):t.$message.error(t.$t("error."+i.errorCode))}).catch(function(){t.$message.error("服务器报错")})},setMesList:function(e){var t=[];return e.forEach(function(e){t.push({latitude:e.mapLatitude,longitude:e.mapLongitude})}),t}}},m={name:"routerManage",components:{RouterManageMain:c,RoutermanageMapOperation:Object(s.a)(u,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("cv-areadrawmap",{attrs:{title:e.title,visible:e.visible,rules:e.rules,"router-type":"line",type:e.type,model:e.model},on:{"update:visible":function(t){e.visible=t},"update:model":function(t){e.model=t},"return-page":e.returnPage,save:e.saveRouter}},[i("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"add"==e.type,expression:'type=="add" ? true :false'}],attrs:{label:"所属公司","v-show":"add"==e.type}},[i("cv-dropdown-tree",{attrs:{url:"/enterprise/getEnterpriseTreeList"},model:{value:e.enterpriseId,callback:function(t){e.enterpriseId=t},expression:"enterpriseId"}})],1),i("el-form-item",{attrs:{label:"线路名称:",prop:"name"}},[i("el-input",{model:{value:e.model.name,callback:function(t){e.$set(e.model,"name","string"==typeof t?t.trim():t)},expression:"model.name"}})],1),i("el-form-item",{attrs:{label:"宽度(m):",prop:"width"}},[i("el-input-number",{staticStyle:{width:"220px"},attrs:{min:1,max:15},model:{value:e.model.width,callback:function(t){e.$set(e.model,"width","string"==typeof t?t.trim():t)},expression:"model.width"}})],1),i("el-form-item",{attrs:{label:"起始日期:",prop:"starttime"}},[i("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"date",editable:!1,placeholder:"选择日期"},model:{value:e.model.starttime,callback:function(t){e.$set(e.model,"starttime",t)},expression:"model.starttime"}})],1),i("el-form-item",{attrs:{label:"结束日期:",prop:"endtime"}},[i("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm:ss",editable:!1,placeholder:"选择日期"},model:{value:e.model.endtime,callback:function(t){e.$set(e.model,"endtime",t)},expression:"model.endtime"}})],1)],1)},[],!1,null,null,null).exports},data:function(){return{componentName:"",visible:!1,options:{},type:"",title:"新建路线",lineFlag:!1}},methods:{createAndUp:function(e){e.id?this.modify(e):this.add(),this.title=e.title},add:function(){this.componentName="RoutermanageMapOperation",this.type="add",this.visible=!0},modify:function(e){var t=this;this.type="modify",this.$store.dispatch("queryRouterById",{id:e.id,mapType:parseInt(this.$store.getters.mapType)}).then(function(e){e.flag?(t.options=t.setMesList(e.data),setTimeout(function(e){t.componentName="RoutermanageMapOperation",t.visible=!0},500)):t.$message.error(t.$t("error."+e.errorCode))})},setMesList:function(e){var t=/([\d]{4})-([\d]{2})-([\d]{2})([\s\S]*)/gi;return e.detetailsDusts.forEach(function(e){e.mapLatitude=e.latitude,e.mapLongitude=e.longitude}),e.list=e.detetailsDusts,e.starttime=e.starttime.replace(t,"$1-$2-$3"),e.endtime=e.endtime.replace(t,"$1-$2-$3"),e}},watch:{visible:function(e){e?this.lineFlag=!1:(this.lineFlag=!0,this.componentName="")}}},p=Object(s.a)(m,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("router-manage-main",{attrs:{lineFlag:e.lineFlag},on:{createAndUp:e.createAndUp}}),i(e.componentName,{tag:"component",attrs:{title:e.title,visible:e.visible,type:e.type,model:e.options},on:{"update:visible":function(t){e.visible=t},"update:model":function(t){e.options=t}}})],1)},[],!1,null,null,null).exports;p.install=function(e){e.component(p.name,p)},t.default=p},"8ebd":function(e,t,i){"use strict";i("7f7f");var a=i("bd86"),n=(i("ac6a"),i("cebc")),o=i("2f62"),r={name:"CvAreaDrawmap",props:{title:{},model:{},rules:{},visible:{type:Boolean,default:!1},routerType:{type:String,default:"line"},type:{type:String,default:"add"},className:{type:String,default:"routermanage-dropdown-width"}},data:function(){return{isShow:!0,routerOptions:null,saveLoad:!1,dropFlag:!0}},computed:Object(n.a)({},Object(o.c)(["mapName"]),{_formMethods:function(){return this.$refs.form},_mapMethods:function(){return this.$refs.map.mapMethods}}),watch:{model:function(e){var t=this;if("add"!==this.type)var i=setTimeout(function(a){clearTimeout(i),i=null,t.detailLngLatPoints(e.list)},100)},type:function(e){"add"==e&&this._mapMethods.setCity("上海市")},visible:function(e){e&&(this.dropFlag=!0)}},methods:{returnPage:function(){this.resetRouter(),this.saveLoad=!1,this.$emit("update:model",{}),this.$emit("update:visible",!1),this.$emit("return-page"),this.dropFlag=!1},createRouter:function(){var e=this;this.dropFlag=!1,this.resetRouter(!1);var t=this.routerType.charAt(0).toUpperCase()+this.routerType.substring(1);this._mapMethods["onclick"+t](function(t){e.dropFlag=!0,e.routerOptions=t.overlay})},resetRouter:function(e){var t=!(0<arguments.length&&void 0!==e)||e;this._mapMethods.clearOverlays(),this.routerOptions=null,t&&this._formMethods.resetFields()},saveRouter:function(){var e=this,t=this;this._formMethods.validate(function(i){if(!e.routerOptions)return e.$message.error("您未在地图上创建区域！");i&&(e.saveLoad=!0,e.$emit("save",Object(n.a)({},e.model,{type:e.type,list:e.getPolygonOptions(e.routerOptions),successCallback:function(){t.saveLoad=!1,t.$emit("update:model",{}),t.resetRouter(),t.dropFlag=!1},errorCallback:function(){t.saveLoad=!1,t.dropFlag=!1}})))})},getPolygonOptions:function(e){switch(this.routerType){case"polygon":var t=this._mapMethods.getPolygonOptions(e).points;return this._getPolygonOptions(t);case"rectangle":var i=this._mapMethods.getPolygonOptions(e).points;return this._getRectangleOptions(i);case"line":var a=this._mapMethods.getLineOptions(e).points;return this._getLineOptions(a);case"circle":var n=this._mapMethods.getCircleOptions(e).points;return this._getCircleOptions(n)}},_getPolygonOptions:function(e,t,i){var n=1<arguments.length&&void 0!==t?t:["mapLongitude","mapLatitude"],o=2<arguments.length&&void 0!==i?i:["lng","lat"],r=[];return e.forEach(function(e){var t;r.push((t={},Object(a.a)(t,n[0],e[o[0]]),Object(a.a)(t,n[1],e[o[1]]),t))}),r},_getRectangleOptions:function(e,t,i){var a=1<arguments.length&&void 0!==t?t:["mapLongitude","mapLatitude"],n=2<arguments.length&&void 0!==i?i:["lng","lat"],o=[],r=[],s=[],l={},d={};return e.forEach(function(e){r.push(e[n[0]]),s.push(e[n[1]])}),l[a[0]]=Math.max.apply(Math,r),l[a[1]]=Math.max.apply(Math,s),d[a[0]]=Math.min.apply(Math,r),d[a[1]]=Math.min.apply(Math,s),o.push(l,d),o},_getLineOptions:function(e,t,i){var n=1<arguments.length&&void 0!==t?t:["mapLongitude","mapLatitude"],o=2<arguments.length&&void 0!==i?i:["lng","lat"],r=[];return e.forEach(function(e){var t;r.push((t={},Object(a.a)(t,n[0],e[o[0]]),Object(a.a)(t,n[1],e[o[1]]),t))}),r},_getCircleOptions:function(e,t,i){var n,o=1<arguments.length&&void 0!==t?t:["mapLongitude","mapLatitude"],r=2<arguments.length&&void 0!==i?i:["lng","lat"],s=[];return s.push((n={},Object(a.a)(n,o[0],e.center[r[0]]),Object(a.a)(n,o[1],e.center[r[1]]),n)),s},detailLngLatPoints:function(e){if(this.$service.isArray(e)&&0<e.length){var t=null;switch(this.routerType){case"polygon":t=this._getPolygonOptions(e,["lng","lat"],["mapLongitude","mapLatitude"]);break;case"rectangle":t=this._getRectangleOptions(e,["lng","lat"],["mapLongitude","mapLatitude"]);break;case"line":t=e}this.routerOptions=this._mapMethods["mapAdd"+this.routerType](t,{}),this._mapMethods.getBestView(this.routerOptions.points)}},mapReady:function(){"modify"==this.type&&this.detailLngLatPoints(this.model.list)}}},s=(i("eb84"),i("2877")),l=Object(s.a)(r,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"routermanage-map-operation"},[i(e.mapName,{ref:"map",tag:"component",staticClass:"routermanage-map",attrs:{mapLoaded:e.mapReady}}),i("cv-dropdown",{staticClass:"routermanage-operation",attrs:{"class-name":e.className,visible:e.dropFlag,placement:"top-end"}},[i("el-button",{attrs:{type:"success",icon:"el-icon-edit",circle:""},on:{click:function(t){e.dropFlag=!e.dropFlag}}}),i("div",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("h2",{staticClass:"cv-mapoperation-title"},[e._v("\n                "+e._s(e.title)+"\n                "),i("cv-icon",{staticStyle:{float:"right"},attrs:{name:"remove"},on:{click:e.returnPage}})],1),i("el-form",{ref:"form",staticClass:"cv-mapoperation-form",attrs:{"label-width":"120px",model:e.model,rules:e.rules}},[e._t("default"),i("div",{staticStyle:{"text-align":"right"}},[i("el-button",{attrs:{type:"primary"},on:{click:e.createRouter}},[e._v("创建")]),i("el-button",{on:{click:e.resetRouter}},[e._v("重置")]),i("el-button",{attrs:{loading:e.saveLoad},on:{click:e.saveRouter}},[e._v("保存")])],1)],2)],1)],1)],1)},[],!1,null,null,null).exports;l.install=function(e){e.component(l.name,l)},t.a=l},b0ad:function(e,t,i){"use strict";(function(e){i("7f7f"),t.a={methods:{confirmPrompt:function(e,t){var i=this,a=e||this.$t("action.confirmIsRemove");return new Promise(function(e,n){i.$confirm(a,i.$t("action.tip"),{confirmButtonText:i.$t("action.confirm"),cancelButtonText:i.$t("action.cancel"),type:"warning"}).then(function(){e()}).catch(function(){"function"==typeof t&&t()})})},timeLimitFunc:function(e,t,i){if(e&&t)return((new Date(t)-new Date(e))/864e5).toFixed(1)<=i||this.$message.error({message:this.$t("请选择时间范围在"+i+"天内")});this.$message.error({message:this.$t("请选择时间范围")})},addRemoveUnique:function(e,t,i){var a=e.length,n=t.length;return n<a?{name:"add",data:this.$service.isUnique(e,t,i)}:a<n?{name:"remove",data:this.$service.isUnique(t,e,i)}:a==n?{name:"equal",data:this.$service.isUnique(e,t,i)}:void 0},showTooltip:function(e,t){var i=e.target,a=this.$refs[t];a.referenceElm=i,a.$refs.popper.style.display="none",a.doDestroy(),a.setExpectedState(!0),a.handleShowPopper()},mouseenterShowTip:function(e,t,i){var a=e.target;if(a.scrollWidth>a.offsetWidth||i)return this.showTooltip(e,t),i?i.startTime+"~"+i.endTime:a.innerText},mouseenterShowToolTip:function(e,t,i){var a=e.target;return this.showTooltip(e,t),!i&&a.innerText},mouseoverHideTip:function(e){var t=this.$refs[e];t&&(t.setExpectedState(!1),t.handleClosePopper())},asyncDownloadScript:function(t,i){var a=this,n=0<arguments.length&&void 0!==t?t:"Baidu",o=1<arguments.length?i:void 0;return e[n]?e[n]._preloader?e[n]._preloader:Promise.resolve(e[n]):(e[n]={},e[n]._preloader=new Promise(function(t,i){var r=document.createElement("script");r.src=o,e.document.body.appendChild(r),a.$service.isIe()&&a.$service.IE_VERSION<11?r.onreadystatechange=function(){"loaded"!=r.readyState&&"complete"!=r.readyState||(t(e[n]),e[n]._preloader=null)}:r.onload=function(){t(e[n]),e[n]._preloader=null}}),e[n]._preloader)}}}}).call(this,i("c8ba"))},eb84:function(e,t,i){"use strict";var a=i("efa7");i.n(a).a},efa7:function(e,t,i){}}]);