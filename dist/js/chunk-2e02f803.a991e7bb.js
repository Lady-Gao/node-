(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2e02f803"],{"20b4":function(t,e,i){},"20d4":function(t,e,i){"use strict";i.r(e),i("20d6"),i("c5f6"),i("96cf");var a,r,n,s=i("3b8d"),o=(i("7f7f"),i("456d"),i("ac6a"),i("cebc")),c=i("2f62"),l=i("7650"),m=i("4728").a,u=i("afa1").a,h=(i("a481"),i("3b2b"),{mixins:[i("b0ad").a],computed:Object(o.a)({},Object(c.c)(["user","socketPassenger"]),{_middleMethods:function(){return this.$refs.middle}}),data:function(){return{pushShow:!1,tooltipContent:"",max:10}},methods:{_template:function(t){return this._compileTemplate('\n                <div class="cv-row">\n                    <span class="cv-col cv-col-6 notice-items">{{plateCode}}</span>\n                    <span class="cv-col cv-col-6 notice-items">{{upNum}}</span>\n                    <span class="cv-col cv-col-6 notice-items">{{downNum}}</span>\n                    <span class="cv-col cv-col-6 notice-items">{{startTime}}</span>\n                </div>\n            ',t)},_compileTemplate:function(t,e){if(this.$service.isObject(e)){var i=t;return Object.getOwnPropertyNames(e).forEach(function(t){var a=new RegExp("{{"+t+"}}","g");i=i.replace(a,e[t])}),i}},handlerClick:function(){this.pushShow=!1},mouseenterHandler:function(t){this.$myJq.delegation(t,"SPAN")&&(this.tooltipContent=this.mouseenterShowTip(t,"tooltip"))}},watch:{socketPassenger:function(t){t&&(this.pushShow=!0,this._middleMethods.createContent(this._template(t)))}}}),p=(i("551b"),i("2877")),d=Object(p.a)(h,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.pushShow,expression:"pushShow"}],staticClass:"cv-topPassenger"},[i("div",{staticClass:"cv-topPassenger-header"},[i("cv-icon",{staticClass:"cv-topPassenger-close",attrs:{name:"remove",color:"#fff"},nativeOn:{click:function(e){return t.handlerClick(e)}}})],1),i("el-tooltip",{ref:"tooltip",attrs:{content:t.tooltipContent,placement:"top",effect:"light"}}),i("el-row",{staticClass:"cv-topPassenger-theader",staticStyle:{background:"#dfe6ec"}},[i("el-col",{staticClass:"theader-item notice-items",attrs:{span:6}},[t._v(t._s(t.$t("cL.carNumber")))]),i("el-col",{staticClass:"theader-item notice-items",attrs:{span:6}},[t._v("上车人数")]),i("el-col",{staticClass:"theader-item notice-items",attrs:{span:6}},[t._v("下车人数")]),i("el-col",{staticClass:"theader-item notice-items",attrs:{span:6}},[t._v("到站时间")])],1),i("cv-flyweight",{ref:"middle",staticClass:"cv-topPassenger-flyweight",attrs:{max:t.max},nativeOn:{mouseover:function(e){return t.mouseenterHandler(e)},mouseout:function(e){return t.mouseoverHideTip("tooltip")}}})],1)},[],!1,null,null,null).exports,f={name:"MulticarMonitor",mixins:[l.a],components:{CvMaptool:function(){return i.e("chunk-451aee8a").then(i.bind(null,"e7c5"))},vehicleMessage:m,CvBottomTabs:u,passengerDialog:d},data:function(){return{mapInitial:!1,mapLoading:!1,currentId:null,treeActive:!1,monitorflg:!0,timer:null,language:"zh-CN",isLoadMap:!1,AllVehicles:{},lineMarker:[],lineFlag:!1,lineobj:[],loop:null,markersArray:[],isShow:{flag:!1},IconName:""}},computed:Object(o.a)({},Object(c.c)(["mapName","mapType","onlineList","socketVehicle","isAttention","socketEnterprise","multicar_markerList","multicar_vehiclesLists","multicar_storageAllVehicles","multicar_monitorTree","multicar_currentVehicle","multicar_vehicleListsLibrary"]),{_tabsMethods:function(){return this.$refs.tabs}}),watch:{multicar_currentVehicle:function(t,e){this.currentId=t.vehicleId;var i=this.multicar_markerList[t.vehicleId],a=this.multicar_markerList[e.vehicleId];e&&a&&t.vehicleId!=e.vehicleId&&(a.label.setStyle&&a.label.setStyle({backgroundColor:"#f8f8f8",color:"#666"}),a.setTop(!1),this.cleanCarLine()),t&&i&&(i.label.setStyle&&i.label.setStyle({backgroundColor:"black",color:"#fff"}),i.setTop(!0)),this.lineFlag=!0,i&&this.lineMarker.push(i)},monitorflg:function(t){t?this.inifiniteVehicleLocation():this.clearTimerout()},isLoadMap:function(t){var e=this;if(this.clearTimerout(),!t){if(this.loop)return!1;this.loop=setTimeout(function(){clearTimeout(e.loop),e.loop=null,e.inifiniteVehicleLocation()},500)}},multicar_storageAllVehicles:function(t){0==t.length&&(this.multicar_setCurrentVehicle(),this.markersArray=[]),t.length&&(this.IconName=t[t.length-1].vehicleIcon||t[t.length-1].icon)},socketVehicle:function(t){var e=this,i=t.vehicleId,a=t.operation;t.id=i,"DELETE"==a&&(this.multicar_storageAllVehicles.forEach(function(t,a){t.id==i&&e.multicar_storageAllVehicles.splice(a,1)}),this.handlerMonitor_removecarFromMap([t]))}},beforeDestroy:function(){if(this._tabsMethods){var t=this._tabsMethods.getAllNodes();this.setMonitorVehicles(t)}this.monitorflg=!1},mounted:function(){this.AllVehicles=this.arrToObj(),this.setMonitorVehicles()},created:function(){this.language=localStorage.getItem("language")},methods:Object(o.a)({},Object(c.b)(["setMonitorVehicles","setStoreVehicleData","multicar_addMarker","multicar_removeMarker","multicar_addCarsMess","getMultiVehicleLastLocationList","multicar_storageAllVehicle","multicar_setCurrentVehicle","multicar_addVehicleList","multicar_removeVehicleList","multicar_updateVehicleList"]),{arrToObj:function(){var t=this.multicar_storageAllVehicles,e={};return t.forEach(function(t){e[t.id]=t}),e},mapInitialLoadPoints:function(){var t=this,e=Object.keys(this.multicar_markerList);0<e.length?this.handlerMonitor_addcarToMap(e,function(){return t.mapInitial=!0}):this.mapInitial=!0},handlerMonitor:function(t){var e=t.name,i=t.data;switch(this.multicar_storageAllVehicle(t),e){case"check":this.mapLoading=!0,this.handlerMonitor_addcarToMap(i);break;case"cancel":this.handlerMonitor_removecarFromMap(i)}},position:function(t){this.getBest(t)},handlerClick:function(t){var e=t.type,i=t.checked;4==e&&i&&!this.mapLoading&&this.getBest(t)},getBest:function(t){var e=t.id,i=t.text,a=t.plateCode,r=t.vehicleId,n=this.$refs.map.mapMethods.moveToCenter,s=this.multicar_markerList[e||r],o=this.multicar_vehiclesLists[e||r];s?(this.multicar_setCurrentVehicle(o),this.isShow.flag=!0,n(s.point,17)):this.$message.warning("".concat(this.$t("multiCar.car")).concat(i||a).concat(this.$t("action.nopositionmess")))},getCarMonitorData:(n=Object(s.a)(regeneratorRuntime.mark(function t(e){var i,a,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.map(function(t){return t.id?t.id:t}).join(","),this.isLoadMap=!0,t.next=4,this.getMultiVehicleLastLocationList({mapType:this.mapType,vehicleIds:i});case 4:return a=t.sent,r=a.data,t.abrupt("return",r);case 7:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)}),handlerMonitor_addcarToMap:(r=Object(s.a)(regeneratorRuntime.mark(function t(e,i){var a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getCarMonitorData(e);case 2:a=t.sent,Array.isArray(a)&&0<a.length?this.$refs.map.mapMethods&&this.mapChunkLoadToMap(a,i):this.mapLoading=!1;case 4:case"end":return t.stop()}},t,this)})),function(t,e){return r.apply(this,arguments)}),cleanCarLine:function(){for(var t in this.lineobj)this.$refs.map.mapMethods.removeOverlay(this.lineobj[t]);this.lineMarker=[],this.lineobj=[]},handlerMonitor_removecarFromMap:function(t){var e=this,i=this.lineMarker.length,a=(this.multicar_currentVehicle.vehicleId,this.$refs.map.mapMethods.markerClustererremoveMarkers),r=t.map(function(t){return e.multicar_removeVehicleList(t.id),0<i&&e.lineMarker[i-1].id==t.id&&e.cleanCarLine(),t.id?e.multicar_markerList[t.id]:e.multicar_markerList[t]});this.multicar_removeMarker(r),a(r);var n=Object.keys(this.multicar_vehiclesLists),s=n[n.length-1],o=this.multicar_markerList[s],c=0<n&&n[s];!o&&c&&this.multicar_setCurrentVehicle(c)},getParams:function(t){var e=4==this.mapType?t.mapLongitude||"0.0":Number(t.mapLongitude),i=4==this.mapType?t.mapLatitude||"0.0":Number(t.mapLatitude);return Object(o.a)({},t,{id:t.vehicleId,text:t.plateCode,mapLongitude:e,mapLatitude:i})},mapChunkLoadToMap:function(t,e){var i=this,a=this,r=this.$refs.map.mapMethods.addEventListener;this.mapChunkToMap(t,function(t){var e=i.$filter.isOnline(a.getParams(t),!1,i.$store.getters.mapName,t.icon),n=i.createMarker(a.getParams(t),e);r(n,"click",function(){i.getBest(t)}),i.multicar_addMarker(n),i.multicar_addCarsMess(Object(o.a)({},t,{id:t.vehicleId}))},function(){if(a.$refs.map){i.mapLoading=!1,i.isLoadMap=!1;var t=Object.keys(a.multicar_vehiclesLists),r=a.multicar_markerList,n=t[t.length-1];return i.multicar_setCurrentVehicle(a.multicar_vehiclesLists[n]),"function"==typeof e&&e(),i.markersArray=Object.keys(r).map(function(t){return r[t]}),i.markersArray}})},inifiniteVehicleLocation:function(){var t=this;this.monitorflg&&0<this.multicar_storageAllVehicles.length&&this.inifiniteDetail(this.multicar_storageAllVehicles,function(){t.timer=setTimeout(function(){t.clearTimerout(),t.inifiniteVehicleLocation()},5e3)})},toggleTree:function(t){this.treeActive=t||!this.treeActive},clearTimerout:function(){clearTimeout(this.timer),this.timer=null},moveMarker:function(t,e){if(this.$refs.map){var i=this.$refs.map.mapMethods,a=i.point,r=i.setPointIcon,n=i.setPosition,s=i.setRotation;if(t){var o=this.$filter.isOnline(e,!1,this.$store.getters.mapName,e.icon),c=a({lng:e.mapLongitude,lat:e.mapLatitude});r(t,o),n(t,c),s(t,Number(e.direction)),t.point=c,this.multicar_addMarker(t)}}},drawLine:function(t){var e=this.lineMarker.length,i=0<e&&this.lineMarker[e-1].id,a=0<e&&this.multicar_markerList[i].point;if(t.vehicleId==i){var r=this.$refs.map.mapMethods.mapAddline([{lng:"number"==typeof a.lng?a.lng:a.lng(),lat:"number"==typeof a.lat?a.lat:a.lat()},{lng:Number(t.mapLongitude),lat:Number(t.mapLatitude)}]);this.lineobj.push(r)}},inifiniteDetail:(a=Object(s.a)(regeneratorRuntime.mark(function t(e,i){var a,r,n,s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=this,t.next=3,this.getCarMonitorData(e);case 3:if(r=t.sent,n=this.multicar_storageAllVehicles,!(Array.isArray(r)&&0<r.length)){t.next=9;break}this.mapChunkToMap(r,function(t){a.lineFlag&&a.drawLine(t),-1<n.findIndex(function(e){return e.id==t.vehicleId})?(s.moveMarker(s.multicar_markerList[t.vehicleId],t),s.multicar_addCarsMess(Object(o.a)({},t,{id:t.vehicleId}))):s.handlerMonitor_removecarFromMap([t])},function(){if(a.$refs.map)return a.setCurrentCarLocationMess(),"function"==typeof i&&i(),[]}),t.next=11;break;case 9:return"function"==typeof i&&i(),t.abrupt("return",[]);case 11:case"end":return t.stop()}},t,this)})),function(t,e){return a.apply(this,arguments)}),setCurrentCarLocationMess:function(){var t=this.$refs.map.mapMethods,e=t.getZoom,i=t.moveToCenter,a=this.multicar_currentVehicle.vehicleId,r=this.multicar_markerList[a],n=this.multicar_vehiclesLists[a];this.multicar_setCurrentVehicle(n),r&&i(r.point,e())}})},v=(i("24f3"),Object(p.a)(f,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"multicar-monitor"},[i(t.mapName,{ref:"map",tag:"component",staticClass:"multicar-monitor-map",attrs:{zooms:[4,18],controls:["ScaleControl","NavigationControl","OverviewMapControl"],mapLoaded:t.mapInitialLoadPoints,language:t.language}}),i("cv-lazy-render",{attrs:{time:"1000",immediate:t.mapInitial,transition:"left"}},[i("cv-tabs-tree",{directives:[{name:"loading",rawName:"v-loading",value:t.mapLoading,expression:"mapLoading"}],ref:"tabs",class:["multicar-monitor-tabs",t.treeActive?"monitor-tabs__active":""],attrs:{"is-check":"","tree-data":t.multicar_monitorTree,"store-data":t.AllVehicles,"online-monitor":t.onlineList,"vehicle-monitor":t.socketVehicle,"attention-monitor":t.isAttention,"enterprise-fleet-monitor":t.socketEnterprise,"node-monitor":t.handlerMonitor},on:{"node-click":t.handlerClick}})],1),i("cv-lazy-render",{attrs:{time:"500",immediate:t.mapInitial,transition:"top"}},[i("cv-maptool",{staticClass:"multicar-monitor-tool",attrs:{"map-target":t.$refs.map,"current-mapname":t.mapName,markers:t.markersArray}},[i("span",{staticClass:"maptool-default maptool-monitor",on:{click:function(e){t.monitorflg=!t.monitorflg}}},[i("cv-icon",{attrs:{name:"shexiangtou1",color:t.monitorflg?"#409eff":""}}),i("span",{staticStyle:{"font-size":"14px"}},[t._v(t._s(t.monitorflg?t.$t("mM.menuMotinon"):t.$t("mM.unmenuMotinon")))])],1)])],1),i("passenger-dialog"),i("vehicle-message",{attrs:{data:t.multicar_currentVehicle,"is-show":t.isShow}}),i("cv-lazy-render",{attrs:{time:"500",immediate:t.mapInitial,transition:"bottom"}},[i("cv-bottom-tabs",{ref:"pagination",staticClass:"track-list",attrs:{"is-tree":!0,"current-id":t.multicar_currentVehicle.vehicleId,current:t.multicar_currentVehicle,data:t.multicar_vehiclesLists,mapType:t.mapType,all:t.multicar_storageAllVehicles},on:{toggleTree:t.toggleTree,position:t.position}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:5==t.mapType,expression:"mapType==5 ?true :false"}],staticStyle:{height:"14px",width:"266px",position:"absolute",bottom:"40px",left:"0","z-index":"1",background:"#fff"}},[t._v("GS（2015）1336号")])],1)},[],!1,null,null,null).exports);e.default=v},"24f3":function(t,e,i){"use strict";var a=i("4b64");i.n(a).a},"4b64":function(t,e,i){},"551b":function(t,e,i){"use strict";var a=i("20b4");i.n(a).a},7650:function(t,e,i){"use strict";e.a={methods:{mapChunkToMap:function(t,e,i){var a=this;Array.isArray(t)&&this.$service.chunk(t,function(t){"function"==typeof e&&e(t)},function(t){a.mapChunkToMap_addPoints("function"==typeof i&&i())},10)},createMarker:function(t,e){var i=this.$refs.map.mapMethods,a=i.mapAddpoint,r=i.addLabel,n=i.markerClustererAddMarker,s=a({longitude:t.positionBean?t.positionBean.longitude:t.mapLongitude,latitude:t.positionBean?t.positionBean.latitude:t.mapLatitude},e,{width:32,height:32});return s.id=t.id,s.label=r(s,t.text),n(s),s},mapChunkToMap_addPoints:function(t){this.$refs.map&&(0,this.$refs.map.mapMethods.getBestView)(t)}}}}}]);