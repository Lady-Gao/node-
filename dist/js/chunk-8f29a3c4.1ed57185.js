(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-8f29a3c4"],{"0c62":function(e,t,a){"use strict";var n=a("8591");a.n(n).a},"2a24":function(e,t,a){"use strict";var n=a("dbc0");a.n(n).a},"425b":function(e,t,a){},"4a43":function(e,t,a){"use strict";a.r(t),a("c5f6"),a("ac6a");var n=a("cebc"),s=a("2f62"),i={props:{options:{}},data:function(){return{height:500,fence:{ruleName:"",ruleType:"",type:101},items:[{value:null,label:this.$t("action.all")},{value:"1",label:this.$t("common.fence.circle")},{value:"2",label:this.$t("common.fence.rectangle")},{value:"3",label:this.$t("common.fence.polygon")},{value:"4",label:this.$t("common.fence.line")}],overlay:null,infoWindow:null}},computed:Object(n.a)({},Object(s.c)(["mapName"]),{_table:function(){return this.$refs.beastTable},_mapMethods:function(){return this.$refs.map.mapMethods}}),methods:{rowRender:function(e){switch(e.ruleType){case 1:return this.$t("common.fence.circle");case 2:return this.$t("common.fence.rectangle");case 3:return this.$t("common.fence.polygon");case 4:return this.$t("common.fence.line")}},searchClickLoadGrid:function(){this._table.tableInitial()},selectFence:function(e){var t=this;this._mapMethods.clearOverlays(),this.overlay&&this._mapMethods.removeOverlay(this.overlay),this.infoWindow&&this._mapMethods.closeInfoWindow(this.infoWindow);var a={id:e.row.id,mapType:this.$store.getters.mapType,type:e.row.type};this.$store.dispatch("queryGetFenceRule",a).then(function(e){if(e.flag){var a="",n={},s=t,i=function(e){s.infoWindow=e};switch(e.data.ruleType){case 1:var r=e.data.requestPoint[0],o={lat:r.latitude,lng:r.longitude},l=e.data.radius;t.overlay=t._mapMethods.mapAddcircle(o,l),a=t.tContent(e.data),n=t._mapMethods.point(o),t._mapMethods.overlayClickOpenInfoWindow(t.overlay,n,a,i,{}),t._mapMethods.openInfoWindow(a,t.overlay,n);break;case 2:var c=[],p=[],d=[],m={};0<e.data.requestPoint.length&&(e.data.requestPoint.forEach(function(e){p.push(Number(e.latitude)),d.push(Number(e.longitude)),c.push({lat:e.latitude,lng:e.longitude})}),m.minLng=Math.min.apply(Math,d),m.minLat=Math.min.apply(Math,p),m.maxLng=Math.max.apply(Math,d),m.maxLat=Math.max.apply(Math,p),t.overlay=t._mapMethods.mapAddrectangle(m,{}),a=t.tContent(e.data),n=t._mapMethods.point(c[0]),t._mapMethods.overlayClickOpenInfoWindow(t.overlay,t.overlay.getBounds().getCenter(),a,i,{}),t._mapMethods.openInfoWindow(a,t.overlay,t.overlay.getBounds().getCenter()));break;case 3:var u=[];0<e.data.requestPoint.length&&(e.data.requestPoint.forEach(function(e){u.push({lat:e.latitude,lng:e.longitude})}),t.overlay=t._mapMethods.mapAddpolygon(u,{}),a=t.tContent(e.data),n=t._mapMethods.point(u[0]),t._mapMethods.overlayClickOpenInfoWindow(t.overlay,t.overlay.getBounds().getCenter(),a,i,{}),t._mapMethods.openInfoWindow(a,t.overlay,t.overlay.getBounds().getCenter()));break;case 4:if(0<e.data.requestPoint.length){var f=[];e.data.requestPoint.forEach(function(e){f.push({lat:e.latitude,lng:e.longitude})}),t.overlay=t._mapMethods.mapAddline(f,{}),a=t.tContent(e.data),n=t._mapMethods.point(f[0]),t._mapMethods.overlayClickOpenInfoWindow(t.overlay,n,a,i,{}),t._mapMethods.openInfoWindow(a,t.overlay,n)}}}})},tContent:function(e){var t='<div style="padding-top:5px;padding-bottom:5px;">';if(t+="<div style='font-size:16px;'><span>"+this.$t("fenceManage.ruleName")+"：</span><span>".concat(e.ruleName,"</span></div>"),e.area&&(t+="<div style='font-size:16px;'><span>"+this.$t("fenceManage.area")+"：</span><span>".concat(this.filterArea(e.area),"</span></div>")),t+="<div style='font-size:16px;'><span>"+this.$t("fenceManage.areaType")+"：",0<e.areaNameAndType.length)for(var a=e.areaNameAndType,n=0;n<a.length;n++)switch(e.areaNameAndType[n].areaType){case 2:t+="<div style='text-indent:20px;font-size:14px;'><span>".concat(a[n].areaName," :</span></div>"),t+="<div style='text-indent:40px;font-size:12px;'><span>"+this.$t("fenceManage.aseconds")+"：</span><span>".concat(a[n].aseconds," (s)</span></div>"),t+="<div style='text-indent:40px;font-size:12px;'><span>"+this.$t("fenceManage.aspeed")+"：</span><span>".concat(a[n].aspeed," (km/h)</span></div>");break;case 1:t+="<div style='text-indent:20px;font-size:14px;'><span>".concat(a[n].areaName," :</span></div>"),t+="<div style='text-indent:40px;font-size:12px;'><span>"+this.$t("fenceManage.sTime")+"：</span><span>".concat(a[n].startTime,"</span></br><span style='margin-left:40px'>")+this.$t("fenceManage.eTime")+"：</span><span>".concat(a[n].endTime,"</span></span></div>");break;default:t+="<div style='text-indent:20px;font-size:14px;'><span>".concat(a[n].areaName,"</div>")}return t+"</div>"},addFence:function(){this.options.name="fenceAction",this.options.id="",this.options.isModify=!1,this.options.type=101},updateFence:function(e){this.options.name="fenceAction",this.options.id=e.row.id,this.options.isModify=!0,this.options.type=e.row.type},removeFence:function(e){var t=this;this.$confirm(this.$t("action.confirmIsRemove"),this.$t("action.tip"),{confirmButtonText:this.$t("action.confirm"),cancelButtonText:this.$t("action.cancel"),type:"warning"}).then(function(){t.$http({url:"/fenece/deletefencerule",params:{id:e.row.id,type:e.row.type}}).then(function(e){e.flag?(t.$message.success({message:t.$t("action.actionSuccess")}),t._table.tableInitial(),t.overlay&&t._mapMethods.removeOverlay(t.overlay),t._mapMethods.clearOverlays()):t.$message.error({message:t.$t("error."+e.errorCode)})})}).catch(function(){t.$message.info({message:t.$t("action.cancelRemove")})})},filterArea:function(e){switch(e){case 1:return"装货区";case 2:return"禁区";case 3:return"倾倒区"}}},mounted:function(){}},r=(a("6103"),a("2877")),o=Object(r.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("cv-operation",{attrs:{position:"left"}},[a("el-form-item",{attrs:{label:e.$t("fenceManage.ruleName"),prop:"ruleName"}},[a("el-input",{staticStyle:{width:"140px"},attrs:{size:"small",placeholder:e.$t("placeholder.inputValue")},model:{value:e.fence.ruleName,callback:function(t){e.$set(e.fence,"ruleName",t)},expression:"fence.ruleName"}})],1),a("el-form-item",{attrs:{label:e.$t("fenceManage.ruleType"),prop:"ruleType"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{size:"small",placeholder:e.$t("placeholder.selectValue")},model:{value:e.fence.ruleType,callback:function(t){e.$set(e.fence,"ruleType",t)},expression:"fence.ruleType"}},e._l(e.items,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-form-item",[a("cv-tool",{attrs:{name:e.$route.name,data:e.$store.getters.monitorMenu,"is-modify":!1,"is-remove":!1,"is-export":!1},on:{add:e.addFence,search:e.searchClickLoadGrid}})],1)],1),a("cv-content",[a("cv-grid",{ref:"beastTable",staticClass:"left",attrs:{params:e.fence,url:"/fenece/queryfencerulepage"}},[a("el-table-column",{attrs:{label:e.$t("fenceManage.ruleName"),prop:"ruleName"}}),a("el-table-column",{attrs:{label:e.$t("fenceManage.ruleType"),prop:"ruleType",formatter:e.rowRender}}),a("el-table-column",{attrs:{label:e.$t("fenceManage.remark"),prop:"remarksss"}}),a("el-table-column",{attrs:{label:e.$t("fenceManage.options")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("cv-span",{staticStyle:{float:"left","padding-right":"10px"},attrs:{type:"info"},nativeOn:{click:function(a){return e.selectFence(t)}}},[e._v(e._s(e.$t("power.look")))]),a("cv-table-tool",{staticStyle:{float:"left"},attrs:{name:e.$route.name,data:e.$store.getters.monitorMenu},on:{modify:function(a){return e.updateFence(t)},remove:function(a){return e.removeFence(t)}}})]}}])})],1),a("div",{staticClass:"right"},[a("el-row",{staticStyle:{height:"100%"}},[a(e.mapName,{ref:"map",tag:"component",staticStyle:{width:"100%",height:"100%",overflow:"hidden",margin:"0"}})],1)],1)],1)],1)},[],!1,null,"70c41511",null).exports,l=(a("6b54"),a("28a5"),a("20d6"),a("7f08")),c={props:{options:{}}},p=(a("0c62"),{components:{fenceLine:Object(r.a)(c,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("cv-scrollbar",{staticClass:"fence-lineSet"},[a("el-form",{attrs:{"label-width":"120px"}},e._l(e.options,function(t){return a("div",{key:t.num,staticClass:"line-item"},[a("el-form-item",{attrs:{label:"编号"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.sectionsId,callback:function(a){e.$set(t,"sectionsId",a)},expression:"data.sectionsId"}})],1),a("el-form-item",{attrs:{label:"属性"}},[a("el-checkbox-group",{model:{value:t.areaAttributes,callback:function(a){e.$set(t,"areaAttributes",a)},expression:"data.areaAttributes"}},[a("el-checkbox",{attrs:{label:"1",name:"type"}},[e._v(e._s("行驶时间"))]),a("el-checkbox",{attrs:{label:"2",name:"type"}},[e._v(e._s("限速"))])],1)],1),a("el-form-item",{attrs:{label:"拐点编号"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.inflectionId,callback:function(a){e.$set(t,"inflectionId",a)},expression:"data.inflectionId"}})],1),a("el-form-item",{attrs:{label:"行驶过长阀值"}},[a("el-input",{model:{value:t.desconds,callback:function(a){e.$set(t,"desconds",a)},expression:"data.desconds"}})],1),a("el-form-item",{attrs:{label:"行驶不足阀值"}},[a("el-input",{model:{value:t.dlowseconds,callback:function(a){e.$set(t,"dlowseconds",a)},expression:"data.dlowseconds"}})],1),a("el-form-item",{attrs:{label:"最高速度"}},[a("el-input",{model:{value:t.aspeed,callback:function(a){e.$set(t,"aspeed",a)},expression:"data.aspeed"}})],1),a("el-form-item",{attrs:{label:"超速持续时间"}},[a("el-input",{model:{value:t.aseconds,callback:function(a){e.$set(t,"aseconds",a)},expression:"data.aseconds"}})],1),a("el-form-item",{attrs:{label:"宽度"}},[a("el-input",{model:{value:t.width,callback:function(a){e.$set(t,"width",a)},expression:"data.width"}})],1),a("el-form-item",{attrs:{label:"限制转速"}},[a("el-input",{model:{value:t.limitrpm,callback:function(a){e.$set(t,"limitrpm",a)},expression:"data.limitrpm"}})],1)],1)}),0)],1)},[],!1,null,null,null).exports},props:{options:{}},data:function(){var e=this;return{discot:!1,changePoint:!1,orginArr:[],latOrgin:Number,lanOrgin:Number,isNext:!1,next:!1,linesData:[],showfenceLine:!1,subStatus:!1,selectDisabled:!0,radius:0,disBtn:!1,btnText:!1,typeShow:{radius:!1,rectangle:!1,polyEditor:!1,line:!1},fenceForm:{id:"",ruleName:"",fenceType:[],enterPoints:"",radius:"",lbrectangle:"",rtrectangle:"",poly:"",line:"",ruleType:"",remark:"",date:[],time:[],speed:"0",speedTime:"0",limitSpeed:"",dateType:0},rules:{ruleName:[{required:!0,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{min:2,max:15,message:this.$filter.lanReplace(this.$t("filter.Length"),{min:2,max:15})},{pattern:/^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$/,message:this.$t("filter.type4")}],enterPoints:[{required:!1,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{pattern:/^(-?(([1-9]?[0-9])|(1[0-7][0-9])|(180))([.])?\d*)[,](-?(([1-8]?[0-9])|(90))([.])?\d*)$/,message:"经度纬度为数字,中间逗号隔开"}],radius:[{required:!1,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{pattern:/^[1-9][0-9]*$/,message:this.$t("filter.type2")+"或者第一位数字不能为0"}],lbrectangle:[{required:!1,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{pattern:/([0-9]+[.]?[0-9]*)([,]{1})([0-9]+[.]?[0-9]*)$/,message:this.$t("filter.type2")+"或者第一位数字不能为0"}],rtrectangle:[{required:!1,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{pattern:/([0-9]+[.]?[0-9]*)([,]{1})([0-9]+[.]?[0-9]*)$/,message:this.$t("filter.type2")+"或者第一位数字不能为0"}],poly:[{required:!1,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{pattern:/(([0-9]+[.]?[0-9]*)([,]{1})([0-9]+[.]?[0-9]*);)+$/,message:"正确格式:经度,纬度;经度,纬度;..."}],line:[{required:!1,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{pattern:/(([0-9]+[.]?[0-9]*)([,]{1})([0-9]+[.]?[0-9]*);)+$/,message:"正确格式:经度,纬度;经度,纬度;..."}],remark:[{min:0,max:150,message:this.$filter.lanReplace(this.$t("filter.Length"),{min:0,max:150})}],date:[{type:"array",required:!1,message:this.$t("el.datepicker.selectDate"),trigger:"change"},{validator:function(t,a,n){-1<e.fenceForm.fenceType.findIndex(function(e){return"1"==e})&&0==e.fenceForm.dateType?0==a.length?n(new Error("请选择日期")):null==a[0]||null==a[1]?n(new Error("请选择日期")):n():n()},trigger:"blur,change"}],time:[{type:"array",required:!1,message:this.$t("el.datepicker.selectTime"),trigger:"change"},{validator:function(t,a,n){-1<e.fenceForm.fenceType.findIndex(function(e){return"1"==e})&&1==e.fenceForm.dateType?0==a.length?n(new Error("请选择时间")):null==a[0]||null==a[1]?n(new Error("请选择时间")):n():n()},trigger:"blur,change"}],speed:[{required:!0,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{validator:function(e,t,a){0<=t&&t-100<=0?a():a(new Error("限速范围0(km/h)-100(km/h)"))},trigger:"blur,change"},{pattern:/^[0-9]*$/,message:this.$t("filter.type2")}],speedTime:[{required:!0,message:this.$t("filter.notEmpty"),trigger:"blur,change"},{validator:function(e,t,a){0<=t&&t-100<=0?a():a(new Error("限速时长范围0(s)-100(s)"))},trigger:"blur,change"},{pattern:/^[0-9]*$/,message:this.$t("filter.type2")}],fenceType:[{type:"array",required:!0,message:"请选择围栏属性",trigger:"change"}]},areaTypeItems:[],items:[{value:"1",label:this.$t("common.fence.1"),disabled:!0},{value:"2",label:this.$t("common.fence.2"),disabled:!0},{value:"4",label:this.$t("common.fence.4"),disabled:!0},{value:"8",label:this.$t("common.fence.8"),disabled:!0},{value:"16",label:this.$t("common.fence.16"),disabled:!0},{value:"32",label:this.$t("common.fence.32"),disabled:!0},{value:"256",label:this.$t("common.fence.256"),disabled:!0},{value:"16384",label:this.$t("common.fence.16384"),disabled:!0},{value:"32768",label:this.$t("common.fence.32768"),disabled:!0}],isShow:!0,overlay:null}},computed:Object(n.a)({},Object(s.c)(["mapName"]),{_mapMethods:function(){return this.$refs.map.mapMethods},isShowDateTime:function(){return-1<this.fenceForm.fenceType.findIndex(function(e){return"1"==e})?(this.options.isModify&&0==this.fenceForm.time.length&&(this.fenceForm.time=[new Date(2016,9,10,0,0),new Date(2016,9,10,23,59)]),!0):(this.rules.date[0].required=!1,this.rules.time[0].required=!1)},isShowDateInput:function(){return-1<this.fenceForm.fenceType.findIndex(function(e){return"1"==e})&&0==this.fenceForm.dateType?this.rules.date[0].required=!0:(this.rules.date[0].required=!1,!(this.fenceForm.date=[]))},isShowTimeInput:function(){return-1<this.fenceForm.fenceType.findIndex(function(e){return"1"==e})&&1==this.fenceForm.dateType?(this.rules.time[0].required=!0,this.options.isModify||(this.fenceForm.time=[new Date(2016,9,10,0,0),new Date(2016,9,10,23,59)]),!0):this.rules.time[0].required=!1},isShowLimitSpeed:function(){return-1<this.fenceForm.fenceType.findIndex(function(e){return"2"==e})}}),methods:{readyLoad:function(){""!=this.options.id?(this.getFenceToUpdate(this.options.id,this.options.type),this.fenceForm.id=this.options.id,this.disBtn=!0):this.disBtn=!1},typeChange:function(e){var t=e.length-1;"512"==e[t]||"1024"==e[t]||e[t]},nextBtn:function(){var e=this;this.$refs.fenceForm.validate(function(t){if(!t)return!1;e.showfenceLine=!e.showfenceLine})},comeBack:function(){this.options.name="fenceMain",this.options.id="",this.$refs.fenceForm.resetFields()},Addcircle:function(){this.next=!1,this.typeShow={radius:!0,rectangle:!1,polyEditor:!1,line:!1},this.rules.enterPoints[0].required=!0,this.rules.radius[0].required=!0,this.rules.lbrectangle[0].required=!1,this.rules.rtrectangle[0].required=!1,this.rules.poly[0].required=!1,this.rules.line[0].required=!1,this.selectDisabled=!1,this.clearOverlay(),this.fenceForm.ruleType=1},Addrectangle:function(){this.next=!1,this.typeShow={radius:!1,rectangle:!0,polyEditor:!1,line:!1},this.btnText=!0,this.rules.enterPoints[0].required=!1,this.rules.radius[0].required=!1,this.rules.lbrectangle[0].required=!0,this.rules.rtrectangle[0].required=!0,this.rules.poly[0].required=!1,this.rules.line[0].required=!1,this.selectDisabled=!1,this.clearOverlay(),this.fenceForm.ruleType=2},Addpolygon:function(){this.next=!1,this.typeShow={radius:!1,rectangle:!1,polyEditor:!0,line:!1},this.rules.enterPoints[0].required=!1,this.rules.radius[0].required=!1,this.rules.lbrectangle[0].required=!1,this.rules.rtrectangle[0].required=!1,this.rules.poly[0].required=!0,this.rules.line[0].required=!1,this.selectDisabled=!1,this.clearOverlay(),this.fenceForm.ruleType=3},Addline:function(){this.next=!0,this.typeShow={radius:!1,rectangle:!1,polyEditor:!1,line:!0},this.rules.enterPoints[0].required=!1,this.rules.radius[0].required=!1,this.rules.lbrectangle[0].required=!1,this.rules.rtrectangle[0].required=!1,this.rules.poly[0].required=!1,this.rules.line[0].required=!0,this.selectDisabled=!1,this.clearOverlay(),this.fenceForm.ruleType=4},clearOverlay:function(){this.clearMap()},clearMap:function(){this.overlay&&(this._mapMethods.clearOverlays(),this.overlay=null,this.fenceForm.ruleType="")},previews:function(){var e=this;this._mapMethods.clearOverlays(),this.overlay&&this._mapMethods.removeOverlay(this.overlay),this.infoWindow&&this._mapMethods.closeInfoWindow(this.infoWindow),this.$refs.fenceForm.validate(function(t){if(!t)return!1;switch(e.fenceForm.ruleType){case 1:var a=e.fenceForm.enterPoints.split(","),n=e.fenceForm.radius,s=e._mapMethods.transform(parseFloat(a[1]),parseFloat(a[0]));e.overlay=e._mapMethods.mapAddcircle(s,n);break;case 2:var i={},r=e.fenceForm.lbrectangle.split(","),o=e.fenceForm.rtrectangle.split(","),l=e._mapMethods.transform(parseFloat(r[1]),parseFloat(r[0])),c=e._mapMethods.transform(parseFloat(o[1]),parseFloat(o[0]));i.minLng=l.lng,i.minLat=c.lat,i.maxLng=c.lng,i.maxLat=l.lat,e.overlay=e._mapMethods.mapAddrectangle(i,{});break;case 3:var p=[],d=[];e.fenceForm.poly.substr(0,e.fenceForm.poly.length-1).split(";").forEach(function(t){d=t.split(","),p.push(e._mapMethods.transform(parseFloat(d[1]),parseFloat(d[0])))}),e.overlay=e._mapMethods.mapAddpolygon(p,{});break;case 4:var m=[],u=e.fenceForm.line.substr(0,e.fenceForm.line.length-1).split(";");e.linesData=[],u.forEach(function(t,a){e.linesData.push({sectionsId:a+1,areaAttributes:["0","0"],inflectionId:a+1,desconds:"0",dlowseconds:"0",aspeed:"1",aseconds:"2",width:"0",limitrpm:"1",mucktruckfencepro:"0",sequence:a+1});var n=t.split(",");m.push(e._mapMethods.transform(parseFloat(n[1]),parseFloat(n[0])))}),e.overlay=e._mapMethods.mapAddline(m,{})}})},submitFence:function(){var e=this;this.$refs.fenceForm.validate(function(t){if(!t)return!1;var a=e.getParmas();if(1==e.fenceForm.ruleType&&0==e.radius)return e.$message.error({message:"圆形半径不能为0"}),!1;""!=e.fenceForm.id?e.fenceActionBest("/fenece/updatefencerule",a):e.fenceActionBest("/fenece/insertfencerule",a)})},fenceActionBest:function(e,t){var a=this;this.subStatus=!0,this.$http({url:e,data:JSON.stringify(t)}).then(function(e){!e.flag&&e.errorCode?a.$message.error({message:a.$t("error."+e.errorCode)}):(a.$refs.fenceForm.resetFields(),a.clearOverlay(),a.options.id="",a.options.name="fenceMain",a.$message.success({message:a.$t("action.actionSuccess")})),a.subStatus=!1}).catch(function(){a.subStatus=!1})},getParmas:function(){var e=this,t=[],a=[];switch(this.fenceForm.fenceType.forEach(function(a){switch(a){case"1":0==e.fenceForm.dateType?t.push({areaType:a,startTime:l.a.format(e.fenceForm.date[0],"yyyy-MM-dd HH:mm:ss"),endTime:l.a.format(e.fenceForm.date[1],"yyyy-MM-dd HH:mm:ss"),dataType:e.fenceForm.dateType}):t.push({areaType:a,startTime:l.a.format(e.fenceForm.time[0],"HH:mm:ss"),endTime:l.a.format(e.fenceForm.time[1],"HH:mm:ss"),dataType:e.fenceForm.dateType});break;case"2":t.push({areaType:a,aseconds:e.fenceForm.speedTime+"",aspeed:e.fenceForm.speed+""});break;default:t.push({areaType:a})}}),this.fenceForm.ruleType){case 1:this.orginArr=this.fenceForm.enterPoints.split(","),a.push({latitude:parseInt(this.orginArr[1]*Math.pow(10,6)),longitude:parseInt(this.orginArr[0]*Math.pow(10,6))}),this.radius=parseInt(this.fenceForm.radius);break;case 2:var n={},s={},i=this.fenceForm.lbrectangle.split(","),r=this.fenceForm.rtrectangle.split(",");n.longitude=parseInt(i[0]*Math.pow(10,6)),n.latitude=parseInt(i[1]*Math.pow(10,6)),s.longitude=parseInt(r[0]*Math.pow(10,6)),s.latitude=parseInt(r[1]*Math.pow(10,6)),a.push(n,s);break;case 3:var o=[],c=this.fenceForm.poly.split(";");c.pop(),c.forEach(function(e){o=e.split(","),a.push({latitude:parseInt(o[1]*Math.pow(10,6)),longitude:parseInt(o[0]*Math.pow(10,6))})});break;case 4:var p=[],d=this.fenceForm.line.split(";");d.pop(),d.forEach(function(e){p=e.split(","),a.push({latitude:parseInt(p[1]*Math.pow(10,6)),longitude:parseInt(p[0]*Math.pow(10,6))})})}return{id:this.fenceForm.id,mapType:this.$store.getters.mapType,ruleName:this.fenceForm.ruleName,ruleType:this.fenceForm.ruleType,fenceType:2,linesData:this.linesData,requestPoint:a,radius:this.radius,remarksss:this.fenceForm.remark,areaNameAndType:t,type:this.options.type}},getFenceToUpdate:function(e,t){var a=this;function n(e){r.infoWindow=e}this.discot=!0,this._mapMethods.clearOverlays(),this.overlay&&this._mapMethods.removeOverlay(this.overlay),this.infoWindow&&this._mapMethods.closeInfoWindow(this.infoWindow);var s="",i={},r=this,o={id:e,mapType:this.$store.getters.mapType,type:t},l=this.$loading({text:"正在拼命加载中",target:document.querySelector(".el-card")});this.$store.dispatch("queryGetFenceRule",o).then(function(e){switch(a.fenceForm.ruleType=e.data.ruleType,e.data.areaNameAndType.forEach(function(e){e.aspeed&&(a.fenceForm.speed=e.aspeed+""),e.aseconds&&(a.fenceForm.speedTime=e.aseconds+"")}),e.data.ruleType){case 1:var t=e.data.requestPoint[0],r={lat:t.latitude,lng:t.longitude},o=e.data.originalPoint[0],c=e.data.radius;a.typeShow.radius=!0,a.latOrgin=Number(o.latitude)/Math.pow(10,6),a.lanOrgin=Number(o.longitude)/Math.pow(10,6),a.fenceForm.enterPoints=a.lanOrgin+","+a.latOrgin,a.fenceForm.radius=e.data.radius.toString(),a.radius=e.data.radius,a.overlay=a._mapMethods.mapAddcircle(r,c),s=a.tContent(e.data),i=a._mapMethods.point(r),a._mapMethods.overlayClickOpenInfoWindow(a.overlay,i,s,n,{}),a._mapMethods.openInfoWindow(s,a.overlay,i);break;case 2:var p=[],d=[],m=[],u={};a.typeShow.rectangle=!0;var f=e.data.originalPoint[1],h=e.data.originalPoint[0],y=Number(f.latitude)/Math.pow(10,6),g=Number(f.longitude)/Math.pow(10,6),v=Number(h.latitude)/Math.pow(10,6),b=Number(h.longitude)/Math.pow(10,6);a.fenceForm.lbrectangle=b+","+v,a.fenceForm.rtrectangle=g+","+y,0<e.data.requestPoint.length&&(e.data.requestPoint.forEach(function(e){d.push(Number(e.latitude)),m.push(Number(e.longitude)),p.push({latitude:e.latitude,longitude:e.longitude})}),u.minLng=Math.min.apply(Math,m),u.minLat=Math.min.apply(Math,d),u.maxLng=Math.max.apply(Math,m),u.maxLat=Math.max.apply(Math,d),a.overlay=a._mapMethods.mapAddrectangle(u,{}),s=a.tContent(e.data),i=a._mapMethods.point(p[0]),a._mapMethods.overlayClickOpenInfoWindow(a.overlay,a.overlay.getBounds().getCenter(),s,n,{}),a._mapMethods.openInfoWindow(s,a.overlay,a.overlay.getBounds().getCenter()));break;case 3:var w=[];a.typeShow.polyEditor=!0;var F=e.data.originalPoint,$="";F.forEach(function(e){$+=Number(e.longitude)/Math.pow(10,6)+","+Number(e.latitude)/Math.pow(10,6)+";"}),a.fenceForm.poly=$,0<e.data.requestPoint.length&&(e.data.requestPoint.forEach(function(e){w.push({lat:e.latitude,lng:e.longitude})}),a.overlay=a._mapMethods.mapAddpolygon(w,{}),s=a.tContent(e.data),i=a._mapMethods.point(w[0]),a._mapMethods.overlayClickOpenInfoWindow(a.overlay,a.overlay.getBounds().getCenter(),s,n,{}),a._mapMethods.openInfoWindow(s,a.overlay,a.overlay.getBounds().getCenter()));break;case 4:a.next=!0,a.typeShow.line=!0;var x=e.data.originalPoint,T="";if(x.forEach(function(e){T+=Number(e.longitude)/Math.pow(10,6)+","+Number(e.latitude)/Math.pow(10,6)+";"}),a.fenceForm.line=T,a.linesData=[],e.data.linesData.forEach(function(e,t){a.linesData.push({sectionsId:t+1,areaAttributes:e.areaAttributes,inflectionId:t+1,desconds:e.desconds,dlowseconds:e.dlowseconds,aspeed:e.aspeed,aseconds:e.aseconds,width:e.width,limitrpm:e.limitrpm,mucktruckfencepro:e.mucktruckfencepro,sequence:t+1})}),0<e.data.requestPoint.length){var M=[];e.data.requestPoint.forEach(function(e){M.push({lat:e.latitude,lng:e.longitude})}),a.overlay=a._mapMethods.mapAddline(M,{}),s=a.tContent(e.data),i=a._mapMethods.point(M[0]),a._mapMethods.overlayClickOpenInfoWindow(a.overlay,i,s,n,{}),a._mapMethods.openInfoWindow(s,a.overlay,i)}}a.areaTypeSetVal(e.data),l.close()})},areaTypeSetVal:function(e){var t=this,a="",n="";this.fenceForm.ruleName=e.ruleName,this.fenceForm.remark=e.remarksss,e.areaNameAndType.forEach(function(e){switch(t.fenceForm.fenceType.push(e.areaType.toString()),e.areaType){case 1:t.fenceForm.dateType=parseInt(e.dataType),0==t.fenceForm.dateType?(a=t.$service.dateTimeParse(e.startTime),n=t.$service.dateTimeParse(e.endTime),t.fenceForm.date=[a,n]):(a=t.$service.timeParse(e.startTime),n=t.$service.timeParse(e.endTime),t.fenceForm.time=[a,n]);break;case 2:t.fenceForm.speedTime=e.aseconds+"",t.fenceForm.speed=e.aspeed+"",t.isSpeed=!0}})},getIndexSplice:function(e){for(var t=this,a=function(a){var n=t.fenceForm.fenceType.findIndex(function(t){return t==e[a]});-1<n&&t.fenceForm.fenceType.splice(n,1)},n=0;n<e.length;n++)a(n)},removeRuleType:function(e){"1"==e.value&&(this.fenceForm.time=[],this.fenceForm.date=[],this.fenceForm.dateType=0,this.rules.date[0].required=!1,this.rules.time[0].required=!1)},tContent:function(e){var t='<div style="padding-top:5px;padding-bottom:5px;">';if(t+="<div style='font-size:16px;'><span>"+this.$t("fenceManage.ruleName")+"：</span><span>".concat(e.ruleName,"</span></div>"),e.area&&(t+="<div style='font-size:16px;'><span>"+this.$t("fenceManage.area")+"：</span><span>".concat(this.filterArea(e.area),"</span></div>")),t+="<div style='font-size:16px;'><span>"+this.$t("fenceManage.areaType")+"：",0<e.areaNameAndType.length)for(var a=e.areaNameAndType,n=0;n<a.length;n++)switch(e.areaNameAndType[n].areaType){case 2:t+="<div style='text-indent:20px;font-size:14px;'><span>".concat(a[n].areaName," :</span></div>"),t+="<div style='text-indent:40px;font-size:12px;'><span>"+this.$t("fenceManage.aseconds")+"：</span><span>".concat(a[n].aseconds," (s)</span></div>"),t+="<div style='text-indent:40px;font-size:12px;'><span>"+this.$t("fenceManage.aspeed")+"：</span><span>".concat(a[n].aspeed," (km/h)</span></div>");break;case 1:t+="<div style='text-indent:20px;font-size:14px;'><span>".concat(a[n].areaName," :</span></div>"),t+="<div style='text-indent:40px;font-size:12px;'><span>"+this.$t("fenceManage.sTime")+"：</span><span>".concat(a[n].startTime,"</span></br><span style='margin-left:40px'>")+this.$t("fenceManage.eTime")+"：</span><span>".concat(a[n].endTime,"</span></span></div>");break;default:t+="<div style='text-indent:20px;font-size:14px;'><span>".concat(a[n].areaName,"</div>")}return t+"</div>"}},watch:{overlay:function(e){e?this.selectDisabled=!1:(this.selectDisabled=!0,this.fenceForm.fenceType=[])},"fenceForm.line":function(e){var t=this;if(e&&!this.options.id){var a=this.fenceForm.line.substr(0,this.fenceForm.line.length-1).split(";");this.linesData=[],a.forEach(function(e,a){t.linesData.push({sectionsId:a+1,areaAttributes:["0","0"],inflectionId:a+1,desconds:"0",dlowseconds:"0",aspeed:"1",aseconds:"2",width:"0",limitrpm:"1",mucktruckfencepro:"0",sequence:a+1})})}},"fenceForm.ruleType":function(e){var t=[];if(4==e){var a=["1","4","8","16","32"];this.items.forEach(function(e){e.disabled=-1==a.indexOf(e.value),t.push(e)})}else{var n=this.$store.getters.user.enterpriseType;if(n)if(-1==n.indexOf("2")){var s=["1","2","4","8","16","32","256","16384","32768"];this.items.forEach(function(e){e.disabled=-1==s.indexOf(e.value),t.push(e)})}else this.items.forEach(function(e){e.disabled=!1,t.push(e)});else this.items.forEach(function(e){e.disabled=!1,t.push(e)})}this.areaTypeItems=t}}}),d=(a("2a24"),{components:{fenceMain:o,fenceAction:Object(r.a)(p,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a(e.mapName,{ref:"map",tag:"component",staticStyle:{width:"100%",height:"100%",overflow:"hidden",margin:"0"},attrs:{id:"fenceActionBest",mapLoaded:e.readyLoad}}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"formAction"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"line-height":"1","font-size":"18px"}},[e._v(e._s(e.$t("fenceManage.fenceManage")))]),a("el-button-group",{staticStyle:{float:"right"}},[a("el-button",{attrs:{size:"small",type:"success",disabled:e.discot},on:{click:e.previews}},[e._v(e._s("预览"))]),a("el-button",{attrs:{size:"small",type:"primary",loading:e.subStatus},on:{click:e.submitFence}},[e._v(e._s("保存"))]),e.next?a("el-button",{attrs:{size:"small"},on:{click:e.nextBtn}},[e._v("\n            "+e._s(e.showfenceLine?"上一步":"下一步")+"\n          ")]):e._e(),a("el-button",{attrs:{size:"small"},on:{click:e.comeBack}},[e._v(e._s(e.$t("action.back")))])],1)],1),a("cv-scrollbar",{staticClass:"formClass"},[a("el-form",{ref:"fenceForm",attrs:{model:e.fenceForm,rules:e.rules,inline:!0,"label-width":"110px"}},[a("el-form-item",{attrs:{label:e.$t("fenceManage.ruleType")}},[a("el-button-group",[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("common.fence.circle"),placement:"top-start"}},[a("el-button",{style:e.options.isModify&&1==e.fenceForm.ruleType?"background-color:#20a0ff;color:#fff":1==e.fenceForm.ruleType?"background-color:#20a0ff;color:#fff":"",attrs:{disabled:e.disBtn,icon:"el-icon-tsp-yuanxing"},on:{click:e.Addcircle}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("common.fence.rectangle"),placement:"top-start"}},[a("el-button",{style:e.options.isModify&&2==e.fenceForm.ruleType?"background-color:#20a0ff;color:#fff":2==e.fenceForm.ruleType?"background-color:#20a0ff;color:#fff":"",attrs:{disabled:e.disBtn,icon:"el-icon-tsp-rectangle"},on:{click:e.Addrectangle}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("common.fence.polygon"),placement:"top-start"}},[a("el-button",{style:e.options.isModify&&3==e.fenceForm.ruleType?"background-color:#20a0ff;color:#fff":3==e.fenceForm.ruleType?"background-color:#20a0ff;color:#fff":"",attrs:{disabled:e.disBtn,icon:"el-icon-tsp-duobianxing"},on:{click:e.Addpolygon}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("common.fence.line"),placement:"top-start"}},[a("el-button",{style:e.options.isModify&&4==e.fenceForm.ruleType?"background-color:#20a0ff;color:#fff":4==e.fenceForm.ruleType?"background-color:#20a0ff;color:#fff":"",attrs:{disabled:e.disBtn,icon:"el-icon-tsp-draw-polyline"},on:{click:e.Addline}})],1)],1)],1),a("el-form-item",{attrs:{label:e.$t("fenceManage.ruleName"),prop:"ruleName"}},[a("el-input",{staticClass:"inputStype",staticStyle:{width:"350px"},attrs:{size:"small",placeholder:e.$t("placeholder.inputValue")},model:{value:e.fenceForm.ruleName,callback:function(t){e.$set(e.fenceForm,"ruleName",t)},expression:"fenceForm.ruleName"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.typeShow.radius,expression:"typeShow.radius"}],attrs:{label:"中心点",prop:"enterPoints"}},[a("el-input",{staticClass:"inputStype",staticStyle:{width:"350px"},attrs:{size:"small",placeholder:"经度,纬度"},model:{value:e.fenceForm.enterPoints,callback:function(t){e.$set(e.fenceForm,"enterPoints",t)},expression:"fenceForm.enterPoints"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.typeShow.radius,expression:"typeShow.radius"}],attrs:{label:"半径(m)",prop:"radius"}},[a("el-input",{staticClass:"inputStype",staticStyle:{width:"350px"},attrs:{size:"small",placeholder:"半径"},model:{value:e.fenceForm.radius,callback:function(t){e.$set(e.fenceForm,"radius",t)},expression:"fenceForm.radius"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.typeShow.rectangle,expression:"typeShow.rectangle"}],attrs:{label:"左上角经纬度",prop:"lbrectangle"}},[a("el-input",{staticClass:"inputStype",staticStyle:{width:"350px"},attrs:{size:"small",placeholder:"经度,纬度"},model:{value:e.fenceForm.lbrectangle,callback:function(t){e.$set(e.fenceForm,"lbrectangle",t)},expression:"fenceForm.lbrectangle"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.typeShow.rectangle,expression:"typeShow.rectangle"}],attrs:{label:"右下角经纬度",prop:"rtrectangle"}},[a("el-input",{staticClass:"inputStype",staticStyle:{width:"350px"},attrs:{size:"small",placeholder:"经度,纬度"},model:{value:e.fenceForm.rtrectangle,callback:function(t){e.$set(e.fenceForm,"rtrectangle",t)},expression:"fenceForm.rtrectangle"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.typeShow.polyEditor,expression:"typeShow.polyEditor"}],attrs:{label:"经纬度",prop:"poly"}},[a("el-input",{staticClass:"inputStype",staticStyle:{width:"350px"},attrs:{size:"small",placeholder:"经度,纬度;经度,纬度"},model:{value:e.fenceForm.poly,callback:function(t){e.$set(e.fenceForm,"poly",t)},expression:"fenceForm.poly"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.typeShow.line,expression:"typeShow.line"}],attrs:{label:"经纬度",prop:"line"}},[a("el-input",{staticClass:"inputStype",staticStyle:{width:"350px"},attrs:{size:"small",placeholder:"经度,纬度;经度,纬度"},model:{value:e.fenceForm.line,callback:function(t){e.$set(e.fenceForm,"line",t)},expression:"fenceForm.line"}})],1),a("el-form-item",{attrs:{label:e.$t("fenceManage.areaType"),prop:"fenceType"}},[a("el-select",{staticStyle:{width:"350px"},attrs:{"collapse-tags":"",multiple:"",size:"small",placeholder:e.$t("placeholder.selectValue")},on:{change:e.typeChange,"remove-tag":e.removeRuleType},model:{value:e.fenceForm.fenceType,callback:function(t){e.$set(e.fenceForm,"fenceType",t)},expression:"fenceForm.fenceType"}},e._l(e.areaTypeItems,function(e){return a("el-option",{key:e.value,attrs:{disabled:e.disabled,label:e.label,value:e.value}})}),1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.isShowDateTime,expression:"isShowDateTime"}],attrs:{label:e.$t("fenceManage.dateTimeTYpe"),prop:"dateType"}},[a("el-radio-group",{staticStyle:{width:"350px"},model:{value:e.fenceForm.dateType,callback:function(t){e.$set(e.fenceForm,"dateType",t)},expression:"fenceForm.dateType"}},[a("el-radio",{attrs:{label:0,size:"small"}},[e._v(e._s(e.$t("fenceManage.selectDate")))]),a("el-radio",{attrs:{label:1,size:"small"}},[e._v(e._s(e.$t("fenceManage.selectTime")))])],1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.isShowDateInput,expression:"isShowDateInput"}],attrs:{label:e.$t("fenceManage.date"),prop:"date"}},[a("el-date-picker",{staticStyle:{width:"350px"},attrs:{size:"small",align:"right",type:"datetimerange",clearable:!1,editable:!1,placeholder:e.$t("el.datepicker.selectDate")},model:{value:e.fenceForm.date,callback:function(t){e.$set(e.fenceForm,"date",t)},expression:"fenceForm.date"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.isShowTimeInput,expression:"isShowTimeInput"}],attrs:{label:e.$t("fenceManage.time"),prop:"time"}},[a("el-time-picker",{staticStyle:{width:"350px"},attrs:{size:"small",align:"right",editable:!1,"is-range":"",clearable:!1,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:e.$t("el.datepicker.selectTime")},model:{value:e.fenceForm.time,callback:function(t){e.$set(e.fenceForm,"time",t)},expression:"fenceForm.time"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.isShowLimitSpeed,expression:"isShowLimitSpeed"}],attrs:{label:e.$t("fenceManage.aspeed"),prop:"speed"}},[a("el-input",{staticStyle:{width:"350px"},attrs:{maxlength:3,type:"text",size:"small"},model:{value:e.fenceForm.speed,callback:function(t){e.$set(e.fenceForm,"speed",t)},expression:"fenceForm.speed"}}),a("span",{staticStyle:{position:"absolute"}},[e._v(" (km/h)")])],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.isShowLimitSpeed,expression:"isShowLimitSpeed"}],attrs:{label:e.$t("fenceManage.aseconds"),prop:"speedTime"}},[a("el-input",{staticStyle:{width:"350px"},attrs:{maxlength:3,type:"text",size:"small"},model:{value:e.fenceForm.speedTime,callback:function(t){e.$set(e.fenceForm,"speedTime",t)},expression:"fenceForm.speedTime"}}),a("span",{staticStyle:{position:"absolute"}},[e._v(" (s)")])],1),a("el-form-item",{attrs:{label:e.$t("fenceManage.remark"),prop:"remark"}},[a("el-input",{staticClass:"inputStype",staticStyle:{width:"350px"},attrs:{type:"textarea",rows:3,size:"small",placeholder:e.$t("placeholder.inputValue")},model:{value:e.fenceForm.remark,callback:function(t){e.$set(e.fenceForm,"remark",t)},expression:"fenceForm.remark"}})],1)],1)],1)],1),a("fenceLine",{staticClass:"fenceLine",class:{fenceCurrent:!!e.showfenceLine},attrs:{options:e.linesData}})],1)],1)},[],!1,null,"2a5b0b40",null).exports},data:function(){return{options:{name:"fenceMain",power:[],id:""}}}}),m=Object(r.a)(d,function(){var e=this.$createElement;return(this._self._c||e)(this.options.name,{tag:"component",attrs:{options:this.options}})},[],!1,null,null,null).exports;t.default=m},6103:function(e,t,a){"use strict";var n=a("425b");a.n(n).a},8591:function(e,t,a){},dbc0:function(e,t,a){}}]);