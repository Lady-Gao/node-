(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-254dbd46"],{"0e39":function(e,t,a){},"5df3":function(e,t,a){"use strict";var r=a("02f4")(!0);a("01f9")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,a=this._i;return a>=t.length?{value:void 0,done:!0}:(e=r(t,a),this._i+=e.length,{value:e,done:!1})})},9620:function(e,t,a){},9957:function(e,t,a){"use strict";var r=a("0e39");a.n(r).a},a46f:function(e,t,a){"use strict";a.r(t),a("7f7f"),a("96cf");var r,n,i,s,o,l=a("3b8d"),c=a("cebc"),u=(a("ac6a"),a("5df3"),{props:["reload"],data:function(){return{pie:{},line:{},bar:{},optionsContext:[{color:"#00a5d6",name:"急加速",key:"hardAcceleration"},{color:"#00e4e2",name:"超速",key:"overspeed"},{color:"#ffd970",name:"碰撞",key:"collision"},{color:"#ff6693",name:"侧翻",key:"rollover"},{color:"#8078e4",name:"疲劳驾驶",key:"driverFatigue"},{color:"#edb9f0",name:"急转弯",key:"sharpTurns"},{color:"red",name:"急减速",key:"sharpSlowdown"}],loading:!1}},methods:{returnAllEchartBase64:function(){var e=this.$refs,t=e.one,a=e.two,r=e.three;return{distributeBase64:t.getEchart().getDataURL(),alarmBase64:a.getEchart().getDataURL(),vehicleRankingBase64:r.getEchart().getDataURL()}},requestInterface:function(e){var t=this;this.reload.f1=!0,Promise.all([this.queryDriverSumPieChart(e),this.findTrendLineChartInfoList(e),this.calcrankingchart(e)]).then(function(e){t.reload.f1=!1})},queryDriverSumPieChart:(i=Object(l.a)(regeneratorRuntime.mark(function e(t){var a,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this,e.next=3,this.$store.dispatch("queryDriverSumPieChart",t);case 3:return r=e.sent,n=r.data,r.flag&&this.$service.isObject(n)?this.pie={title:{text:"报警统计"},tooltip:{trigger:"item",formatter:"{b} : {c} ({d}%)"},series:[{type:"pie",radius:"60%",center:["50%","50%"],data:a.optionsContext.map(function(e){return{value:n[e.key]||0,name:e.name}})}],color:a.optionsContext.map(function(e){return e.color})}:this.pie={series:[{type:"pie",center:["50%","50%"],data:[]}],color:a.optionsContext.map(function(e){return e.color})},e.abrupt("return");case 8:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)}),findTrendLineChartInfoList:(n=Object(l.a)(regeneratorRuntime.mark(function e(t){var a,r,n,i,s,o,l,u,d,h,p,m,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this,e.next=3,this.$store.dispatch("findTrendLineChartInfoList",t);case 3:return r=e.sent,n=r.data,r.flag&&this.$service.isArray(n)&&0<n.length?(i=[],s=[],o=[],l=[],u=[],d=[],h=[],p=[],n.forEach(function(e){i.push(e.searchTime||0),s.push(e.hardAcceleration||0),o.push(e.overspeed||0),l.push(e.collision||0),u.push(e.rollover||0),d.push(e.driverFatigue||0),h.push(e.sharpTurns||0),p.push(e.sharpSlowdown||0)}),(m=[]).push(Object(c.a)({},this.optionsContext[0],{data:s})),m.push(Object(c.a)({},this.optionsContext[1],{data:o})),m.push(Object(c.a)({},this.optionsContext[2],{data:l})),m.push(Object(c.a)({},this.optionsContext[3],{data:u})),m.push(Object(c.a)({},this.optionsContext[4],{data:d})),m.push(Object(c.a)({},this.optionsContext[5],{data:h})),m.push(Object(c.a)({},this.optionsContext[6],{data:p})),f=m.map(function(e){return{name:e.name,type:"line",itemStyle:{normal:{color:e.color}},data:e.data}}),this.line={title:{text:"报警趋势图"},legend:{left:100,type:"scroll",data:a.optionsContext.map(function(e){return e.name})},tooltip:{trigger:"axis",confine:!0},grid:{top:"70px"},xAxis:{type:"category",boundaryGap:!1,data:i},series:f}):this.line={legend:{data:a.optionsContext.map(function(e){return e.name})},grid:{top:"50px"},xAxis:{type:"category",boundaryGap:!1,data:"暂无数据"}},e.abrupt("return");case 8:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)}),calcrankingchart:(r=Object(l.a)(regeneratorRuntime.mark(function e(t){var a,r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("calcrankingchart",t);case 2:return a=e.sent,r=a.data,a.flag&&this.$service.isArray(r)&&0<r.length?(n=[],i=[],r.forEach(function(e){n.push(e.plateCode),i.push(e.safeDrivingScore)}),this.bar={title:{text:"车辆驾驶行为评分"},xAxis:[{type:"category",data:n,axisTick:{alignWithLabel:!0}}],series:[{name:"分数",type:"bar",barWidth:"60%",data:i}]}):this.bar={xAxis:[{type:"category",data:"暂无数据",axisTick:{alignWithLabel:!0}}],series:[{name:"分数",type:"bar",barWidth:"60%",data:[]}]},e.abrupt("return");case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})}}),d=(a("dd36"),a("2877")),h=Object(d.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ul",{staticClass:"cv-dangeraction-echart"},[a("cv-echart",{ref:"one",staticClass:"echart-item lefttop",attrs:{name:"pie",data:e.pie}}),a("cv-echart",{ref:"two",staticClass:"echart-item righttop",attrs:{name:"line",data:e.line}}),a("cv-echart",{ref:"three",staticClass:"echart-item-auto rightbottom",attrs:{name:"bar",data:e.bar}})],1)},[],!1,null,"6680137c",null).exports,p={props:{reload:{},params:""},computed:{_table:function(){return this.$refs.table}},methods:{returnReportBase64:function(){return this.tableforcanvas.getDataURL()}},watch:{params:function(e){var t=this;e.dateType&&setTimeout(function(){t._table.tableInitial()},1e3)},"reload.f2":function(e){e&&this.$refs.table.store.scheduleLayout()}}},m=Object(d.a)(p,function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("cv-grid",{ref:"table",staticClass:"cv-dangeraction-report",attrs:{params:this.params,url:"/driver/findFocusAttentionList",bodyParser:!0}},[t("el-table-column",{attrs:{type:"index",width:"50"}}),t("el-table-column",{attrs:{label:"车牌号",prop:"plateCode"}}),t("el-table-column",{attrs:{label:"安全驾驶评分",prop:"safeDrivingScore"}}),t("el-table-column",{attrs:{label:"驾驶里程(km)",prop:"mileage"}}),t("el-table-column",{attrs:{label:"驾驶时长(min)",prop:"travelTime"}}),t("el-table-column",{attrs:{label:"平均速度(km/h)",prop:"avgSpeed"}}),t("el-table-column",{attrs:{label:"危险驾驶行为次数",prop:"count"}}),t("el-table-column",{attrs:{label:"主要危险驾驶行为",prop:"content"}})],1)],1)},[],!1,null,null,null).exports,f=a("a91e"),v=a("b0ad"),g={name:"dangeraction",components:{dangeractionEchart:h,dangeractionReport:m,dangeractionSwitchdate:f.a},mixins:[v.a],data:function(){return{PDFApi:null,textFlag:!1,exportFlag:!1,label:{},header:{type:"date",loading:!1,searchtime:null,enterpriseId:"",fleetIds:[]},tabs:{activeName:"tabs0",reload:!1},params:"",loading:!1,reloadAll:{f1:!1,f2:!1},baseMessage:{}}},methods:{search:function(){var e=this.header,t=e.searchtime,a=e.enterpriseId,r=e.fleetIds,n=e.type;if(""==a||"empty"==a||null==r||0==r.length)return this.$message.warning("公司和分组都不能为空"),!1;var i=Object(c.a)({},t,{enterpriseId:a,dateType:n,fleetIds:this.$service.isContext(r.join(","))?null:r.join(",")});this.tabs.reload=!0,t?"tabs0"==this.tabs.activeName?(this.queryBaseMessage(i),this.$refs.echart.requestInterface(i)):this.params=i:this.$message.warning("请选择时间")},queryBaseMessage:(o=Object(l.a)(regeneratorRuntime.mark(function e(t){var a,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.header.loading=!0,e.next=3,this.$store.dispatch("querydriversum",t);case 3:a=e.sent,r=a.data,n=a.flag,this.baseMessage=n&&!this.$service.isEmptyObject(r)?r:{},this.header.loading=!1;case 8:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)}),handleExport:(s=Object(l.a)(regeneratorRuntime.mark(function e(){var t,a,r,n,i,s,o,l,u,d,h,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.header,a=t.searchtime,r=t.enterpriseId,n=t.fleetIds,i=t.type,s=Object(c.a)({},a,{enterpriseId:r,dateType:i,fleetIds:this.$service.isContext(n.join(","))?null:n.join(",")}),o=this.$refs.echart,l=o.returnAllEchartBase64(),!a){e.next=19;break}if(""==r||"empty"==r||null==n||0==n.length)return this.$message.warning("公司和分组都不能为空"),e.abrupt("return",!1);e.next=8;break;case 8:return u=Object.assign(s,l),this.exportFlag=!0,e.next=12,this.$store.dispatch("exportDangerousDriving",u);case 12:d=e.sent,d.data,h=d.flag,p=d.errorCode,h?(this.$message.success("离线下载成功"),this.exportFlag=!1):(this.exportFlag=!1,this.$message.error(this.$t("error."+p))),e.next=20;break;case 19:this.$message.warning("请选择时间");case 20:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)}),handlerNodes:function(e){this.fleetIds=e}},watch:{"reloadAll.f1":function(e){this.loading=e}},computed:{_searchRangerLists:function(){return[{key:"date",name:"日"},{key:"week",name:"周"},{key:"month",name:"月"},{key:"quarter",name:"季"},{key:"daterange",name:"自定义"}]}}},b=(a("9957"),Object(d.a)(g,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cv-dangeraction"},[a("cv-operation",{attrs:{position:"left"}},[a("el-form-item",{attrs:{label:"查询区间:"}},[a("el-select",{model:{value:e.header.type,callback:function(t){e.$set(e.header,"type",t)},expression:"header.type"}},e._l(e._searchRangerLists,function(e){return a("el-option",{key:e.key,attrs:{value:e.key,label:e.name}})}),1)],1),a("dangeractionSwitchdate",{attrs:{type:e.header.type},model:{value:e.header.searchtime,callback:function(t){e.$set(e.header,"searchtime",t)},expression:"header.searchtime"}}),a("el-form-item",{attrs:{label:"所属公司/机构:"}},[a("cv-dropdown-tree",{attrs:{url:"/enterprise/findEnterpriseOrganizationTreeList",label:e.label},on:{"update:label":function(t){e.label=t}},model:{value:e.header.enterpriseId,callback:function(t){e.$set(e.header,"enterpriseId",t)},expression:"header.enterpriseId"}})],1),a("el-form-item",{attrs:{label:"选择车组:"}},[a("cv-dropdown-tree",{attrs:{url:"/enterprise/findFleetTreeList","is-check":!0,"un-node-filter":["type",null],"is-initial":!1,"auto-params":{enterpriseId:e.label.enterpriseId,pId:e.label.id,type:e.label.type}},model:{value:e.header.fleetIds,callback:function(t){e.$set(e.header,"fleetIds",t)},expression:"header.fleetIds"}})],1),a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.search}},[e._v("搜索")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.exportFlag,expression:"exportFlag"}],attrs:{size:"small"},on:{click:e.handleExport}},[e._v("导出")])],1)],1),a("cv-content",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{fill:!0}},[a("ul",{staticClass:"baseMessage"},[e._v("\n            入网车辆数： "+e._s(e.baseMessage.count||"--")+"(辆);\n            车辆在线率:  "+e._s(e.baseMessage.onlineRate||"--")+"(%);\n            车日均行驶里程: "+e._s(e.baseMessage.mileage||"--")+"(km);\n            车日均行驶时长: "+e._s(e.baseMessage.driverTime||"--")+"(min);\n            车日均危险驾驶次数: "+e._s(e.baseMessage.avgAlarmCount||"--")+"(次);\n        ")]),a("cv-tabs",{attrs:{titles:["图表信息","重点关注车辆列表"]},model:{value:e.tabs.activeName,callback:function(t){e.$set(e.tabs,"activeName",t)},expression:"tabs.activeName"}},[a("dangeractionEchart",{ref:"echart",attrs:{reload:e.reloadAll}}),a("dangeractionReport",{ref:"reportList",attrs:{reload:e.reloadAll,params:e.params}})],1)],1)],1)},[],!1,null,null,null).exports);b.install=function(e){e.component(b.name,b)},t.default=b},a91e:function(e,t,a){"use strict";a("c5f6");var r={props:{type:{type:[String],default:"date"}},data:function(){return{datevalue:null,daterangevalue:null,quartervalue:null,format:"yyyy-MM-dd",pickerOption:{disabledDate:function(e){return e.getTime()>Date.now()-864e5}}}},methods:{transformQuarter:function(e,t){1<arguments.length&&void 0!==t||this.format;var a=this.$filter,r=a.format,n=a.dateWeekMonth,i=r(e,r);return i&&n(i,this.format).quarter.num},enterNull:function(){return this.$emit("input",null)},enterDatevalue:function(e,t){var a=this.$filter,r=a.format,n=a.dateWeekMonth,i=(a.timeStamp,r(e,this.format)),s=r(new Date,this.format),o=n(i,this.format),l=o.week,c=o.month;switch(t){case"date":return this.$emit("input",{searchTime:i,startTime:r(e,"yyyy-MM-dd start"),endTime:r(e,"yyyy-MM-dd end")});case"week":return this.$emit("input",{searchTime:i,startTime:l.WeekStart,endTime:this.notBeyondCurrenttime(l.WeekEnd,s)});case"month":case"year":return this.$emit("input",{searchTime:i,startTime:c.MonthStart,endTime:this.notBeyondCurrenttime(c.MonthEnd,s)})}},enterQuartervalue:function(e,t){switch(Number(e)){case 1:return this.$emit("input",{searchTime:1});case 2:return this.$emit("input",{searchTime:4});case 3:return this.$emit("input",{searchTime:7});case 7:return this.$emit("input",{searchTime:10})}},enterDaterange:function(e,t){var a=this,r=this.$filter.format;if(this.$service.isArray(e)){var n=e.map(function(e){return r(e,a.format)});this.$emit("input",{startTime:n[0],endTime:n[1]})}},notBeyondCurrenttime:function(e,t){var a=this.$filter.timeStamp;return 0<=a(e)-a(t)?t:e}},computed:{_quarterLists:function(){var e=this.transformQuarter(new Date);return["01季度","02季度","03季度","04季度"].map(function(t,a){return{label:"".concat((new Date).getFullYear(),"(").concat(t,")"),value:a+1,disabled:e<a+1}})}},watch:{datevalue:function(e){if(!e)return this.enterNull();this.enterDatevalue(e,this.type)},quartervalue:function(e){if(!e)return this.enterNull();this.enterQuartervalue(e,this.type)},daterangevalue:function(e){if(!e)return this.enterNull();this.enterDaterange(e,this.type)},type:function(e){this.datevalue=null,this.daterangevalue=null,this.quartervalue=null}}},n=a("2877"),i=Object(n.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form-item",{attrs:{label:""}},["date"==e.type||"week"==e.type||"month"==e.type||"year"==e.type?a("el-date-picker",{attrs:{format:"week"==e.type?"yyyy第WW周":"",type:e.type,clearable:!1,"picker-options":e.pickerOption},model:{value:e.datevalue,callback:function(t){e.datevalue=t},expression:"datevalue"}}):"quarter"==e.type?a("el-select",{model:{value:e.quartervalue,callback:function(t){e.quartervalue=t},expression:"quartervalue"}},e._l(e._quarterLists,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})}),1):e._e(),a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:"daterange"==e.type,expression:"type=='daterange'"}],attrs:{type:"daterange","picker-options":e.pickerOption,clearable:!1},model:{value:e.daterangevalue,callback:function(t){e.daterangevalue=t},expression:"daterangevalue"}})],1)},[],!1,null,null,null);t.a=i.exports},b0ad:function(e,t,a){"use strict";(function(e){a("7f7f"),t.a={methods:{confirmPrompt:function(e,t){var a=this,r=e||this.$t("action.confirmIsRemove");return new Promise(function(e,n){a.$confirm(r,a.$t("action.tip"),{confirmButtonText:a.$t("action.confirm"),cancelButtonText:a.$t("action.cancel"),type:"warning"}).then(function(){e()}).catch(function(){"function"==typeof t&&t()})})},timeLimitFunc:function(e,t,a){if(e&&t)return((new Date(t)-new Date(e))/864e5).toFixed(1)<=a||this.$message.error({message:this.$t("请选择时间范围在"+a+"天内")});this.$message.error({message:this.$t("请选择时间范围")})},addRemoveUnique:function(e,t,a){var r=e.length,n=t.length;return n<r?{name:"add",data:this.$service.isUnique(e,t,a)}:r<n?{name:"remove",data:this.$service.isUnique(t,e,a)}:r==n?{name:"equal",data:this.$service.isUnique(e,t,a)}:void 0},showTooltip:function(e,t){var a=e.target,r=this.$refs[t];r.referenceElm=a,r.$refs.popper.style.display="none",r.doDestroy(),r.setExpectedState(!0),r.handleShowPopper()},mouseenterShowTip:function(e,t,a){var r=e.target;if(r.scrollWidth>r.offsetWidth||a)return this.showTooltip(e,t),a?a.startTime+"~"+a.endTime:r.innerText},mouseenterShowToolTip:function(e,t,a){var r=e.target;return this.showTooltip(e,t),!a&&r.innerText},mouseoverHideTip:function(e){var t=this.$refs[e];t&&(t.setExpectedState(!1),t.handleClosePopper())},asyncDownloadScript:function(t,a){var r=this,n=0<arguments.length&&void 0!==t?t:"Baidu",i=1<arguments.length?a:void 0;return e[n]?e[n]._preloader?e[n]._preloader:Promise.resolve(e[n]):(e[n]={},e[n]._preloader=new Promise(function(t,a){var s=document.createElement("script");s.src=i,e.document.body.appendChild(s),r.$service.isIe()&&r.$service.IE_VERSION<11?s.onreadystatechange=function(){"loaded"!=s.readyState&&"complete"!=s.readyState||(t(e[n]),e[n]._preloader=null)}:s.onload=function(){t(e[n]),e[n]._preloader=null}}),e[n]._preloader)}}}}).call(this,a("c8ba"))},dd36:function(e,t,a){"use strict";var r=a("9620");a.n(r).a}}]);