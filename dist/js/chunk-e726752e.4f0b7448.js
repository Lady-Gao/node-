(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-e726752e"],{"05c0":function(e,t,a){"use strict";a("7f7f"),a("20d6"),a("ac6a");var n=a("cebc"),i=a("3f4e"),r=a("2f62"),s={name:"CvPublictreeContent",components:{CvContent:i.a},props:{model:String,vehicleMonitor:Function,loading:Boolean,noresize:{default:!1,type:Boolean}},data:function(){return{entryList:[],condition:""}},computed:Object(n.a)({},Object(r.c)(["onlineList","isAttention","socketEnterprise","socketVehicle","vehicle_data","vehicleCondition"]),{isCheck:function(){switch(this.model){case"multi":return!0;case"single":default:return!1}},_treeMethods:function(){return this.$refs.tabs},_contentMethods:function(){return this.$refs.content}}),beforeDestroy:function(){var e=this._treeMethods.getAllNodes;this.setStoreVehicleSearchCondition(this.condition),this.setStoreVehicleData(e())},mounted:function(){var e=this._treeMethods.$refs.tree.reference().ztreeApi;e()&&e().checkAllNodes(!1)},methods:Object(n.a)({},Object(r.b)(["setStoreVehicleData","setStoreVehicleSearchCondition"]),{handlerVehicleSearch:function(e){this.condition=e},vehicle_Monitor:function(e){var t=e.data;if(e.name,"function"==typeof this.vehicleMonitor)switch(this.model){case"multi":return this.vehicle_Monitor_multi(e);case"single":return this.vehicleMonitor(t[0])}},vehicle_Monitor_multi:function(e){var t=this,a=e.data;switch(e.name){case"check":this.entryList=this.entryList.concat(a);break;case"cancel":a.forEach(function(e){var a=t.entryList.findIndex(function(t){return t.id==e.id});0<=a&&t.entryList.splice(a,1)})}this.vehicleMonitor(this.entryList)}})},o=(a("45d7"),a("2877")),c=Object(o.a)(s,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("cv-content",{ref:"content",attrs:{loading:e.loading,noresize:e.noresize}},[e.model?a("cv-tabs-tree",{ref:"tabs",staticClass:"vehiclemaster-tree",attrs:{slot:"aside","vehicle-search":e.vehicleCondition,"is-checked":e.isCheck,"tree-data":e.vehicle_data,"online-monitor":e.onlineList,"vehicle-monitor":e.socketVehicle,"attention-monitor":e.isAttention,"enterprise-fleet-monitor":e.socketEnterprise,"node-monitor":e.vehicle_Monitor},on:{"vehicle-choose-search":e.handlerVehicleSearch},slot:"aside"}):e._e(),e._t("default")],2)},[],!1,null,"2dfdf41b",null).exports;c.install=function(e){e.component(c.name,c)},t.a=c},"39ad":function(e,t,a){"use strict";a.r(t),a("28a5"),a("386d");var n=a("cebc"),i=a("2f62"),r=(a("ac6a"),{props:{data:{}},data:function(){return{plugins:{},mapName:"cvGaodeMap",gaodeHeat:[{js:"AMap.Heatmap"}]}},computed:Object(n.a)({},Object(i.c)(["mapType"]),{_map:function(){return this.$refs.heatMap},_mapMethods:function(){return this.$refs.heatMap.mapMethods}}),methods:{clearMap:function(){this._mapMethods.clearOverlays(),3==this.mapType&&this._mapMethods.heatMap([])},setHeatMap:function(e){this._mapMethods.heatMap(e)},getZoom:function(){return this._mapMethods.getZoom()},setZoom:function(e){return this._mapMethods.setZoom(e)},getBounds:function(){return this._mapMethods.getBounds()},addListener:function(e){this._mapMethods.addListener(this._map.map,"zoomend",e),this._mapMethods.addListener(this._map.map,"dragend",e)},getBestView:function(e){this._mapMethods.mapPanTo(this._mapMethods.point(e))},removeListener:function(e){this._mapMethods.removeListener("zoomend",e),this._mapMethods.removeListener("dragend",e)},setData:function(e){var t=[];return e.heatMapByDataList&&e.heatMapByDataList.forEach(function(e){t.push({count:parseInt(e.heat),lat:e.latitude,lng:e.longitude})}),t.count=parseInt(e.maxHeat),t},mapInit:function(){var e=this;setTimeout(function(){e.setZoom(4)},1e3)}},watch:{data:function(e){e?this.setHeatMap(this.setData(e)):this.clearMap()}}}),s=(a("e6f6"),a("2877")),o=Object(s.a)(r,function(){var e=this,t=e.$createElement;return(e._self._c||t)(e.mapName,{ref:"heatMap",tag:"component",staticClass:"singTrack-map",attrs:{mapLoaded:e.mapInit,plugins:e.gaodeHeat,zooms:[3,12]}})},[],!1,null,"3f7da43c",null).exports,c=a("5966"),l=a("05c0"),u={components:{heatMap:o,SwitchTimecontrol:c.a,CvPublictreeContent:l.a},data:function(){return{searchTime:"",vehicleId:"",objsItem:{},throttle:null,flag:!1}},computed:Object(n.a)({},Object(i.c)(["mapType"]),{_map:function(){return this.$refs.map}}),created:function(){this.throttle=this.$service.throttle(this.search,1e3)},methods:Object(n.a)({},Object(i.b)(["findHeatMapInfo"]),{clearArea:function(){this._map.clearMap()},getParams:function(){if(this.judgeFun()){var e=this._map.getBounds();return{startDate:this.searchTime.startTime.split(" ")[0],endDate:this.searchTime.endTime.split(" ")[0],vehicleIds:this.vehicleId,maxLa:parseInt(1e6*e.maxLat),maxLo:parseInt(1e6*e.maxLng),minLa:parseInt(1e6*e.minLat),minLo:parseInt(1e6*e.minLng),accuracy:this.setZoom(),mapType:this.mapType,coordinate:this.setCoordinate()}}return!1},setZoom:function(){var e=this._map.getZoom();return e<6?1024:e<10?4096:e<14?16384:65536},setCoordinate:function(){switch(parseInt(this.mapType)){case 1:return"bd09";case 3:return"gcj02";default:return"wgs84"}},judgeFun:function(){return this.vehicleId?!!this.searchTime||(this.$message.warning("请选择时间"),!1):(this.$message.warning("请选择车辆"),!1)},search:function(){var e=this,t=this.getParams(),a=this;this._map.removeListener(this.throttle),t&&a.findHeatMapInfo(t).then(function(t){var n=t.flag,i=t.data,r=t.errorCode;n&&i?(i.heatMapByDataList&&(a.objsItem=i),a._map.addListener(e.throttle),a.flag&&i.middleLontitude&&a._map.getBestView({lng:i.middleLontitude,lat:i.middleLatitude})):(a.objsItem={},1==a.mapType&&a._map.addListener(e.throttle),a.$message.error(a.$t("error."+r))),a.flag=!1,e.clearArea()}).catch(function(){e.clearArea(),a.flag=!1,a.$message.error("请求异常")})},handlerVehicleMonitor:function(e){this.vehicleId=e.id,this.flag=!0}})},h=Object(s.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"singleTrack-Heatmap"},[a("cv-operation",{attrs:{position:"left"}},[a("el-form-item",{attrs:{label:"查询时间:"}},[a("SwitchTimecontrol",{staticStyle:{"margin-top":"-1px",position:"relative","z-index":"99"},attrs:{type:"month",clearable:!1},model:{value:e.searchTime,callback:function(t){e.searchTime=t},expression:"searchTime"}})],1),a("el-form-item",{staticStyle:{float:"right"}},[a("cv-tool",{staticStyle:{margin:"0px"},attrs:{name:e.$route.name,data:e.$store.getters.monitorMenu,"is-add":!1,"is-modify":!1,"is-remove":!1,"is-export":!1},on:{search:e.search}})],1)],1),a("cv-publictree-content",{attrs:{model:"single","vehicle-monitor":e.handlerVehicleMonitor,"is-check":!1}},[a("heat-map",{ref:"map",attrs:{data:e.objsItem}})],1)],1)},[],!1,null,"b834d7fe",null).exports;t.default=h},"45d7":function(e,t,a){"use strict";var n=a("6e18");a.n(n).a},5966:function(e,t,a){"use strict";a("7f7f"),a("c5f6");var n={name:"CvSwitchTimecontrol",props:{type:{type:[String],default:"date"},clearable:{type:Boolean,default:!0},result:{type:[String],default:"Object"}},data:function(){return{datevalue:null,daterangevalue:null,quartervalue:null,format:"yyyy-MM-dd HH:mm:ss",pickerOption:{disabledDate:function(e){return e.getTime()>Date.now()}}}},methods:{transformQuarter:function(e,t){1<arguments.length&&void 0!==t||this.format;var a=this.$filter,n=a.format,i=a.dateWeekMonth,r=n(e,n);return r&&i(r,this.format).quarter.num},enterDatevalue:function(e,t){var a=this.$filter,n=a.format,i=a.dateWeekMonth,r=(a.timeStamp,n(e,this.format)),s=n(new Date,this.format),o=i(r,this.format),c=o.week,l=o.month;switch(t){case"date":return"Object"==this.result?this.$emit("input",{startTime:n(e,"yyyy-MM-dd start"),endTime:n(e,"yyyy-MM-dd end")}):this.$emit("input",n(e,"yyyy-MM-dd"));case"week":return this.$emit("input",{startTime:c.WeekStart,endTime:this.notBeyondCurrenttime(c.WeekEnd,s)});case"month":return"Object"==this.result?this.$emit("input",{startTime:l.MonthStart,endTime:this.notBeyondCurrenttime(l.MonthEnd,s)}):this.$emit("input",n(e,"yyyy-MM"));case"year":return this.$emit("input",n(e,"yyyy"))}},enterQuartervalue:function(e,t){switch(Number(e)){case 1:return this.$emit("input",{startmonth:1});case 2:return this.$emit("input",{startmonth:4});case 3:return this.$emit("input",{startmonth:7});case 7:return this.$emit("input",{startmonth:10})}},enterDaterange:function(e,t){var a=this,n=this.$filter.format;if(this.$service.isArray(e)){var i=e.map(function(e){return n(e,a.format)});this.$emit("input",{startTime:i[0],endTime:i[1]})}},notBeyondCurrenttime:function(e,t){var a=this.$filter.timeStamp;return 0<=a(e)-a(t)?t:e}},computed:{_quarterLists:function(){var e=this.transformQuarter(new Date);return["01季度","02季度","03季度","04季度"].map(function(t,a){return{label:"".concat((new Date).getFullYear(),"(").concat(t,")"),value:a+1,disabled:e<a+1}})}},watch:{datevalue:function(e){e&&this.enterDatevalue(e,this.type)},quartervalue:function(e){e&&this.enterQuartervalue(e,this.type)},daterangevalue:function(e){e&&this.enterDaterange(e,this.type)},type:function(e){this.datevalue=null,this.daterangevalue=null,this.quartervalue=null}}},i=a("2877"),r=Object(i.a)(n,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form-item",{attrs:{label:""}},["date"==e.type||"week"==e.type||"month"==e.type||"year"==e.type?a("el-date-picker",{attrs:{format:"week"==e.type?"yyyy第WW周":"",type:e.type,"picker-options":e.pickerOption,clearable:e.clearable},model:{value:e.datevalue,callback:function(t){e.datevalue=t},expression:"datevalue"}}):"quarter"==e.type?a("el-select",{model:{value:e.quartervalue,callback:function(t){e.quartervalue=t},expression:"quartervalue"}},e._l(e._quarterLists,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})}),1):e._e(),a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:"daterange"==e.type,expression:"type=='daterange'"}],attrs:{type:"daterange","picker-options":e.pickerOption,clearable:e.clearable},model:{value:e.daterangevalue,callback:function(t){e.daterangevalue=t},expression:"daterangevalue"}})],1)},[],!1,null,null,null).exports;r.install=function(e){e.component(r.name,r)},t.a=r},"6e18":function(e,t,a){},e6f6:function(e,t,a){"use strict";var n=a("f60e");a.n(n).a},f60e:function(e,t,a){}}]);